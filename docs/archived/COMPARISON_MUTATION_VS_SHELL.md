# mutation.py vs green_llm/shell.py å¯¹æ¯”åˆ†æ

**æ—¥æœŸï¼š** 2025-11-06
**å¯¹æ¯”å¯¹è±¡ï¼š**
- `/home/green/energy_dl/nightly/mutation.py` - æœ¬é¡¹ç›®çš„å˜å¼‚è®­ç»ƒè„šæœ¬
- `/home/green/green_llm/my_codamosa/shell.py` - green_llmçš„shellè„šæœ¬

---

## ğŸ“‹ æ‰§è¡Œæ¦‚è§ˆå¯¹æ¯”

| ç»´åº¦ | mutation.py (æœ¬é¡¹ç›®) | shell.py (green_llm) |
|------|---------------------|---------------------|
| **åº”ç”¨åœºæ™¯** | æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒè¶…å‚æ•°å˜å¼‚ | Pynguinæµ‹è¯•ç”Ÿæˆå·¥å…·ï¼ˆMOSA/CoDAMOSAï¼‰ |
| **ä¸»è¦ç›®æ ‡** | èƒ½è€—-æ€§èƒ½æƒè¡¡ç ”ç©¶ | LLMè¾…åŠ©æµ‹è¯•ç”Ÿæˆ |
| **ä»£ç è§„æ¨¡** | ~1050è¡Œ | ~158è¡Œ |
| **æ¶æ„é£æ ¼** | é¢å‘å¯¹è±¡ï¼ˆç±»ï¼‰ | è¿‡ç¨‹å¼ï¼ˆå‡½æ•°ï¼‰ |
| **é…ç½®æ–¹å¼** | JSONé…ç½®æ–‡ä»¶ | å‘½ä»¤è¡Œå‚æ•° + æ•°æ®æ–‡ä»¶ |
| **èƒ½è€—ç›‘æ§** | é›†æˆå®Œæ•´èƒ½è€—ç›‘æ§ | æ— èƒ½è€—ç›‘æ§ |

---

## ğŸ”„ å˜å¼‚è®­ç»ƒæ‰§è¡Œæµç¨‹å¯¹æ¯”

### mutation.pyçš„æ‰§è¡Œæµç¨‹

```
1. åˆå§‹åŒ–
   â”œâ”€â”€ åŠ è½½config/models_config.jsoné…ç½®
   â”œâ”€â”€ è®¾ç½®éšæœºç§å­ï¼ˆå¯é€‰ï¼‰
   â””â”€â”€ åˆ›å»ºresultsç›®å½•

2. ç”Ÿæˆå”¯ä¸€å˜å¼‚
   â”œâ”€â”€ generate_mutations()
   â”œâ”€â”€ ä½¿ç”¨frozensetå»é‡ä¿è¯å”¯ä¸€æ€§
   â”œâ”€â”€ æœ€å¤šå°è¯•1000æ¬¡é˜²æ­¢æ­»å¾ªç¯
   â””â”€â”€ è¿”å›Nä¸ªå”¯ä¸€çš„è¶…å‚æ•°ç»„åˆ

3. ä¾æ¬¡æ‰§è¡Œæ¯ä¸ªå˜å¼‚
   â”œâ”€â”€ run_experiment()
   â”‚   â”œâ”€â”€ æ„å»ºè®­ç»ƒå‘½ä»¤ï¼ˆbuild_training_commandï¼‰
   â”‚   â”œâ”€â”€ æ‰§è¡Œè®­ç»ƒ + èƒ½è€—ç›‘æ§ï¼ˆrun_training_with_monitoringï¼‰
   â”‚   â”‚   â”œâ”€â”€ è°ƒç”¨scripts/run.sh
   â”‚   â”‚   â”œâ”€â”€ run.shé›†æˆperfå’Œnvidia-smiç›‘æ§
   â”‚   â”‚   â”œâ”€â”€ å®æ—¶è®°å½•CPUèƒ½è€—ï¼ˆperfç›´æ¥åŒ…è£¹å‘½ä»¤ï¼‰
   â”‚   â”‚   â””â”€â”€ å®æ—¶è®°å½•GPUæŒ‡æ ‡ï¼ˆåå°å¾ªç¯é‡‡æ ·ï¼‰
   â”‚   â”œâ”€â”€ è§£æèƒ½è€—æ•°æ®ï¼ˆparse_energy_metricsï¼‰
   â”‚   â”‚   â”œâ”€â”€ cpu_energy.txt â†’ CPUåŒ…/å†…å­˜èƒ½è€—
   â”‚   â”‚   â”œâ”€â”€ gpu_power.csv â†’ GPUåŠŸç‡ç»Ÿè®¡
   â”‚   â”‚   â”œâ”€â”€ gpu_temperature.csv â†’ GPUæ¸©åº¦ç»Ÿè®¡
   â”‚   â”‚   â””â”€â”€ gpu_utilization.csv â†’ GPUåˆ©ç”¨ç‡ç»Ÿè®¡
   â”‚   â”œâ”€â”€ æ£€æŸ¥è®­ç»ƒæˆåŠŸæ€§ï¼ˆcheck_training_successï¼‰
   â”‚   â”œâ”€â”€ æå–æ€§èƒ½æŒ‡æ ‡ï¼ˆextract_performance_metricsï¼‰
   â”‚   â”œâ”€â”€ å¤±è´¥é‡è¯•ï¼ˆæœ€å¤š2æ¬¡ï¼‰
   â”‚   â””â”€â”€ ä¿å­˜JSONç»“æœ
   â””â”€â”€ Sleep 60ç§’é˜²æ­¢èƒ½è€—å¹²æ‰°

4. ç”Ÿæˆæ€»ç»“æŠ¥å‘Š
   â”œâ”€â”€ æ‰“å°æˆåŠŸ/å¤±è´¥ç»Ÿè®¡
   â”œâ”€â”€ æ‰“å°æ€»è€—æ—¶
   â””â”€â”€ åˆ—å‡ºæ‰€æœ‰å®éªŒID
```

### shell.pyçš„æ‰§è¡Œæµç¨‹

```
1. è§£æå‘½ä»¤è¡Œå‚æ•°
   â”œâ”€â”€ --key: list/single
   â”œâ”€â”€ --llm: æ¨¡å‹åç§°
   â”œâ”€â”€ --max_time: è¶…æ—¶æ—¶é—´ï¼ˆé»˜è®¤600ç§’ï¼‰
   â””â”€â”€ --data_path: æ•°æ®æ–‡ä»¶è·¯å¾„

2. è¯»å–æ•°æ®æ–‡ä»¶ï¼ˆlist.dtæ ¼å¼ï¼‰
   â””â”€â”€ CSVæ ¼å¼: project_path,module_name

3. ä¾æ¬¡æ‰§è¡Œæ¯ä¸ªæµ‹è¯•
   â”œâ”€â”€ shell()å‡½æ•°
   â”‚   â”œâ”€â”€ æ ¹æ®LLMåç§°ç”Ÿæˆç®€çŸ­æ ‡è¯†ï¼ˆ790m/1.5b/3b/7bï¼‰
   â”‚   â”œâ”€â”€ æ„å»ºbashå‘½ä»¤è°ƒç”¨run.shæˆ–mosa.sh
   â”‚   â”‚   â””â”€â”€ bash run.sh -p <project> -o <output> -r <result> -n <llm> -m <module> -t <time>
   â”‚   â””â”€â”€ shell_cmd()æ‰§è¡Œå‘½ä»¤
   â”‚       â”œâ”€â”€ å†™å…¥cmd.mlogæ—¥å¿—
   â”‚       â”œâ”€â”€ æœ€å¤šé‡å¤3æ¬¡ï¼ˆcmd_reputation=1ï¼‰
   â”‚       â”œâ”€â”€ subprocess.runæ‰§è¡Œï¼Œè¶…æ—¶36000ç§’
   â”‚       â”œâ”€â”€ æˆåŠŸåˆ™æ”¶é›†*.logæ–‡ä»¶åˆ°result/<name>-<i>/ç›®å½•
   â”‚       â””â”€â”€ å¤±è´¥è®°å½•é”™è¯¯ä¿¡æ¯
   â””â”€â”€ æ— ç­‰å¾…é—´éš”ï¼Œè¿ç»­æ‰§è¡Œ

4. æ— æ€»ç»“æŠ¥å‘Š
   â””â”€â”€ ä»…é€šè¿‡cmd.mlogæŸ¥çœ‹æ—¥å¿—
```

---

## ğŸ”¬ æ ¸å¿ƒå·®å¼‚åˆ†æ

### 1. **å˜å¼‚ç­–ç•¥**

| ç‰¹æ€§ | mutation.py | shell.py |
|------|-------------|----------|
| **å˜å¼‚ç±»å‹** | è¶…å‚æ•°å˜å¼‚ï¼ˆepochs, lr, seedç­‰ï¼‰ | æ— å˜å¼‚ï¼ˆå›ºå®šå‚æ•°ï¼‰ |
| **å˜å¼‚ç”Ÿæˆ** | âœ… generate_mutations()ç”Ÿæˆå”¯ä¸€ç»„åˆ | âŒ æ— å˜å¼‚æœºåˆ¶ |
| **å»é‡ä¿è¯** | âœ… frozensetå»é‡ï¼Œä¿è¯å”¯ä¸€æ€§ | N/A |
| **åœæ­¢ä¿æŠ¤** | âœ… MAX_MUTATION_ATTEMPTS=1000 | N/A |
| **å¯å¤ç°æ€§** | âœ… éšæœºç§å­æ”¯æŒ | âŒ æ— ç§å­æ§åˆ¶ |

**æ ¸å¿ƒåŒºåˆ«ï¼š**
- **mutation.py** æ¯æ¬¡è¿è¡Œç”Ÿæˆ**ä¸åŒçš„è¶…å‚æ•°ç»„åˆ**ï¼Œç ”ç©¶è¶…å‚æ•°å¯¹èƒ½è€—å’Œæ€§èƒ½çš„å½±å“
- **shell.py** æ‰§è¡Œ**å›ºå®šçš„æµ‹è¯•ä»»åŠ¡**ï¼Œæ— è¶…å‚æ•°å˜å¼‚ï¼Œä¸“æ³¨äºLLMè¾…åŠ©æµ‹è¯•ç”Ÿæˆ

---

### 2. **èƒ½è€—ç›‘æ§**

| ç»´åº¦ | mutation.py | shell.py |
|------|-------------|----------|
| **CPUèƒ½è€—** | âœ… perfç›´æ¥åŒ…è£¹å‘½ä»¤ï¼ˆç²¾ç¡®ï¼‰ | âŒ æ—  |
| **GPUåŠŸç‡** | âœ… nvidia-smiåå°é‡‡æ · | âŒ æ—  |
| **GPUæ¸©åº¦** | âœ… è®°å½•å¹³å‡/æœ€å¤§å€¼ | âŒ æ—  |
| **GPUåˆ©ç”¨ç‡** | âœ… è®°å½•å¹³å‡/æœ€å¤§å€¼ | âŒ æ—  |
| **æ•°æ®æ ¼å¼** | CPU: txt, GPU: CSV | N/A |
| **è§£ææ–¹å¼** | æµå¼è§£æï¼ˆå†…å­˜O(1)ï¼‰ | N/A |
| **ç›‘æ§è¯¯å·®** | <2%ï¼ˆç›´æ¥åŒ…è£¹ï¼‰ | N/A |

**å…³é”®åŒºåˆ«ï¼š**
- **mutation.py** æ ¸å¿ƒç›®æ ‡æ˜¯**èƒ½è€—-æ€§èƒ½æƒè¡¡ç ”ç©¶**ï¼Œå®Œæ•´èƒ½è€—ç›‘æ§æ˜¯å¿…éœ€åŠŸèƒ½
- **shell.py** å…³æ³¨**æµ‹è¯•ç”Ÿæˆè´¨é‡**ï¼Œä¸æ¶‰åŠèƒ½è€—åˆ†æ

---

### 3. **é‡è¯•æœºåˆ¶**

| ç‰¹æ€§ | mutation.py | shell.py |
|------|-------------|----------|
| **é‡è¯•è§¦å‘** | âœ… è®­ç»ƒå¤±è´¥æ—¶æ™ºèƒ½é‡è¯• | âš ï¸ å›ºå®šé‡å¤æ‰§è¡Œ |
| **é‡è¯•æ¬¡æ•°** | æœ€å¤š2æ¬¡ï¼ˆå¯é…ç½®ï¼‰ | æœ€å¤š3æ¬¡ï¼ˆç¡¬ç¼–ç ï¼‰ |
| **é‡è¯•é—´éš”** | 30ç§’ï¼ˆRETRY_SLEEP_SECONDSï¼‰ | æ— é—´éš” |
| **å¤±è´¥æ¸…ç†** | âœ… è‡ªåŠ¨æ¸…ç†å¤±è´¥ç›®å½• | âŒ æ®‹ç•™*.logæ–‡ä»¶ |
| **æˆåŠŸåˆ¤æ–­** | âœ… check_training_success() å¤šç§æ¨¡å¼ | âš ï¸ returncode==0 |

**mutation.pyé‡è¯•é€»è¾‘ï¼ˆæ™ºèƒ½ï¼‰ï¼š**
```python
while not success and retries <= max_retries:
    exit_code, duration, energy = run_training_with_monitoring(...)
    success, error_msg = check_training_success(log_file, repo)

    if success:
        # æ¸…ç†å¤±è´¥å°è¯•çš„ä¸´æ—¶ç›®å½•
        cleanup_failed_attempts()
    else:
        print(f"âŒ Training failed: {error_msg}")
        retries += 1
        if retries <= max_retries:
            time.sleep(30)  # ç­‰å¾…å†é‡è¯•
```

**shell.pyé‡è¯•é€»è¾‘ï¼ˆç®€å•ï¼‰ï¼š**
```python
i = 0
cnt = 0
while i < cmd_reputation and cnt < max_count + cmd_reputation:
    subprocess.run(cmd, ...)
    if returncode == 0:
        i += 1  # æˆåŠŸè®¡æ•°
    cnt += 1  # æ€»å°è¯•è®¡æ•°
```

---

### 4. **æ•°æ®ç»„ç»‡å’Œè¾“å‡º**

#### mutation.pyçš„æ•°æ®ç»„ç»‡

**ç›®å½•ç»“æ„ï¼š**
```
results/
â”œâ”€â”€ 20251105_174723_pytorch_resnet_cifar10_resnet20.json    # å®éªŒç»“æœ
â”œâ”€â”€ training_pytorch_resnet_cifar10_resnet20_20251105_174723.log  # è®­ç»ƒæ—¥å¿—
â””â”€â”€ energy_20251105_174723_pytorch_resnet_cifar10_resnet20_attempt0/  # èƒ½è€—æ•°æ®
    â”œâ”€â”€ cpu_energy.txt           # CPUèƒ½è€—
    â”œâ”€â”€ gpu_power.csv            # GPUåŠŸç‡
    â”œâ”€â”€ gpu_temperature.csv      # GPUæ¸©åº¦
    â””â”€â”€ gpu_utilization.csv      # GPUåˆ©ç”¨ç‡
```

**JSONç»“æœæ ¼å¼ï¼ˆå®Œæ•´ç»“æ„åŒ–ï¼‰ï¼š**
```json
{
  "experiment_id": "20251105_174723_test_repo_model_a",
  "timestamp": "2025-11-05T17:47:45.528255",
  "repository": "test_repo",
  "model": "model_a",
  "hyperparameters": {
    "epochs": 19,
    "learning_rate": 0.004355898544890743
  },
  "duration_seconds": 19.092665910720825,
  "energy_metrics": {
    "cpu_energy_pkg_joules": 406.32,
    "cpu_energy_ram_joules": 30.54,
    "cpu_energy_total_joules": 436.86,
    "gpu_power_avg_watts": 68.59,
    "gpu_power_max_watts": 68.85,
    "gpu_power_min_watts": 68.44,
    "gpu_energy_total_joules": 754.54,
    "gpu_temp_avg_celsius": 52.3,
    "gpu_temp_max_celsius": 55.1,
    "gpu_util_avg_percent": 78.2,
    "gpu_util_max_percent": 95.6
  },
  "performance_metrics": {
    "accuracy": 85.0,
    "loss": 0.6337
  },
  "training_success": true,
  "retries": 0,
  "error_message": ""
}
```

#### shell.pyçš„æ•°æ®ç»„ç»‡

**ç›®å½•ç»“æ„ï¼š**
```
result/
â”œâ”€â”€ 1.5b_module1-0/    # LLMæ ‡è¯†_æ¨¡å—å-æ‰§è¡Œæ¬¡æ•°
â”‚   â”œâ”€â”€ *.log          # å„ç§æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ ...
â”œâ”€â”€ 1.5b_module1-1/
â”‚   â””â”€â”€ *.log
â””â”€â”€ ...
cmd.mlog               # å‘½ä»¤æ‰§è¡Œæ—¥å¿—
```

**æ—¥å¿—æ ¼å¼ï¼ˆçº¯æ–‡æœ¬ï¼‰ï¼š**
```
bash run.sh ... :
success 0:CompletedProcess(args='...', returncode=0)
error 1:CompletedProcess(args='...', returncode=1)
```

**å¯¹æ¯”æ€»ç»“ï¼š**

| ç»´åº¦ | mutation.py | shell.py |
|------|-------------|----------|
| **ç»“æœæ ¼å¼** | JSONï¼ˆç»“æ„åŒ–ï¼‰ | æ–‡æœ¬æ—¥å¿—ï¼ˆéç»“æ„åŒ–ï¼‰ |
| **æ•°æ®æŸ¥è¯¢** | âœ… æ˜“äºè§£æå’Œåˆ†æ | âš ï¸ éœ€æ‰‹åŠ¨è§£ææ—¥å¿— |
| **èƒ½è€—æ•°æ®** | âœ… åˆ†ç±»å­˜å‚¨ï¼ˆtxt+CSVï¼‰ | âŒ æ—  |
| **å…ƒæ•°æ®** | âœ… å®Œæ•´ï¼ˆè¶…å‚æ•°ã€æ—¶é—´æˆ³ã€é‡è¯•æ¬¡æ•°ï¼‰ | âš ï¸ æœ‰é™ï¼ˆä»…æˆåŠŸ/å¤±è´¥ï¼‰ |
| **å¯è§†åŒ–** | âœ… æ˜“äºç»˜å›¾å’Œç»Ÿè®¡ | âš ï¸ å›°éš¾ |

---

## ğŸ“Š æ•°æ®å¤„ç†æµç¨‹å¯¹æ¯”

### mutation.pyçš„æ•°æ®å¤„ç†ç®¡é“

```
1. åŸå§‹æ•°æ®é‡‡é›†
   â”œâ”€â”€ CPU: perf statè¾“å‡º â†’ cpu_energy.txt
   â”œâ”€â”€ GPU: nvidia-smi CSV â†’ gpu_*.csv
   â””â”€â”€ è®­ç»ƒæ—¥å¿—: stdout/stderr â†’ training_*.log

2. æ•°æ®è§£æï¼ˆparse_energy_metrics + extract_performance_metricsï¼‰
   â”œâ”€â”€ CPUèƒ½è€—: æ­£åˆ™åŒ¹é… "Package Energy: XXX J"
   â”œâ”€â”€ GPUç»Ÿè®¡: æµå¼CSVè§£æï¼Œè®¡ç®—avg/max/min/sum
   â””â”€â”€ æ€§èƒ½æŒ‡æ ‡: æ­£åˆ™åŒ¹é…ç”¨æˆ·å®šä¹‰çš„patterns

3. æ•°æ®èšåˆ
   â””â”€â”€ æ‰€æœ‰æŒ‡æ ‡æ±‡æ€»åˆ°ä¸€ä¸ªDict

4. ç»“æœæŒä¹…åŒ–
   â”œâ”€â”€ JSONæ ¼å¼ä¿å­˜ï¼ˆäººç±»å¯è¯» + æœºå™¨å¯è§£æï¼‰
   â”œâ”€â”€ åŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡ï¼ˆè¶…å‚æ•°ã€é‡è¯•æ¬¡æ•°ç­‰ï¼‰
   â””â”€â”€ æ–‡ä»¶ååŒ…å«æ—¶é—´æˆ³å’Œå®éªŒID

5. æ§åˆ¶å°æŠ¥å‘Š
   â”œâ”€â”€ å®æ—¶æ‰“å°èƒ½è€—æ‘˜è¦
   â”œâ”€â”€ å®éªŒæ€»ç»“ï¼ˆæˆåŠŸ/å¤±è´¥ç»Ÿè®¡ï¼‰
   â””â”€â”€ å½©è‰²emojiè¾“å‡ºï¼ˆæ˜“äºé˜…è¯»ï¼‰
```

### shell.pyçš„æ•°æ®å¤„ç†ç®¡é“

```
1. åŸå§‹æ•°æ®é‡‡é›†
   â”œâ”€â”€ é€šè¿‡subprocess.PIPEæ•è·stdout/stderr
   â””â”€â”€ Pynguinç”Ÿæˆçš„*.logæ–‡ä»¶

2. æ•°æ®å¤„ç†
   â”œâ”€â”€ æ— è§£æï¼Œç›´æ¥ç§»åŠ¨*.logåˆ°resultç›®å½•
   â””â”€â”€ returncodeåˆ¤æ–­æˆåŠŸ/å¤±è´¥

3. ç»“æœæŒä¹…åŒ–
   â”œâ”€â”€ åˆ›å»ºresult/<name>-<i>/ç›®å½•
   â”œâ”€â”€ mv *.logç§»åŠ¨æ‰€æœ‰æ—¥å¿—æ–‡ä»¶
   â””â”€â”€ cmd.mlogè¿½åŠ æ‰§è¡Œè®°å½•

4. æ§åˆ¶å°æŠ¥å‘Š
   â”œâ”€â”€ print("success/error ...")
   â””â”€â”€ æ— æ±‡æ€»ç»Ÿè®¡
```

---

## ğŸ¯ æŠ¥å‘Šæ ¼å¼å¯¹æ¯”

### mutation.pyçš„æ§åˆ¶å°è¾“å‡º

```
================================================================================
ğŸ§¬ MUTATION-BASED TRAINING ENERGY PROFILER
================================================================================
Repository: pytorch_resnet_cifar10
Model: resnet20
Parameters to mutate: ['epochs', 'learning_rate']
Number of runs: 3
Max retries: 2
================================================================================

ğŸ“Š Generating 3 unique mutation(s) for parameters: ['epochs', 'learning_rate']
   Mutation 1: {'epochs': 82, 'learning_rate': 0.0112}
   Mutation 2: {'epochs': 95, 'learning_rate': 0.0276}
   Mutation 3: {'epochs': 29, 'learning_rate': 0.0140}

â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
â–ˆ RUN 1/3
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

================================================================================
ğŸ”¬ EXPERIMENT: 20251105_174723_pytorch_resnet_cifar10_resnet20
   Repository: pytorch_resnet_cifar10
   Model: resnet20
   Hyperparameters: {'epochs': 82, 'learning_rate': 0.0112}
================================================================================

ğŸš€ Starting training with integrated energy monitoring...
   Command: ./scripts/run.sh ... --epochs 82 --lr 0.0112
   Log: results/training_pytorch_resnet_cifar10_resnet20_20251105_174723.log
   Energy directory: results/energy_20251105_174723_pytorch_resnet_cifar10_resnet20_attempt0
   Timeout: 36000s (10.0h)

âœ“ Training finished in 1234.5s with exit code 0
   CPU Energy: 12345.67 J
   GPU Energy: 23456.78 J

âœ… Training successful!
ğŸ“Š Performance metrics: {'accuracy': 85.0, 'loss': 0.6337}
ğŸ’¾ Results saved to: results/20251105_174723_pytorch_resnet_cifar10_resnet20.json

â³ Sleeping 60 seconds to prevent energy interference...

[é‡å¤Run 2å’ŒRun 3...]

================================================================================
ğŸ“Š EXPERIMENT SUMMARY
================================================================================
Total experiments: 3
Successful: 3
Failed: 0
Total time: 1.25 hours
Results directory: /home/green/energy_dl/nightly/results
================================================================================
âœ… Run 1: 20251105_174723_... (1234.5s, 0 retries)
âœ… Run 2: 20251105_174801_... (1189.3s, 0 retries)
âœ… Run 3: 20251105_174956_... (1267.8s, 1 retries)

âœ¨ All experiments completed!
```

**ç‰¹ç‚¹ï¼š**
- âœ… ç»“æ„åŒ–æ¸…æ™°ï¼Œä½¿ç”¨åˆ†éš”çº¿å’Œemoji
- âœ… å®æ—¶è¿›åº¦åé¦ˆ
- âœ… è¯¦ç»†çš„èƒ½è€—å’Œæ€§èƒ½æŒ‡æ ‡
- âœ… å®Œæ•´çš„å®éªŒæ€»ç»“

### shell.pyçš„æ§åˆ¶å°è¾“å‡º

```
1.5b_module1
bash run.sh -p ./test_modules/typesystem -o ./test_outputs/typesystem/formats/1.5b -r ./test_outputs/typesystem/formats/1.5b -n deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B -m typesystem.formats -t 600
success 0:CompletedProcess(args='bash run.sh ...', returncode=0)
1.5b_module2
bash run.sh -p ./test_modules/ansible -o ./test_outputs/ansible/1.5b -r ./test_outputs/ansible/1.5b -n deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B -m ansible.core -t 600
error 0:CompletedProcess(args='bash run.sh ...', returncode=1)
...
```

**ç‰¹ç‚¹ï¼š**
- âš ï¸ ç®€å•æ–‡æœ¬è¾“å‡º
- âš ï¸ æ— ç»“æ„åŒ–ä¿¡æ¯
- âš ï¸ ä»…æ˜¾ç¤ºæˆåŠŸ/å¤±è´¥
- âš ï¸ æ— ç»Ÿè®¡æ±‡æ€»

---

## ğŸ”§ é…ç½®æœºåˆ¶å¯¹æ¯”

### mutation.pyé…ç½®ï¼ˆJSON + å‘½ä»¤è¡Œï¼‰

**JSONé…ç½®æ–‡ä»¶ï¼ˆconfig/models_config.jsonï¼‰ï¼š**
```json
{
  "models": {
    "pytorch_resnet_cifar10": {
      "path": "/path/to/repo",
      "train_script": "train.py",
      "models": ["resnet20", "resnet32"],
      "model_flag": "-a",
      "supported_hyperparams": {
        "epochs": {
          "type": "int",
          "range": [1, 200],
          "flag": "--epochs",
          "default": 100
        },
        "learning_rate": {
          "type": "float",
          "range": [0.0001, 0.1],
          "flag": "--lr",
          "default": 0.001
        }
      },
      "performance_metrics": {
        "log_patterns": {
          "accuracy": "Test Accuracy: ([0-9.]+)",
          "loss": "Test Loss: ([0-9.]+)"
        }
      }
    }
  }
}
```

**å‘½ä»¤è¡Œå‚æ•°ï¼š**
```bash
python mutation.py \
    --repo pytorch_resnet_cifar10 \
    --model resnet20 \
    --mutate epochs,learning_rate \
    --runs 5 \
    --governor performance \
    --seed 42 \
    --max-retries 2
```

**ä¼˜ç‚¹ï¼š**
- âœ… å£°æ˜å¼é…ç½®ï¼Œæ˜“äºç®¡ç†
- âœ… è¶…å‚æ•°èŒƒå›´é›†ä¸­å®šä¹‰
- âœ… æ€§èƒ½æŒ‡æ ‡æå–è§„åˆ™å¯é…ç½®
- âœ… æ”¯æŒå¤šæ¨¡å‹å¤šä»“åº“

### shell.pyé…ç½®ï¼ˆå‘½ä»¤è¡Œ + æ•°æ®æ–‡ä»¶ï¼‰

**æ•°æ®æ–‡ä»¶ï¼ˆlist.dtï¼‰ï¼š**
```
typesystem,typesystem.formats
ansible,ansible.core
pydantic,pydantic.validators
```

**å‘½ä»¤è¡Œå‚æ•°ï¼š**
```bash
python shell.py \
    --key list \
    --llm deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B \
    --max_time 600 \
    --data_path ./list.dt
```

**ä¼˜ç‚¹ï¼š**
- âœ… ç®€å•ç›´æ¥
- âš ï¸ ç¼ºå°‘è¶…å‚æ•°é…ç½®
- âš ï¸ æ— æ€§èƒ½æŒ‡æ ‡å®šä¹‰

---

## ğŸ“ˆ å¯æ‰©å±•æ€§å¯¹æ¯”

| ç»´åº¦ | mutation.py | shell.py |
|------|-------------|----------|
| **æ–°å¢ä»“åº“** | âœ… ä¿®æ”¹JSONé…ç½® | âš ï¸ ä¿®æ”¹list.dt + ä»£ç  |
| **æ–°å¢è¶…å‚æ•°** | âœ… ä¿®æ”¹JSONé…ç½® | âŒ ä¸æ”¯æŒ |
| **æ–°å¢æ€§èƒ½æŒ‡æ ‡** | âœ… ä¿®æ”¹JSON patterns | âŒ ä¸æ”¯æŒ |
| **æ–°å¢èƒ½è€—æŒ‡æ ‡** | âœ… ä¿®æ”¹parse_energy_metrics | âŒ æ— èƒ½è€—ç›‘æ§ |
| **æ‰¹é‡å®éªŒ** | âœ… æ”¯æŒï¼ˆexperiment configï¼‰ | âš ï¸ é€šè¿‡listå¾ªç¯ |
| **ä»£ç å¤ç”¨** | âœ… ç±»è®¾è®¡ï¼Œæ–¹æ³•å¯é‡ç”¨ | âš ï¸ å‡½æ•°å¼ï¼Œéš¾ä»¥æ‰©å±• |

---

## ğŸ“ é€‚ç”¨åœºæ™¯å¯¹æ¯”

### mutation.pyé€‚åˆï¼š

1. **è¶…å‚æ•°ä¼˜åŒ–ç ”ç©¶**
   - éœ€è¦ç³»ç»Ÿåœ°æ¢ç´¢è¶…å‚æ•°ç©ºé—´
   - ç ”ç©¶è¶…å‚æ•°å¯¹æ¨¡å‹æ€§èƒ½çš„å½±å“

2. **èƒ½è€—-æ€§èƒ½æƒè¡¡åˆ†æ**
   - ç ”ç©¶è®­ç»ƒèƒ½è€—ä¸æ¨¡å‹æ€§èƒ½çš„å…³ç³»
   - å¯»æ‰¾æœ€ä¼˜çš„èƒ½è€—-æ€§èƒ½å¹³è¡¡ç‚¹

3. **å¤šæ¨¡å‹å¤šä»“åº“å®éªŒ**
   - éœ€è¦åœ¨å¤šä¸ªæ¨¡å‹ä¸Šè¿›è¡Œå¯¹æ¯”å®éªŒ
   - éœ€è¦ç»Ÿä¸€çš„å®éªŒç®¡ç†

4. **å¯å¤ç°ç ”ç©¶**
   - éœ€è¦éšæœºç§å­æ§åˆ¶
   - éœ€è¦è¯¦ç»†çš„å®éªŒè®°å½•

### shell.pyé€‚åˆï¼š

1. **ç®€å•çš„æ‰¹é‡æµ‹è¯•**
   - åœ¨å¤šä¸ªæ¨¡å—ä¸Šè¿è¡Œç›¸åŒçš„æµ‹è¯•å·¥å…·
   - ä¸éœ€è¦å¤æ‚çš„é…ç½®

2. **å¿«é€ŸåŸå‹éªŒè¯**
   - å¿«é€Ÿæµ‹è¯•Pynguinåœ¨ä¸åŒæ¨¡å—ä¸Šçš„è¡¨ç°
   - ä¸éœ€è¦è¯¦ç»†çš„æ€§èƒ½åˆ†æ

3. **LLMè¾…åŠ©æµ‹è¯•ç”Ÿæˆ**
   - ä½¿ç”¨ä¸åŒLLMæ¨¡å‹ç”Ÿæˆæµ‹è¯•
   - æ¯”è¾ƒä¸åŒLLMçš„æµ‹è¯•ç”Ÿæˆè´¨é‡

---

## ğŸ’¡ æ€»ç»“

### æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§ | mutation.py | shell.py |
|------|-------------|----------|
| **ç›®æ ‡** | èƒ½è€—-æ€§èƒ½æƒè¡¡ç ”ç©¶ | æµ‹è¯•ç”Ÿæˆå·¥å…·æ‰§è¡Œ |
| **å˜å¼‚** | âœ… è¶…å‚æ•°å˜å¼‚ + å”¯ä¸€æ€§ä¿è¯ | âŒ æ— å˜å¼‚ |
| **èƒ½è€—ç›‘æ§** | âœ… å®Œæ•´ï¼ˆCPU+GPUå¤šç»´åº¦ï¼‰ | âŒ æ—  |
| **æ•°æ®è¾“å‡º** | âœ… JSONç»“æ„åŒ– + CSV | âš ï¸ æ–‡æœ¬æ—¥å¿— |
| **é‡è¯•æœºåˆ¶** | âœ… æ™ºèƒ½é‡è¯• + æ¸…ç† | âš ï¸ ç®€å•é‡å¤ |
| **å¯æ‰©å±•æ€§** | âœ… é«˜ï¼ˆOOP + JSONé…ç½®ï¼‰ | âš ï¸ ä½ï¼ˆè¿‡ç¨‹å¼ï¼‰ |
| **ä»£ç è§„æ¨¡** | 1050è¡Œï¼ˆåŠŸèƒ½å®Œæ•´ï¼‰ | 158è¡Œï¼ˆç®€å•å¿«é€Ÿï¼‰ |

### å„è‡ªä¼˜åŠ¿

**mutation.pyçš„ä¼˜åŠ¿ï¼š**
1. å®Œæ•´çš„èƒ½è€—ç›‘æ§å’Œåˆ†æèƒ½åŠ›
2. å”¯ä¸€æ€§ä¿è¯çš„å˜å¼‚ç”Ÿæˆæœºåˆ¶
3. ç»“æ„åŒ–çš„JSONæ•°æ®è¾“å‡º
4. æ™ºèƒ½çš„å¤±è´¥é‡è¯•å’Œæ¸…ç†
5. çµæ´»çš„JSONé…ç½®ç³»ç»Ÿ
6. è¯¦ç»†çš„å®éªŒè®°å½•å’ŒæŠ¥å‘Š

**shell.pyçš„ä¼˜åŠ¿ï¼š**
1. ä»£ç ç®€å•ï¼Œæ˜“äºç†è§£
2. å¿«é€Ÿæ‰§è¡Œæ‰¹é‡ä»»åŠ¡
3. é€‚åˆç®€å•çš„æµ‹è¯•åœºæ™¯
4. æ— å¤æ‚ä¾èµ–

### æ”¹è¿›å»ºè®®

**å¦‚æœè¦å°†shell.pyæ”¹é€ ä¸ºç±»ä¼¼mutation.pyçš„åŠŸèƒ½ï¼š**
1. æ·»åŠ å˜å¼‚æœºåˆ¶ï¼šæ”¯æŒPynguinå‚æ•°å˜å¼‚
2. æ·»åŠ èƒ½è€—ç›‘æ§ï¼šé›†æˆperfå’Œnvidia-smi
3. ç»“æ„åŒ–è¾“å‡ºï¼šä½¿ç”¨JSONæ›¿ä»£æ–‡æœ¬æ—¥å¿—
4. æ™ºèƒ½é‡è¯•ï¼šåŸºäºå¤±è´¥åŸå› çš„æ™ºèƒ½é‡è¯•
5. é…ç½®æ–‡ä»¶ï¼šä½¿ç”¨JSONé…ç½®æ›¿ä»£ç¡¬ç¼–ç 

**å¦‚æœè¦ç®€åŒ–mutation.pyï¼š**
1. æå–æ ¸å¿ƒåŠŸèƒ½ä¸ºç‹¬ç«‹æ¨¡å—
2. æä¾›ç®€åŒ–çš„CLIæ¥å£
3. å¯é€‰çš„èƒ½è€—ç›‘æ§ï¼ˆå¼€å…³æ§åˆ¶ï¼‰
4. è½»é‡çº§çš„é…ç½®é€‰é¡¹

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0
**æœ€åæ›´æ–°ï¼š** 2025-11-06
