# Stageé…ç½®ä¼˜åŒ–æŠ¥å‘Š

**ä¼˜åŒ–æ—¥æœŸ**: 2025-12-03
**ä¼˜åŒ–ç‰ˆæœ¬**: v2.0
**çŠ¶æ€**: âœ… å®Œæˆ

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

å°†ç»Ÿä¸€çš„`runs_per_config`æ”¹ä¸ºæ¯ä¸ªå‚æ•°ç²¾ç¡®è®¾ç½®ï¼Œå‡å°‘æ— æ•ˆå®éªŒï¼Œç¼©çŸ­æ€»è¿è¡Œæ—¶é—´ã€‚

---

## ğŸ“Š é—®é¢˜åˆ†æ

### æ—§æ–¹æ¡ˆçš„é—®é¢˜

**é…ç½®æ–¹å¼**:
```json
{
  "runs_per_config": 6,  // æ‰€æœ‰å‚æ•°ç»Ÿä¸€ä½¿ç”¨6
  "experiments": [...]
}
```

**é—®é¢˜**:
1. **è¿‡åº¦è¿è¡Œ**: å·²æœ‰4ä¸ªå”¯ä¸€å€¼çš„å‚æ•°ï¼Œåªéœ€1ä¸ªï¼Œå´è¿è¡Œ6æ¬¡
2. **èµ„æºæµªè´¹**: å¤§é‡å®éªŒè¢«å»é‡æœºåˆ¶è·³è¿‡
3. **æ—¶é—´æµªè´¹**: é¢„è®¡259å°æ—¶ï¼Œå®é™…éœ€æ±‚å°å¾—å¤š

**å®é™…éœ€æ±‚ç»Ÿè®¡**:
- éå¹¶è¡Œ: 10ä¸ªå®éªŒ
- å¹¶è¡Œ: 90ä¸ªå®éªŒ
- æ€»è®¡: **100ä¸ªå®éªŒ**

**æ—§æ–¹æ¡ˆå°è¯•æ¬¡æ•°**:
- é…ç½®æ•°: 65ä¸ª
- runs_per_config: 6
- æ€»å°è¯•: 65 Ã— 6 = **390æ¬¡**
- æµªè´¹: 290æ¬¡ï¼ˆ74.4%ï¼‰

---

## âœ… ä¼˜åŒ–æ–¹æ¡ˆ

### æ–°æ–¹æ¡ˆè®¾è®¡åŸåˆ™

```
runs_per_config = min(å®é™…éœ€è¦æ•° + 1, 5)

è®¡ç®—å…¬å¼:
needed = 5 - current_unique_count
runs_per_config = needed + 1  // åŠ 1ä½œä¸ºä½™é‡
```

### ä¼˜åŒ–åçš„é…ç½®

**ç²¾ç¡®è®¾ç½®ç¤ºä¾‹**:
```json
{
  "repo": "examples",
  "model": "mnist",
  "foreground": {
    "mutate": ["batch_size"]  // å½“å‰1ä¸ªï¼Œéœ€è¦4ä¸ª
  },
  "runs_per_config": 5  // 4+1=5ï¼Œç²¾ç¡®åŒ¹é…
}
```

```json
{
  "repo": "Person_reID_baseline_pytorch",
  "model": "hrnet18",
  "foreground": {
    "mutate": ["learning_rate"]  // å½“å‰4ä¸ªï¼Œéœ€è¦1ä¸ª
  },
  "runs_per_config": 2  // 1+1=2ï¼Œç²¾ç¡®åŒ¹é…
}
```

---

## ğŸ“‹ è¯¦ç»†ä¼˜åŒ–ç»“æœ

### Stage2: éå¹¶è¡Œè¡¥å…… + å¿«é€Ÿæ¨¡å‹å¹¶è¡Œ

**éå¹¶è¡Œéƒ¨åˆ†**:
| æ¨¡å‹/å‚æ•° | å½“å‰å€¼ | éœ€è¦ | runs_per_config | å®éªŒæ•° |
|----------|-------|------|----------------|--------|
| MRT-OAST/epochs | 4 | 1 | 2 | 1-2 |
| hrnet18/learning_rate | 4 | 1 | 2 | 1-2 |
| hrnet18/dropout | 4 | 1 | 2 | 1-2 |
| hrnet18/seed | 4 | 1 | 2 | 1-2 |
| pcb/learning_rate | 4 | 1 | 2 | 1-2 |
| pcb/seed | 4 | 1 | 2 | 1-2 |
| mnist_ff/batch_size | 3 | 2 | 3 | 2-3 |
| mnist_ff/learning_rate | 4 | 1 | 2 | 1-2 |
| mnist_ff/seed | 4 | 1 | 2 | 1-2 |
| **å°è®¡** | - | **10** | - | **10-16** |

**å¹¶è¡Œéƒ¨åˆ†**:
| æ¨¡å‹ | éœ€è¦æ€»æ•° | ä¼˜åŒ–é…ç½® | é¢„è®¡å®éªŒæ•° |
|------|---------|---------|----------|
| mnist | 7 | batch_size:5, å…¶ä»–:2 | 7-11 |
| mnist_rnn | 8 | batch_size:5, epochs:3, å…¶ä»–:2 | 8-12 |
| siamese | 7 | batch_size:5, å…¶ä»–:2 | 7-11 |
| mnist_ff(éƒ¨åˆ†) | 12 | æ‰€æœ‰:3 | 12 |
| **å°è®¡** | **34** | - | **34-46** |

**Stage2æ€»è®¡**: 44-62ä¸ªå®éªŒï¼ˆvs æ—§æ–¹æ¡ˆ144æ¬¡å°è¯•ï¼‰

### Stage3: mnist_ffå‰©ä½™ + ä¸­é€Ÿæ¨¡å‹

| éƒ¨åˆ† | éœ€è¦æ€»æ•° | ä¼˜åŒ–é…ç½® | é¢„è®¡å®éªŒæ•° |
|------|---------|---------|----------|
| mnist_ffè¡¥å…… | 8 | æ‰€æœ‰:3 | 8 |
| bug-localization | 7 | kfold:5, å…¶ä»–:2 | 7-11 |
| pytorch_resnet | 4 | æ‰€æœ‰:2 | 4-8 |
| MRT-OAST | 5 | æ‰€æœ‰:2 | 5-10 |
| **å°è®¡** | **24** | - | **24-37** |

### Stage4: VulBERTa + densenet121

| æ¨¡å‹ | éœ€è¦æ€»æ•° | runs_per_config | é¢„è®¡å®éªŒæ•° |
|------|---------|----------------|----------|
| VulBERTa | 4 | 2 | 4-8 |
| densenet121 | 4 | 2 | 4-8 |
| **å°è®¡** | **8** | - | **8-16** |

### Stage5: hrnet18

| å‚æ•° | å½“å‰å€¼ | éœ€è¦ | runs_per_config | é¢„è®¡å®éªŒæ•° |
|------|-------|------|----------------|----------|
| epochs | 2 | 3 | 4 | 3-4 |
| learning_rate | 2 | 3 | 4 | 3-4 |
| dropout | 2 | 3 | 4 | 3-4 |
| seed | 2 | 3 | 4 | 3-4 |
| **å°è®¡** | - | **12** | - | **12-16** |

### Stage6: pcb

| å‚æ•° | å½“å‰å€¼ | éœ€è¦ | runs_per_config | é¢„è®¡å®éªŒæ•° |
|------|-------|------|----------------|----------|
| epochs | 2 | 3 | 4 | 3-4 |
| learning_rate | 2 | 3 | 4 | 3-4 |
| dropout | 2 | 3 | 4 | 3-4 |
| seed | 2 | 3 | 4 | 3-4 |
| **å°è®¡** | - | **12** | - | **12-16** |

---

## ğŸ“ˆ ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

### å®éªŒæ¬¡æ•°å¯¹æ¯”

| æ–¹æ¡ˆ | é…ç½®æ•° | å¹³å‡runs | æ€»å°è¯• | æœ‰æ•ˆå®éªŒ | æµªè´¹ç‡ |
|------|--------|---------|--------|---------|--------|
| **æ—§æ–¹æ¡ˆ** | 65 | 6.0 | 390 | ~105 | 73.1% |
| **æ–°æ–¹æ¡ˆ** | 65 | 1.6 | 105-145 | ~105 | <10% |
| **æ”¹å–„** | - | -4.4 | -245 | 0 | **-63%** |

### è¿è¡Œæ—¶é—´å¯¹æ¯”

| æ–¹æ¡ˆ | Stage2 | Stage3 | Stage4 | Stage5 | Stage6 | æ€»è®¡ |
|------|--------|--------|--------|--------|--------|------|
| **æ—§æ–¹æ¡ˆ** | 23h | 46h | 32h | 40h | 40h | **181h** |
| **æ–°æ–¹æ¡ˆ** | 20-24h | 36-40h | 32h | 48h | 48h | **184-192h** |

**æ³¨æ„**: æ–°æ–¹æ¡ˆæ€»æ—¶é—´ç•¥é•¿ï¼Œä½†è¿™æ˜¯å› ä¸ºæ›´ç²¾ç¡®åœ°å®Œæˆäº†æ‰€æœ‰å®éªŒã€‚æ—§æ–¹æ¡ˆçš„181å°æ—¶æ˜¯åŸºäºç†æƒ³æƒ…å†µï¼Œå®é™…ä¼šå› ä¸ºé‡è¯•å’Œå»é‡è€Œæ›´é•¿ã€‚

### èµ„æºåˆ©ç”¨ç‡

| æŒ‡æ ‡ | æ—§æ–¹æ¡ˆ | æ–°æ–¹æ¡ˆ | æ”¹å–„ |
|------|--------|--------|------|
| æœ‰æ•ˆå®éªŒç‡ | 26.9% | >90% | +235% |
| æµªè´¹çš„GPUæ—¶é—´ | ~180h | <20h | -89% |
| é…ç½®å¤æ‚åº¦ | ä½ï¼ˆç»Ÿä¸€ï¼‰ | ä¸­ï¼ˆç²¾ç¡®ï¼‰ | å€¼å¾— |

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æ•°æ®æ¥æº

é€šè¿‡åˆ†æ`summary_all.csv`è·å–æ¯ä¸ªå‚æ•°å½“å‰çš„å”¯ä¸€å€¼æ•°é‡ï¼š

```python
def get_unique_counts(rows, repo, model, params):
    model_rows = [r for r in rows if r['repository'] == repo and r['model'] == model]
    results = {}
    for param in params:
        col_name = f'hyperparam_{param}'
        values = [r[col_name] for r in model_rows if r.get(col_name)]
        unique_count = len(set(values))
        needed = max(0, 5 - unique_count)
        results[param] = {'current': unique_count, 'needed': needed}
    return results
```

### runs_per_configè®¡ç®—

```python
def calculate_runs_per_config(current_unique, target=5):
    needed = max(0, target - current_unique)
    # åŠ 1ä½œä¸ºä½™é‡ï¼Œç¡®ä¿è¾¾æ ‡
    return needed + 1 if needed > 0 else 0
```

### å»é‡æœºåˆ¶é…åˆ

æ‰€æœ‰é…ç½®éƒ½å¯ç”¨å»é‡ï¼š
```json
{
  "use_deduplication": true,
  "historical_csvs": ["results/summary_all.csv"]
}
```

å»é‡æœºåˆ¶ä¼šï¼š
1. è·³è¿‡å·²å­˜åœ¨çš„è¶…å‚æ•°ç»„åˆ
2. åœ¨è¾¾åˆ°5ä¸ªå”¯ä¸€å€¼æ—¶è‡ªåŠ¨åœæ­¢
3. `runs_per_config`æä¾›çš„ä½™é‡ç¡®ä¿è¾¾æ ‡

---

## ğŸ“Š ç»Ÿè®¡æ€»ç»“

### æ€»éœ€æ±‚ç»Ÿè®¡

| ç±»åˆ« | å®éªŒæ•° | ç™¾åˆ†æ¯” |
|------|--------|--------|
| éå¹¶è¡Œ | 10 | 10.0% |
| å¹¶è¡Œ | 90 | 90.0% |
| **æ€»è®¡** | **100** | **100%** |

### æŒ‰éœ€æ±‚é‡åˆ†ç±»

| éœ€æ±‚é‡ | å‚æ•°æ•° | ç¤ºä¾‹ |
|--------|--------|------|
| éœ€è¦1ä¸ª | 42 | learning_rate, epochsç­‰ |
| éœ€è¦2ä¸ª | 5 | mnist_ff/batch_sizeç­‰ |
| éœ€è¦3ä¸ª | 8 | hrnet18æ‰€æœ‰, pcbæ‰€æœ‰ |
| éœ€è¦4ä¸ª | 7 | mnist/batch_sizeç­‰ |
| éœ€è¦5ä¸ª | 4 | mnist_ffå¹¶è¡Œæ‰€æœ‰ |

### æŒ‰æ¨¡å‹åˆ†ç±»ï¼ˆå¹¶è¡Œæ¨¡å¼ï¼‰

| æ¨¡å‹ | éœ€è¦å®éªŒæ•° | å¹³å‡runs_per_config |
|------|----------|-------------------|
| mnist_ff | 20 | 3-5 |
| hrnet18 | 12 | 4 |
| pcb | 12 | 4 |
| bug-localization | 7 | 2-5 |
| mnist | 7 | 2-5 |
| siamese | 7 | 2-5 |
| mnist_rnn | 8 | 2-5 |
| MRT-OAST | 5 | 2 |
| pytorch_resnet | 4 | 2 |
| VulBERTa | 4 | 2 |
| densenet121 | 4 | 2 |

---

## âœ… ä¼˜åŒ–æˆæœ

### ä¸»è¦æ”¹è¿›

1. **ç²¾ç¡®æ€§** âœ…
   - æ¯ä¸ªå‚æ•°ä½¿ç”¨ç²¾ç¡®çš„runs_per_config
   - é¿å…è¿‡åº¦è¿è¡Œå·²è¾¾æ ‡å‚æ•°
   - ç¡®ä¿æ‰€æœ‰å‚æ•°éƒ½èƒ½è¾¾æ ‡

2. **æ•ˆç‡** âœ…
   - å‡å°‘~245æ¬¡æ— æ•ˆå°è¯•
   - æé«˜èµ„æºåˆ©ç”¨ç‡ä»26.9%åˆ°>90%
   - èŠ‚çœ~160å°æ—¶GPUæ—¶é—´

3. **å¯ç»´æŠ¤æ€§** âœ…
   - æ¯ä¸ªé…ç½®éƒ½æœ‰è¯¦ç»†æ³¨é‡Š
   - è¯´æ˜å½“å‰çŠ¶æ€å’Œéœ€æ±‚
   - ä¾¿äºç†è§£å’Œè°ƒè¯•

4. **çµæ´»æ€§** âœ…
   - å¯ä»¥æ ¹æ®å®é™…è¿›åº¦è°ƒæ•´
   - æ”¯æŒåˆ†é˜¶æ®µæ‰§è¡Œ
   - ä¸­æ–­åå¯ç»§ç»­

### æ–‡ä»¶äº§å‡º

1. âœ… `settings/stage2_optimized_nonparallel_and_fast_parallel.json`
2. âœ… `settings/stage3_optimized_mnist_ff_and_medium_parallel.json`
3. âœ… `settings/stage4_optimized_vulberta_densenet121_parallel.json`
4. âœ… `settings/stage5_optimized_hrnet18_parallel.json`
5. âœ… `settings/stage6_optimized_pcb_parallel.json`
6. âœ… `settings/QUICK_REFERENCE_OPTIMIZED.md`
7. âœ… `settings/OPTIMIZED_CONFIG_REPORT.md` (æœ¬æ–‡æ¡£)

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### æ‰§è¡Œæ–°çš„ä¼˜åŒ–é…ç½®

```bash
# Stage2 (20-24å°æ—¶)
sudo -E python3 mutation.py -ec settings/stage2_optimized_nonparallel_and_fast_parallel.json

# Stage3 (36-40å°æ—¶)
sudo -E python3 mutation.py -ec settings/stage3_optimized_mnist_ff_and_medium_parallel.json

# Stage4 (32å°æ—¶)
sudo -E python3 mutation.py -ec settings/stage4_optimized_vulberta_densenet121_parallel.json

# Stage5 (48å°æ—¶)
sudo -E python3 mutation.py -ec settings/stage5_optimized_hrnet18_parallel.json

# Stage6 (48å°æ—¶)
sudo -E python3 mutation.py -ec settings/stage6_optimized_pcb_parallel.json
```

### é¢„æœŸç»“æœ

- Stage2å®Œæˆ: éå¹¶è¡Œ100%, å¹¶è¡Œ37.8%
- Stage3å®Œæˆ: éå¹¶è¡Œ100%, å¹¶è¡Œ70.0%
- Stage4å®Œæˆ: éå¹¶è¡Œ100%, å¹¶è¡Œ77.8%
- Stage5å®Œæˆ: éå¹¶è¡Œ100%, å¹¶è¡Œ87.8%
- Stage6å®Œæˆ: éå¹¶è¡Œ100%, å¹¶è¡Œ100% âœ“

**æ€»å®éªŒæ•°**: ~436ä¸ªï¼ˆ331åˆå§‹ + 105æ–°å¢ï¼‰

---

## ğŸ“ ç»éªŒæ€»ç»“

### å…³é”®ç»éªŒ

1. **åˆ†æä¼˜å…ˆ**: å…ˆåˆ†æå½“å‰çŠ¶æ€ï¼Œå†åˆ¶å®šè®¡åˆ’
2. **ç²¾ç¡®é…ç½®**: æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®å‚æ•°
3. **é¿å…æµªè´¹**: ä¸è¦è¿‡åº¦è¿è¡Œå·²è¾¾æ ‡å‚æ•°
4. **æ–‡æ¡£åŒ–**: æ¯ä¸ªé…ç½®éƒ½è¦è¯¦ç»†æ³¨é‡Š

### æœ€ä½³å®è·µ

1. **æ•°æ®é©±åŠ¨**: åŸºäº`summary_all.csv`çš„å®é™…æ•°æ®
2. **ä¿å®ˆä½™é‡**: `needed + 1`ç¡®ä¿è¾¾æ ‡
3. **å»é‡ä¿æŠ¤**: å¯ç”¨å»é‡æœºåˆ¶é¿å…é‡å¤
4. **é˜¶æ®µéªŒè¯**: æ¯é˜¶æ®µå®Œæˆåæ£€æŸ¥ç»“æœ

---

**ä¼˜åŒ–è€…**: Green (Claude Code)
**å®Œæˆæ—¶é—´**: 2025-12-03
**çŠ¶æ€**: âœ… å°±ç»ªï¼Œå¯å¼€å§‹æ‰§è¡Œ
