# Stage11è¡¥å……æ‰§è¡Œè®¡åˆ’

**æ—¥æœŸ**: 2025-12-08
**ç‰ˆæœ¬**: v4.7.2
**é…ç½®æ–‡ä»¶**: `settings/stage11_supplement_parallel_hrnet18.json`
**ç­–ç•¥**: æ–¹æ¡ˆA - ç²¾ç¡®æ§åˆ¶

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### ç›®æ ‡
è¡¥å……Stage11ç¼ºå¤±çš„16ä¸ªå®éªŒï¼Œç¡®ä¿æ¯ä¸ªå‚æ•°ç²¾ç¡®è¾¾åˆ°5ä¸ªå”¯ä¸€å€¼ã€‚

### å…³é”®æ•°æ®
- **å½“å‰çŠ¶æ€**: æ¯ä¸ªå‚æ•°1ä¸ªå”¯ä¸€å€¼ï¼ˆ2025-12-07å®Œæˆï¼‰
- **ç›®æ ‡çŠ¶æ€**: æ¯ä¸ªå‚æ•°5ä¸ªå”¯ä¸€å€¼
- **éœ€è¡¥å……**: æ¯ä¸ªå‚æ•°4ä¸ªæ–°å€¼
- **æ€»å®éªŒæ•°**: 16ä¸ªï¼ˆ4å‚æ•° Ã— 4æ¬¡ï¼‰
- **é¢„è®¡æ—¶é—´**: ~22.88å°æ—¶

---

## ğŸ“Š å½“å‰å·²å®Œæˆæ•°æ®

### Stage11å·²æœ‰å”¯ä¸€å€¼ï¼ˆ2025-12-07ï¼‰

| å‚æ•° | å½“å‰å”¯ä¸€å€¼æ•° | å·²æœ‰å€¼ | æ¥æºå®éªŒID |
|-----|------------|--------|-----------|
| epochs | 1 | 53 | hrnet18_001_parallel |
| learning_rate | 1 | 0.030180 | hrnet18_002_parallel |
| seed | 1 | 6621 | hrnet18_003_parallel |
| dropout | 1 | 0.543581 | hrnet18_004_parallel |

**æ•°æ®æ¥æº**: `results/run_20251207_155242/summary.csv` (è¡Œ2-5)

---

## ğŸ¯ é…ç½®è¯¦æƒ…

### æ–°é…ç½®æ–‡ä»¶å‚æ•°

```json
{
  "comment": "Stage11è¡¥å……: ç²¾ç¡®è¡¥å……æ¯ä¸ªå‚æ•°4ä¸ªå”¯ä¸€å€¼",
  "version": "4.7.2",
  "estimated_experiments": 16,
  "estimated_duration_hours": 22.88,
  "experiments": [
    {
      "mode": "parallel",
      "foreground": {
        "repo": "Person_reID_baseline_pytorch",
        "model": "hrnet18",
        "mode": "mutation",
        "mutate": ["epochs"]  // æˆ– learning_rate, seed, dropout
      },
      "background": {
        "repo": "Person_reID_baseline_pytorch",
        "model": "densenet121"
      },
      "runs_per_config": 4  // â† å…³é”®ï¼šè¡¥å……4ä¸ªè€Œé5ä¸ª
    }
  ]
}
```

### å…³é”®è®¾è®¡å†³ç­–

#### 1. `runs_per_config: 4` çš„åŸå› 
- **å·²æœ‰**: æ¯ä¸ªå‚æ•°1ä¸ªå”¯ä¸€å€¼
- **ç›®æ ‡**: æ¯ä¸ªå‚æ•°5ä¸ªå”¯ä¸€å€¼
- **éœ€è¡¥å……**: 5 - 1 = **4ä¸ª**
- **é…ç½®**: `runs_per_config: 4` âœ…

#### 2. å»é‡æœºåˆ¶ä¿æŠ¤
- **å¯ç”¨**: `use_deduplication: true`
- **å†å²æ•°æ®**: `historical_csvs: ["results/summary_all.csv"]`
- **ä¿æŠ¤æ•ˆæœ**:
  - å¦‚æœéšæœºç”Ÿæˆå·²æœ‰å€¼ï¼ˆå¦‚epochs=53ï¼‰ï¼Œè‡ªåŠ¨è·³è¿‡
  - ç¢°æ’æ¦‚ç‡: <0.1%ï¼ˆæä½ï¼‰
  - å³ä½¿ç¢°æ’ï¼Œä¼šé‡æ–°å°è¯•ç”Ÿæˆæ–°å€¼

#### 3. v4.7.2ä¿®å¤éªŒè¯
- **ä¿®å¤å†…å®¹**: å¹¶è¡Œæ¨¡å¼æ­£ç¡®è¯»å–outer-level `runs_per_config`
- **éªŒè¯**: `tests/test_parallel_runs_per_config_fix.py` å…¨éƒ¨é€šè¿‡
- **ä¿è¯**: æ¯ä¸ªé…ç½®è¿è¡Œ4æ¬¡ï¼ˆè€Œéä¹‹å‰çš„1æ¬¡bugï¼‰

---

## ğŸ”„ æ‰§è¡Œæµç¨‹

### æ­¥éª¤1: éªŒè¯é…ç½®

```bash
# 1. éªŒè¯JSONæ ¼å¼
python3 -m json.tool settings/stage11_supplement_parallel_hrnet18.json

# 2. éªŒè¯runs_per_configå®šä¹‰
python3 scripts/verify_stage_configs.py
```

**é¢„æœŸè¾“å‡º**: æ‰€æœ‰éªŒè¯é€šè¿‡ âœ…

---

### æ­¥éª¤2: æ‰§è¡Œè¡¥å……å®éªŒ

```bash
# ä½¿ç”¨v4.7.2ä¿®å¤åçš„ä»£ç æ‰§è¡Œ
sudo -E python3 mutation.py -ec settings/stage11_supplement_parallel_hrnet18.json
```

**æ‰§è¡Œæ—¶é—´**:
- å¼€å§‹æ—¶é—´: è®°å½•
- é¢„è®¡å®Œæˆ: å¼€å§‹æ—¶é—´ + ~23å°æ—¶
- å®é™…å®Œæˆ: (å¾…å¡«å†™)

---

### æ­¥éª¤3: éªŒè¯ç»“æœ

æ‰§è¡Œå®Œæˆåï¼ŒéªŒè¯æ•°æ®å®Œæ•´æ€§ï¼š

```bash
# 1. æ£€æŸ¥æ–°å¢å®éªŒæ•°é‡
python3 -c "
import csv
with open('results/summary_all.csv') as f:
    rows = list(csv.DictReader(f))
    hrnet18_parallel = [r for r in rows if 'hrnet18' in r.get('model', '') and 'parallel' in r.get('experiment_id', '')]
    print(f'Total hrnet18 parallel experiments: {len(hrnet18_parallel)}')
    print(f'Expected: 20 (4 old + 16 new)')
"

# 2. æ£€æŸ¥æ¯ä¸ªå‚æ•°å”¯ä¸€å€¼æ•°é‡
python3 scripts/check_unique_values.py \
  --repo Person_reID_baseline_pytorch \
  --model hrnet18 \
  --mode parallel
```

**é¢„æœŸç»“æœ**:
- æ€»å®éªŒæ•°: 20ä¸ª (4å·²æœ‰ + 16æ–°å¢)
- epochså”¯ä¸€å€¼: 5ä¸ª
- learning_rateå”¯ä¸€å€¼: 5ä¸ª
- seedå”¯ä¸€å€¼: 5ä¸ª
- dropoutå”¯ä¸€å€¼: 5ä¸ª

---

## âœ… æˆåŠŸæ ‡å‡†

### æ•°æ®å®Œæ•´æ€§
- [ ] CSVæ ¼å¼: 37åˆ—æ ‡å‡†æ ¼å¼
- [ ] å®éªŒæ•°é‡: 16ä¸ªæ–°å®éªŒ
- [ ] è®­ç»ƒæˆåŠŸç‡: 100% (16/16)
- [ ] èƒ½è€—æ•°æ®: CPU+GPUæ•°æ®å®Œæ•´

### å‚æ•°è¦†ç›–
- [ ] epochs: 5ä¸ªå”¯ä¸€å€¼ (1å·²æœ‰ + 4æ–°å¢)
- [ ] learning_rate: 5ä¸ªå”¯ä¸€å€¼ (1å·²æœ‰ + 4æ–°å¢)
- [ ] seed: 5ä¸ªå”¯ä¸€å€¼ (1å·²æœ‰ + 4æ–°å¢)
- [ ] dropout: 5ä¸ªå”¯ä¸€å€¼ (1å·²æœ‰ + 4æ–°å¢)

### å»é‡éªŒè¯
- [ ] å·²æœ‰å€¼æœªé‡å¤: epochsâ‰ 53, lrâ‰ 0.030180, seedâ‰ 6621, dropoutâ‰ 0.543581
- [ ] æ–°å€¼å”¯ä¸€æ€§: 16ä¸ªæ–°å€¼äº’ä¸é‡å¤

---

## ğŸ“ˆ é¢„æœŸç»“æœ

### å®éªŒæ•°é‡å¯¹æ¯”

| ç±»åˆ« | Stage11åŸè®¡åˆ’ | Stage11å®é™…(Bug) | è¡¥å……è®¡åˆ’ | æœ€ç»ˆæ€»è®¡ |
|-----|--------------|-----------------|---------|---------|
| é…ç½®é¡¹ | 4 | 4 | 4 | 4 |
| runs_per_config | 5 | 1 (bug) | 4 | - |
| å®éªŒæ•° | 20 | 4 | 16 | 20 âœ… |
| ç”¨æ—¶ | 28.6h | 5.42h | 22.88h | 28.3h |

### å‚æ•°å”¯ä¸€å€¼å¯¹æ¯”

| å‚æ•° | å½“å‰ | è¡¥å……å | ç›®æ ‡ | è¾¾æ ‡ |
|-----|-----|--------|-----|-----|
| epochs | 1 | 5 | 5 | âœ… |
| learning_rate | 1 | 5 | 5 | âœ… |
| seed | 1 | 5 | 5 | âœ… |
| dropout | 1 | 5 | 5 | âœ… |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å»é‡ç¢°æ’å¤„ç†
**æä½æ¦‚ç‡åœºæ™¯**: å¦‚æœéšæœºç”Ÿæˆæ°å¥½ç­‰äºå·²æœ‰å€¼

**ç¤ºä¾‹**:
```
å°è¯•1: ç”Ÿæˆ epochs=53 â†’ æ£€æŸ¥å»é‡ â†’ å·²å­˜åœ¨ï¼â†’ è·³è¿‡
å°è¯•2: ç”Ÿæˆ epochs=47 â†’ æ£€æŸ¥å»é‡ â†’ ä¸å­˜åœ¨ â†’ æ¥å— âœ…
```

**ä¿éšœ**:
- ä»£ç æ”¯æŒæœ€å¤š1000æ¬¡å°è¯• (`MAX_MUTATION_ATTEMPTS`)
- ç¢°æ’æ¦‚ç‡: epochs <0.5%, learning_rate <0.01%, seed <0.01%, dropout <1%
- è¶³å¤Ÿçš„å°è¯•æ¬¡æ•°ä¿è¯èƒ½ç”Ÿæˆ4ä¸ªæ–°å€¼

### 2. æ—¶é—´ä¼°ç®—è¯¯å·®
**é¢„è®¡æ—¶é—´**: 22.88å°æ—¶ (16å®éªŒ Ã— 1.43å°æ—¶/å®éªŒ)

**å¯èƒ½åå·®**:
- Â±10%: 20.6 - 25.2å°æ—¶
- åŸå› : epochså˜å¼‚ä¼šå½±å“è®­ç»ƒæ—¶é—´ï¼ˆ0.5Ã—æ›´å¿«ï¼Œ1.5Ã—æ›´æ…¢ï¼‰

### 3. æ•°æ®å¤‡ä»½
**æ‰§è¡Œå‰å¤‡ä»½**:
```bash
cp results/summary_all.csv results/summary_all.csv.backup_20251208
```

### 4. ç›‘æ§å»ºè®®
**å®æ—¶ç›‘æ§**:
```bash
# æŸ¥çœ‹æœ€æ–°ç»“æœ
tail -f results/run_*/summary.csv

# æ£€æŸ¥è¿›åº¦
watch -n 60 'ls -lt results/run_* | head -5'
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Stage11 Bugä¿®å¤æŠ¥å‘Š](../docs/results_reports/STAGE11_BUG_FIX_REPORT.md)
- [å»é‡ä¸éšæœºå˜å¼‚åˆ†æ](../docs/results_reports/DEDUPLICATION_RANDOM_MUTATION_ANALYSIS.md)
- [å¹¶è¡Œæ¨¡å¼runs_per_configæµ‹è¯•](../tests/test_parallel_runs_per_config_fix.py)
- [Stageé…ç½®éªŒè¯æŠ¥å‘Š](../docs/results_reports/STAGE_CONFIG_VERIFICATION_REPORT.md)

---

## ğŸ“ æ•…éšœæ’æŸ¥

### é—®é¢˜1: å®éªŒå°‘äº16ä¸ª
**ç—‡çŠ¶**: å®Œæˆååªæœ‰12ä¸ªå®éªŒ

**å¯èƒ½åŸå› **:
1. Bugæœªä¿®å¤ - æ£€æŸ¥ä»£ç ç‰ˆæœ¬æ˜¯å¦v4.7.2
2. é…ç½®é”™è¯¯ - æ£€æŸ¥`runs_per_config`ä½ç½®

**è§£å†³**:
```bash
# æ£€æŸ¥ç‰ˆæœ¬
grep "v4.7.2" CLAUDE.md

# æ£€æŸ¥é…ç½®
grep -n "runs_per_config" settings/stage11_supplement_parallel_hrnet18.json
```

### é—®é¢˜2: å‚æ•°å€¼é‡å¤
**ç—‡çŠ¶**: ç”Ÿæˆäº†å·²æœ‰çš„epochs=53

**å¯èƒ½åŸå› **:
1. å»é‡æœªå¯ç”¨
2. historical_csvsè·¯å¾„é”™è¯¯

**è§£å†³**:
```bash
# æ£€æŸ¥å»é‡é…ç½®
grep "use_deduplication" settings/stage11_supplement_parallel_hrnet18.json

# æ£€æŸ¥CSVæ–‡ä»¶å­˜åœ¨
ls -lh results/summary_all.csv
```

### é—®é¢˜3: è®­ç»ƒå¤±è´¥
**ç—‡çŠ¶**: æŸäº›å®éªŒè®­ç»ƒå¤±è´¥

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹æ—¥å¿—
cat results/run_*/experiment.log

# æ£€æŸ¥é”™è¯¯
grep -i "error\|failed" results/run_*/experiment.log
```

---

## ğŸ“Œ æ‰§è¡Œæ£€æŸ¥æ¸…å•

### æ‰§è¡Œå‰
- [ ] ä»£ç ç‰ˆæœ¬ç¡®è®¤: v4.7.2
- [ ] é…ç½®æ–‡ä»¶éªŒè¯: JSONæ ¼å¼æ­£ç¡®
- [ ] æ•°æ®å¤‡ä»½: summary_all.csvå·²å¤‡ä»½
- [ ] ç£ç›˜ç©ºé—´: >100GBå¯ç”¨
- [ ] GPUå¯ç”¨: nvidia-smiæ­£å¸¸

### æ‰§è¡Œä¸­
- [ ] å¼€å§‹æ—¶é—´è®°å½•
- [ ] é¦–ä¸ªå®éªŒæˆåŠŸå®Œæˆ
- [ ] ç›‘æ§è¿›åº¦ï¼ˆæ¯4å°æ—¶æ£€æŸ¥ä¸€æ¬¡ï¼‰
- [ ] CPU/GPUèƒ½è€—æ•°æ®æ­£å¸¸

### æ‰§è¡Œå
- [ ] å®Œæˆæ—¶é—´è®°å½•
- [ ] å®éªŒæ•°é‡: 16ä¸ª âœ…
- [ ] æ•°æ®å®Œæ•´æ€§éªŒè¯
- [ ] å‚æ•°å”¯ä¸€å€¼éªŒè¯: æ¯ä¸ª5ä¸ª
- [ ] æ›´æ–°summary_all.csvç»Ÿè®¡

---

**åˆ›å»ºè€…**: Green + Claude
**æ—¥æœŸ**: 2025-12-08
**çŠ¶æ€**: âœ… å‡†å¤‡æ‰§è¡Œ
**ä¸‹ä¸€æ­¥**: æ‰§è¡Œ `sudo -E python3 mutation.py -ec settings/stage11_supplement_parallel_hrnet18.json`
