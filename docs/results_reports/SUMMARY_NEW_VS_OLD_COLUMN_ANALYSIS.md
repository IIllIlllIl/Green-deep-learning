# summary_new.csv (80列) vs summary_old.csv (93列) 列对比分析

**日期**: 2025-12-12
**分析目标**: 确定93列格式相比80列格式多出的13列，并判断能否从新实验的JSON中提取

---

## 📊 数据概况

| 文件 | 列数 | 行数 | 说明 |
|------|------|------|------|
| `summary_old.csv` | 93列 | 211行 | 老实验数据（已重建为93列格式） |
| `summary_new.csv` | 80列 | 265行 | 新实验数据（当前格式） |

---

## ❌ 缺失的13列

summary_new.csv相比summary_old.csv缺少以下13列：

### 1. 背景超参数字段 (6列)
```
bg_hyperparam_batch_size
bg_hyperparam_dropout
bg_hyperparam_epochs
bg_hyperparam_learning_rate
bg_hyperparam_seed
bg_hyperparam_weight_decay
```

### 2. 背景能耗字段 (7列)
```
bg_energy_cpu_pkg_joules
bg_energy_cpu_ram_joules
bg_energy_cpu_total_joules
bg_energy_gpu_avg_watts
bg_energy_gpu_max_watts
bg_energy_gpu_min_watts
bg_energy_gpu_total_joules
```

### 3. 注意
- `bg_log_directory` 列在对比中出现，但这可能是因为summary_new.csv已经有`bg_note`和`bg_log_directory`的某一个
- 实际上summary_new.csv最后一列是`bg_log_directory`，所以实际缺失的是13列

---

## ✅ 数据可提取性分析

### 背景超参数 (6列) - **无需记录（设计改进）**

**设计变更**: 新实验优化了数据记录逻辑
- **老实验**: 记录了部分背景超参数（但意义不大）
- **新实验**: 背景模型使用默认值，不记录超参数（更合理）

**实际检查结果**:
- 新实验总并行实验: 130个
- 背景超参数记录: 0个 (**0.0%** - 这是正确的)
- 所有`background.hyperparameters`都是空字典`{}`

**原因**:
- 背景训练仅作为GPU负载，使用默认超参数配置
- 记录默认值没有实际意义
- 减少数据冗余，提高可维护性

**实际JSON结构**:
```json
{
  "background": {
    "repository": "examples",
    "model": "mnist",
    "hyperparameters": {},  // 使用默认值，无需记录
    "log_directory": "/path/to/logs",
    "note": "Background training served as GPU load only (not monitored)"
  }
}
```

**结论**: ✅ **设计决定 - 无需记录（新实验的改进）**

### 背景能耗 (7列) - **监控全局能耗（设计决定）**

**设计决定**: 监控全局能耗，不单独拆分背景训练能耗

**原因**:
- **能耗监控粒度**: 监控的是整个系统的能耗（CPU + GPU全局）
- **并行实验**: 前景训练+背景训练同时运行
- **全局能耗**: 前景实验记录的能耗数据**已包含前景+背景的总能耗**
- **无需拆分**: 无法也无需单独测量背景训练的能耗
- **研究重点**: 关注前景模型的训练，背景仅作为GPU负载

**JSON结构**: `background`字段中**没有**`energy_metrics`

**示例**:
```json
{
  "foreground": {
    "energy_metrics": {
      "cpu_energy_total_joules": 681.62,
      "gpu_energy_total_joules": 3293.6,
      // ⚠️ 这些能耗数据包含了前景+背景的总能耗
      ...
    }
  },
  "background": {
    // 没有 energy_metrics 字段（正确设计）
    "note": "Background training served as GPU load only (not monitored)"
  }
}
```

**结论**: ✅ **设计决定 - 监控全局能耗，无需单独记录背景能耗**

---

## 📋 总结

### 缺失列统计
- **总缺失**: 13列
- **可提取**: 0列 (0%)
- **无需记录**: 13列 (100%) - **这是正确的设计**
  - 背景超参数 (6列): 使用默认值，无需记录
  - 背景能耗 (7列): 监控全局能耗，无需拆分

### 数据完整性影响

#### ✅ 新实验vs老实验的设计改进

**老实验 (summary_old.csv, 93列)**:
- 211个实验，105个并行模式
- 并行实验有部分背景超参数数据（但意义不大）
- 背景能耗全部为空（设计决定）

**新实验 (summary_new.csv, 80列)** - **改进版本**:
- 265个实验，130个并行模式
- **背景超参数不记录**（使用默认值，减少冗余）
- **背景能耗不记录**（监控全局能耗即可）
- **数据更精简**: 只记录有意义的数据

#### 💡 设计理由
新实验优化了数据记录策略：
1. **背景训练使用默认超参数** - 记录默认值没有意义
2. **能耗监控是全局的** - 前景能耗已包含前景+背景总能耗
3. **减少数据冗余** - 提高数据质量和可维护性
4. **研究重点明确** - 关注前景模型，背景仅作GPU负载

### 建议的处理方案

#### 方案A: 保持80列格式 ⭐⭐⭐ **推荐**
- **优点**:
  - ✅ 符合新实验的设计理念（精简数据）
  - ✅ 不引入无意义的空列
  - ✅ 80列已包含所有核心数据（前景模型完整信息）
  - ✅ 13个"缺失"列本就不应该存在（设计改进）
- **缺点**:
  - ⚠️ 与老实验的93列格式不一致
- **适用场景**:
  - 新老实验分别分析和使用
  - 强调数据质量优于格式统一

#### 方案B: 扩展为93列格式 ⭐
- **优点**:
  - ✅ 与老实验格式统一
  - ✅ 便于合并分析（如需要）
- **缺点**:
  - ❌ 13列全部为空（无实际数据）
  - ❌ 违背新实验的设计理念（引入冗余）
  - ❌ 可能误导数据使用者（空列看起来像数据丢失）
- **实现方式**:
  - 创建脚本添加13个空列
  - 保持原80列数据不变
- **适用场景**:
  - 必须合并新老实验数据
  - 分析工具强制要求统一格式

#### 方案C: 不做处理（长期最优）⭐⭐
- **说明**: 保持新老实验格式差异，这反映了设计的演进
- **优点**:
  - ✅ 尊重历史数据和设计演进
  - ✅ 新实验使用改进的80列格式
  - ✅ 老实验保持93列格式（记录历史）
- **影响**:
  - 需要分析工具能处理两种格式
  - 文档中需要清楚说明差异原因

---

## 🎯 最终建议

### 对于当前的summary_new.csv

**推荐方案A**: 保持80列格式 ⭐⭐⭐

**理由**:
1. ✅ **符合设计理念**: 新实验优化了数据记录，80列是改进后的格式
2. ✅ **数据质量优先**: 不引入无意义的空列
3. ✅ **反映演进**: 格式差异体现了项目的设计改进过程
4. ✅ **实用主义**: 80列包含所有必要数据，满足分析需求

**不推荐扩展为93列的原因**:
- ❌ 违背设计初衷（精简数据）
- ❌ 引入13个永久为空的列
- ❌ 可能误导使用者（空列看起来像数据缺失）

**文档要求**:
- 在README.md和CLAUDE.md中明确说明：
  - 老实验 (summary_old.csv): 93列格式（历史版本）
  - 新实验 (summary_new.csv): 80列格式（改进版本）
  - 格式差异原因：背景超参数和能耗无需记录

**如需合并分析**:
- 使用分析脚本处理两种格式
- 或创建一个临时的统一格式（仅用于特定分析）
- 不修改源数据文件

---

## 🔄 下一步行动

### 推荐行动（基于方案A）
1. ✅ **已完成**: 分析80列vs93列差异
2. ✅ **已完成**: 确认13列的设计合理性
3. ✅ **已完成**: 生成详细分析报告
4. ⏭️ **待执行**: 更新README.md说明新老实验格式差异
5. ⏭️ **待执行**: 更新CLAUDE.md记录设计决定
6. ✅ **结论**: 保持summary_new.csv为80列格式（无需修改）

### 不推荐的行动
- ❌ 创建添加空列的脚本
- ❌ 生成summary_new_93col.csv
- ❌ "修复"背景超参数记录（实际上是退步）

---

**最终结论**:
- ✅ **80列vs93列差异是设计改进，不是缺陷**
- ✅ 13个"缺失"列的设计理由：
  - 6个bg_hyperparam列: 背景使用默认值，无需记录
  - 7个bg_energy列: 监控全局能耗，无需拆分
- ✅ **推荐保持80列格式**，体现数据精简的设计理念
- 📝 **需要文档说明**: 在README.md和CLAUDE.md中解释格式差异原因
