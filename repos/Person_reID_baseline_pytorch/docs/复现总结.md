# Person ReID Baseline å¤ç°æ€»ç»“æŠ¥å‘Š

## 1. é¡¹ç›®ä¿¡æ¯

**é¡¹ç›®åç§°**: Person_reID_baseline_pytorch
**é¡¹ç›®ç±»å‹**: è¡Œäººé‡è¯†åˆ« (Person Re-identification)
**æ¡†æ¶**: PyTorch
**æ•°æ®é›†**: Market-1501

## 2. ç¯å¢ƒé…ç½®æ€»ç»“

### 2.1 ç¡¬ä»¶ç¯å¢ƒ
- **GPU**: NVIDIA GeForce RTX 3080 (10GB VRAM)
- **CUDA Version**: 12.2
- **Driver Version**: 535.183.01

### 2.2 è½¯ä»¶ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Linux 6.2.0-39-generic
- **Pythonç‰ˆæœ¬**: 3.10
- **Condaç¯å¢ƒ**: reid_baseline
- **PyTorchç‰ˆæœ¬**: 2.5.1+cu121
- **Torchvisionç‰ˆæœ¬**: 0.20.1+cu121

### 2.3 ä¾èµ–åŒ…
å·²å®‰è£…ä»¥ä¸‹å…³é”®ä¾èµ–ï¼š
- pyyaml
- pretrainedmodels
- timm >= 0.6.0
- scipy
- efficientnet_pytorch
- pytorch_metric_learning
- tqdm
- gdown
- matplotlib

## 3. æ•°æ®é›†å‡†å¤‡

### 3.1 æ•°æ®é›†ä¿¡æ¯
- **åç§°**: Market-1501
- **ç‰ˆæœ¬**: v15.09.15
- **ä¸‹è½½è·¯å¾„**: `/home/green/energy_dl/test/Market/Market-1501-v15.09.15`
- **å‹ç¼©åŒ…å¤§å°**: 153 MB

### 3.2 æ•°æ®é›†ç»Ÿè®¡
| æ•°æ®å­é›† | ç±»åˆ«æ•° | å›¾ç‰‡æ•° |
|---------|--------|--------|
| è®­ç»ƒé›† (train_all) | 751 | 12,936 |
| æŸ¥è¯¢é›† (query) | 750 | 3,368 |
| Gallery | 752 | 19,732 |

### 3.3 æ•°æ®å‡†å¤‡çŠ¶æ€
âœ“ æ•°æ®é›†å·²ä¸‹è½½
âœ“ æ•°æ®é›†å·²è§£å‹
âœ“ æ•°æ®é›†å·²é€šè¿‡`prepare.py`è½¬æ¢ä¸ºPyTorchæ ¼å¼

## 4. æ¨¡å‹è®­ç»ƒé…ç½®

### 4.1 æ”¯æŒçš„æ¨¡å‹æ¶æ„
æœ¬ä»“åº“æ”¯æŒä»¥ä¸‹æ¨¡å‹æ¶æ„ï¼š
1. ResNet-50 / ResNet-50-ibn
2. DenseNet-121
3. EfficientNet-b4
4. HRNet-18
5. Swin Transformer / Swin Transformer V2
6. ConvNeXt
7. PCB (Part-based Convolutional Baseline)

### 4.2 æ¨èè®­ç»ƒé…ç½®

#### é…ç½®1: å¿«é€ŸéªŒè¯ï¼ˆæ¨èé¦–æ¬¡ä½¿ç”¨ï¼‰
```bash
bash scripts/quick_train_test.sh
```
- **è®­ç»ƒæ—¶é•¿**: 20-30åˆ†é’Ÿ
- **é¢„æœŸæ€§èƒ½**: Rank@1 â‰ˆ 85-87%, mAP â‰ˆ 65-68%
- **é…ç½®**: ResNet-50, batch_size=16, epochs=20, bf16
- **ç”¨é€”**: å¿«é€ŸéªŒè¯ç¯å¢ƒå’Œæ•°æ®é›†

#### é…ç½®2: æ ‡å‡†Baseline
```bash
bash scripts/baseline_train_test.sh
```
- **è®­ç»ƒæ—¶é•¿**: 1-1.5å°æ—¶
- **é¢„æœŸæ€§èƒ½**: Rank@1 â‰ˆ 88.84%, mAP â‰ˆ 71.59%
- **é…ç½®**: ResNet-50, batch_size=32, epochs=60
- **ç”¨é€”**: å¤ç°READMEä¸­æŠ¥å‘Šçš„baselineæ€§èƒ½

#### é…ç½®3: é«˜æ€§èƒ½ï¼ˆæ‰€æœ‰ä¼˜åŒ–æŠ€å·§ï¼‰
```bash
bash scripts/high_performance_train_test.sh
```
- **è®­ç»ƒæ—¶é•¿**: 2-3å°æ—¶
- **é¢„æœŸæ€§èƒ½**: Rank@1 â‰ˆ 92.13%, mAP â‰ˆ 79.84%
- **é…ç½®**: ResNet-50 + warm_epoch + stride=1 + random_erasing + circle_loss
- **ç”¨é€”**: è·å¾—æœ€ä½³æ€§èƒ½

## 5. è®­ç»ƒæ—¶é•¿ä¼°è®¡

åŸºäºRTX 3080 (10GB VRAM)çš„è¯¦ç»†è®­ç»ƒæ—¶é•¿ä¼°è®¡ï¼š

| æ¨¡å‹ | Batch Size | Epochs | é¢„è®¡æ—¶é•¿ | æ¯Epochæ—¶é•¿ | é¢„æœŸRank@1 | é¢„æœŸmAP |
|------|-----------|--------|----------|------------|-----------|---------|
| ResNet-50 | 32 | 60 | 1-1.5h | 1-1.5min | 88.84% | 71.59% |
| ResNet-50 | 16 | 30 | 0.5-0.7h | 1-1.4min | ~85% | ~67% |
| ResNet-50 | 16 | 20 | 0.3-0.5h | 1-1.5min | ~84% | ~65% |
| ResNet-50 (tricks) | 8 | 60 | 2-3h | 2-3min | 92.13% | 79.84% |
| ResNet-50 (bf16) | 32 | 60 | 1-1.5h | 1-1.5min | 88% | 71% |
| DenseNet-121 | 32 | 60 | 1.5-2h | 1.5-2min | 90.17% | 74.02% |
| PCB | 64 | 60 | 2-2.5h | 2-2.5min | 92.64% | 77.47% |

**æ³¨**: å®é™…è®­ç»ƒæ—¶é•¿ä¼šå—åˆ°ä»¥ä¸‹å› ç´ å½±å“ï¼š
- CPUæ€§èƒ½ï¼ˆæ•°æ®åŠ è½½é€Ÿåº¦ï¼‰
- ç£ç›˜I/Oé€Ÿåº¦
- æ˜¯å¦ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
- æ•°æ®å¢å¼ºçš„å¤æ‚åº¦

## 6. è®­ç»ƒæ—¶é•¿ä¼˜åŒ–å»ºè®®

### 6.1 å¦‚æœè®­ç»ƒæ—¶é•¿è¶…è¿‡2å°æ—¶

#### æ–¹æ¡ˆ1: å‡å°‘è®­ç»ƒè½®æ•°ï¼ˆæ¨èï¼‰
- **æ“ä½œ**: å°†epochsä»60å‡å°‘åˆ°30-40
- **æ—¶é—´èŠ‚çœ**: 50%
- **æ€§èƒ½å½±å“**: è½»å¾®ï¼ˆçº¦1-2%ï¼‰
- **å‘½ä»¤**: æ·»åŠ  `--total_epoch 30`

#### æ–¹æ¡ˆ2: ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
- **æ“ä½œ**: å¯ç”¨bf16æˆ–fp16
- **æ—¶é—´èŠ‚çœ**: 10-20%
- **æ€§èƒ½å½±å“**: æå°
- **é¢å¤–ä¼˜åŠ¿**: å‡å°‘50%æ˜¾å­˜å ç”¨
- **å‘½ä»¤**: æ·»åŠ  `--bf16` æˆ– `--fp16`

#### æ–¹æ¡ˆ3: å‡å°Batch Size
- **æ“ä½œ**: å°†batch_sizeä»32å‡å°‘åˆ°16
- **æ—¶é—´èŠ‚çœ**: 30-40%
- **æ€§èƒ½å½±å“**: è½»å¾®ï¼ˆéœ€è°ƒæ•´å­¦ä¹ ç‡ï¼‰
- **å‘½ä»¤**: `--batchsize 16 --lr 0.035`

#### æ–¹æ¡ˆ4: ç»¼åˆä¼˜åŒ–ï¼ˆæœ€æ¿€è¿›ï¼‰
```bash
python train.py --gpu_ids 0 --name quick_test \
    --train_all --batchsize 16 --total_epoch 20 --bf16 \
    --data_dir ../Market/Market-1501-v15.09.15/pytorch
```
- **è®­ç»ƒæ—¶é•¿**: < 30åˆ†é’Ÿ
- **é¢„æœŸæ€§èƒ½**: Rank@1 â‰ˆ 84-86%, mAP â‰ˆ 64-67%

### 6.2 è®­ç»ƒæ—¶é•¿å»ºè®®çŸ©é˜µ

| å¯æ¥å—è®­ç»ƒæ—¶é•¿ | æ¨èé…ç½® | é¢„æœŸæ€§èƒ½ (Rank@1) |
|--------------|---------|-----------------|
| < 30åˆ†é’Ÿ | é…ç½®1 (quick) | 84-86% |
| 30åˆ†é’Ÿ - 1å°æ—¶ | epochs=30, bf16 | 86-88% |
| 1-1.5å°æ—¶ | æ ‡å‡†baseline | 88-89% |
| 1.5-2å°æ—¶ | DenseNet-121 | 90% |
| 2-3å°æ—¶ | æ‰€æœ‰tricks | 92% |

## 7. æ€§èƒ½å¯¹æ¯”å‚è€ƒ

### 7.1 READMEæŠ¥å‘Šçš„æ€§èƒ½
| æ¨¡å‹ | Rank@1 | mAP |
|------|--------|-----|
| ResNet-50 | 88.84% | 71.59% |
| ResNet-50 (all tricks) | 92.13% | 79.84% |
| DenseNet-121 | 90.17% | 74.02% |
| DenseNet-121 (Circle) | 91.00% | 76.54% |
| PCB | 92.64% | 77.47% |
| Swin | 94.12% | 84.39% |

### 7.2 åŸè®ºæ–‡baselineç»“æœ
- Rank@1: 88.24%
- mAP: 70.68%

**å¤ç°ç›®æ ‡**: è¾¾åˆ°æˆ–è¶…è¿‡åŸè®ºæ–‡æ€§èƒ½ï¼ˆ88.24% / 70.68%ï¼‰

## 8. è®­ç»ƒå’Œæµ‹è¯•æµç¨‹

### 8.1 ä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
# æ­¥éª¤1: éªŒè¯ç¯å¢ƒ
bash scripts/verify_environment.sh

# æ­¥éª¤2: é€‰æ‹©åˆé€‚çš„è®­ç»ƒé…ç½®
bash scripts/quick_train_test.sh          # å¿«é€ŸéªŒè¯
# æˆ–
bash scripts/baseline_train_test.sh       # æ ‡å‡†baseline
# æˆ–
bash scripts/high_performance_train_test.sh # é«˜æ€§èƒ½
```

### 8.2 æ‰‹åŠ¨è®­ç»ƒå’Œæµ‹è¯•
```bash
# è®­ç»ƒ
python train.py --gpu_ids 0 --name my_model \
    --train_all --batchsize 32 \
    --data_dir ../Market/Market-1501-v15.09.15/pytorch

# æµ‹è¯•
python test.py --gpu_ids 0 --name my_model \
    --test_dir ../Market/Market-1501-v15.09.15/pytorch \
    --batchsize 32 --which_epoch last

# è¯„ä¼°
python evaluate_gpu.py
```

## 9. æ–‡ä»¶å’Œè„šæœ¬è¯´æ˜

### 9.1 åˆ›å»ºçš„æ–‡ä»¶
```
Person_reID_baseline_pytorch/
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ å¤ç°æŒ‡å—.md           # è¯¦ç»†çš„å¤ç°æŒ‡å—
â”‚   â””â”€â”€ å¤ç°æ€»ç»“.md           # æœ¬æ–‡ä»¶
â””â”€â”€ scripts/
    â”œâ”€â”€ quick_train_test.sh              # å¿«é€ŸéªŒè¯è„šæœ¬
    â”œâ”€â”€ baseline_train_test.sh           # æ ‡å‡†è®­ç»ƒè„šæœ¬
    â”œâ”€â”€ high_performance_train_test.sh   # é«˜æ€§èƒ½è®­ç»ƒè„šæœ¬
    â””â”€â”€ verify_environment.sh            # ç¯å¢ƒéªŒè¯è„šæœ¬
```

### 9.2 é‡è¦çš„åŸå§‹æ–‡ä»¶
- `train.py`: è®­ç»ƒè„šæœ¬
- `test.py`: æµ‹è¯•è„šæœ¬
- `evaluate.py` / `evaluate_gpu.py`: è¯„ä¼°è„šæœ¬
- `prepare.py`: æ•°æ®å‡†å¤‡è„šæœ¬
- `model.py`: æ¨¡å‹å®šä¹‰

## 10. ä¸‹ä¸€æ­¥æ“ä½œå»ºè®®

### 10.1 ç«‹å³å¯åš
1. **ç¯å¢ƒéªŒè¯**: è¿è¡Œ `bash scripts/verify_environment.sh` ç¡®ä¿ä¸€åˆ‡å°±ç»ª
2. **å¿«é€Ÿæµ‹è¯•**: è¿è¡Œ `bash scripts/quick_train_test.sh` (20-30åˆ†é’Ÿ) éªŒè¯æµç¨‹

### 10.2 åç»­å®éªŒ
1. **å¤ç°baseline**: è¿è¡Œ `bash scripts/baseline_train_test.sh` (1-1.5å°æ—¶)
2. **å¯¹æ¯”æ€§èƒ½**: å°†ç»“æœä¸READMEæŠ¥å‘Šçš„æ€§èƒ½å¯¹æ¯”
3. **é«˜æ€§èƒ½æ¨¡å‹**: å¦‚æœéœ€è¦æ›´å¥½æ€§èƒ½ï¼Œè¿è¡Œ `bash scripts/high_performance_train_test.sh`

### 10.3 è¿›é˜¶å®éªŒ
1. å°è¯•ä¸åŒçš„æ¨¡å‹æ¶æ„ï¼ˆDenseNet, PCB, Swinç­‰ï¼‰
2. è°ƒæ•´è¶…å‚æ•°ï¼ˆå­¦ä¹ ç‡ã€batch sizeã€warm-upç­–ç•¥ç­‰ï¼‰
3. å°è¯•ä¸åŒçš„losså‡½æ•°ç»„åˆï¼ˆcircle, triplet, contrastç­‰ï¼‰
4. åœ¨å…¶ä»–æ•°æ®é›†ä¸Šæµ‹è¯•ï¼ˆDukeMTMC-reIDç­‰ï¼‰

## 11. å¸¸è§é—®é¢˜æ’æŸ¥

### 11.1 æ˜¾å­˜ä¸è¶³
**ç—‡çŠ¶**: CUDA out of memory
**è§£å†³æ–¹æ¡ˆ**:
- å‡å°batch size: `--batchsize 16` æˆ– `--batchsize 8`
- ä½¿ç”¨æ··åˆç²¾åº¦: `--bf16` æˆ– `--fp16`
- ä½¿ç”¨æ›´å°çš„æ¨¡å‹

### 11.2 è®­ç»ƒé€Ÿåº¦æ…¢
**ç—‡çŠ¶**: æ¯ä¸ªepochè¶…è¿‡5åˆ†é’Ÿ
**æ’æŸ¥æ­¥éª¤**:
1. æ£€æŸ¥æ˜¯å¦æ­£ç¡®ä½¿ç”¨GPU: `python -c "import torch; print(torch.cuda.is_available())"`
2. æ£€æŸ¥æ•°æ®åŠ è½½é€Ÿåº¦: å¯èƒ½æ˜¯ç£ç›˜I/Oç“¶é¢ˆ
3. å°è¯•ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ: `--bf16`

### 11.3 æ€§èƒ½ä¸è¾¾é¢„æœŸ
**ç—‡çŠ¶**: æœ€ç»ˆRank@1 < 85%
**æ’æŸ¥æ­¥éª¤**:
1. ç¡®è®¤è®­ç»ƒäº†è¶³å¤Ÿçš„epochsï¼ˆè‡³å°‘40+ï¼‰
2. æ£€æŸ¥æ•°æ®é›†æ˜¯å¦æ­£ç¡®å‡†å¤‡
3. æ£€æŸ¥å­¦ä¹ ç‡è®¾ç½®æ˜¯å¦åˆç†
4. å°è¯•ä½¿ç”¨warm-up: `--warm_epoch 5`

## 12. è”ç³»å’Œæ”¯æŒ

- **åŸé¡¹ç›®GitHub**: https://github.com/layumi/Person_reID_baseline_pytorch
- **é—®é¢˜åé¦ˆ**: æŸ¥çœ‹åŸé¡¹ç›®çš„Issuesé¡µé¢
- **æ–‡æ¡£**: å‚è€ƒ `docs/å¤ç°æŒ‡å—.md` è·å–æ›´è¯¦ç»†ä¿¡æ¯

## 13. æ€»ç»“

æœ¬é¡¹ç›®å·²å®Œæˆä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼š

âœ… **ç¯å¢ƒé…ç½®**
- Condaç¯å¢ƒå·²åˆ›å»ºå¹¶é…ç½®å®Œæˆ
- PyTorch 2.5.1 + CUDA 12.1 å·²å®‰è£…
- æ‰€æœ‰ä¾èµ–åŒ…å·²å®‰è£…

âœ… **æ•°æ®é›†å‡†å¤‡**
- Market-1501æ•°æ®é›†å·²ä¸‹è½½ (153MB)
- æ•°æ®é›†å·²è½¬æ¢ä¸ºPyTorchæ ¼å¼
- æ•°æ®ç»Ÿè®¡ï¼š751ç±»ï¼Œ12,936å¼ è®­ç»ƒå›¾ç‰‡

âœ… **è®­ç»ƒè„šæœ¬**
- 3ä¸ªé¢„é…ç½®çš„è®­ç»ƒè„šæœ¬ï¼ˆå¿«é€Ÿ/æ ‡å‡†/é«˜æ€§èƒ½ï¼‰
- ç¯å¢ƒéªŒè¯è„šæœ¬
- å®Œæ•´çš„è®­ç»ƒâ†’æµ‹è¯•â†’è¯„ä¼°æµç¨‹

âœ… **æ–‡æ¡£**
- è¯¦ç»†çš„å¤ç°æŒ‡å—
- è®­ç»ƒæ—¶é•¿ä¼°è®¡å’Œä¼˜åŒ–å»ºè®®
- å¸¸è§é—®é¢˜è§£ç­”

**ä¸€åˆ‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹è®­ç»ƒï¼** ğŸš€

å»ºè®®ä»å¿«é€ŸéªŒè¯é…ç½®å¼€å§‹ï¼š
```bash
bash scripts/quick_train_test.sh
```
