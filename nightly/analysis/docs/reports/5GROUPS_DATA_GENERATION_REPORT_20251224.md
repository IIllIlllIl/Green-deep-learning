# æ–°5ç»„åˆ†å±‚æ•°æ®ç”Ÿæˆæ‰§è¡ŒæŠ¥å‘Š

**æ—¥æœŸ**: 2025-12-24
**ä»»åŠ¡**: æ‰§è¡Œæ–°çš„5ç»„æ•°æ®åˆ†å±‚æ–¹æ¡ˆ
**çŠ¶æ€**: âœ… éƒ¨åˆ†æˆåŠŸï¼ˆéœ€è¿›ä¸€æ­¥å¤„ç†ï¼‰

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

### æˆåŠŸå®Œæˆçš„ä»»åŠ¡ âœ…

1. **å¤‡ä»½æ—§æ•°æ®**ï¼šå®Œæ•´å¤‡ä»½4ç»„æ•°æ®åˆ°`processed.backup_4groups_20251224/`
2. **ä¿®æ”¹åˆ†ç»„é…ç½®**ï¼šå°†4ç»„æ‹†åˆ†ä¸º5ç»„ï¼ˆimage_classification â†’ examples + resnetï¼‰
3. **å…¨é‡æ•°æ®ç”Ÿæˆ**ï¼šæˆåŠŸç”Ÿæˆ5ä¸ªåˆ†å±‚CSVæ–‡ä»¶
4. **æ•°æ®é‡æå‡**ï¼šä»372è¡Œæå‡åˆ°536è¡Œï¼ˆ+164è¡Œï¼Œ+44.1%ï¼‰âœ…

### ç”Ÿæˆçš„5ç»„æ•°æ®

| ä»»åŠ¡ç»„ | è¡Œæ•° | åˆ—æ•° | æ€§èƒ½æŒ‡æ ‡ç¼ºå¤±ç‡ | é¢„æœŸå€¼ | çŠ¶æ€ |
|--------|------|------|--------------|--------|------|
| image_classification_examples | 219 | 19 | 0% | 219 | âœ… å®Œå…¨åŒ¹é… |
| image_classification_resnet | 39 | 15 | 0% | 39 | âœ… å®Œå…¨åŒ¹é… |
| person_reid | 116 | 20 | 0% | 116 | âœ… å®Œå…¨åŒ¹é… |
| vulberta | 82 | 15 | 0% | 82 | âœ… å®Œå…¨åŒ¹é… |
| bug_localization | 80 | 16 | 0% | 80 | âœ… å®Œå…¨åŒ¹é… |
| **æ€»è®¡** | **536** | - | **0%** | **536** | âœ… **å®Œç¾** |

### å…³é”®æ”¹è¿›

| ç»´åº¦ | æ—§æ–¹æ¡ˆï¼ˆ4ç»„ï¼‰ | æ–°æ–¹æ¡ˆï¼ˆ5ç»„ï¼‰ | æ”¹è¿› |
|------|-------------|-------------|------|
| æ€»è¡Œæ•° | 372 | 536 | +164 (+44.1%) âœ… |
| åˆ†ç»„æ•° | 4 | 5 | +1 |
| è¶…å‚æ•°å†²çª | âš ï¸ æœ‰ | âœ… æ—  |
| æ€§èƒ½æŒ‡æ ‡å¡«å…… | 100% | 100% | ä¿æŒ âœ… |
| æ•°æ®ä¿ç•™ç‡ | 51.2% | 73.8% | +22.6% âœ… |

---

## âš ï¸ å‘ç°çš„é—®é¢˜

### é—®é¢˜1: è¶…å‚æ•°å¤§é‡ç¼ºå¤±

**ç°è±¡**:
- image_classification_examples: 30-38%è¶…å‚æ•°ç¼ºå¤±
- image_classification_resnet: 46-69%è¶…å‚æ•°ç¼ºå¤±
- person_reid: 26-67%è¶…å‚æ•°ç¼ºå¤±
- vulberta: 73-78%è¶…å‚æ•°ç¼ºå¤±
- bug_localization: 78%è¶…å‚æ•°ç¼ºå¤±

**åŸå› **:
- è¾“å…¥æ•°æ®`stage2_mediators.csv`æœ¬èº«å°±æœ‰è¶…å‚æ•°ç¼ºå¤±
- åŸå§‹æ•°æ®ä¸­å¾ˆå¤šå®éªŒæœªè®°å½•æ‰€æœ‰è¶…å‚æ•°
- ä¸åŒæ¨¡å‹æ”¯æŒä¸åŒçš„è¶…å‚æ•°é›†åˆ

**å½±å“**:
- âŒ æ— æ³•ç›´æ¥ç”¨äºDiBSå› æœåˆ†æï¼ˆDiBSè¦æ±‚æ‰€æœ‰åˆ—100%å¡«å……ï¼‰
- âš ï¸ ç›¸å…³çŸ©é˜µåŒ…å«NaNå€¼ï¼ˆVulBERTaå’ŒBugå®šä½ï¼‰

---

## ğŸ” æ•°æ®è´¨é‡å¯¹æ¯”

### æ–°5ç»„ vs æ—§4ç»„

| è´¨é‡æŒ‡æ ‡ | æ—§4ç»„ | æ–°5ç»„ | è¯´æ˜ |
|---------|------|------|------|
| **è¡Œæ•°** | 372 | 536 | âœ… æ–°æ–¹æ¡ˆå¤š164è¡Œ |
| **æ€§èƒ½æŒ‡æ ‡å¡«å……** | 100% | 100% | âœ… ä¸¤è€…ç›¸åŒ |
| **è¶…å‚æ•°å¡«å……** | 100% | 29.9% | âŒ æ–°æ–¹æ¡ˆæœ‰ç¼ºå¤± |
| **èƒ½è€—æŒ‡æ ‡å¡«å……** | 100% | 96.3% | âš ï¸ æ–°æ–¹æ¡ˆç•¥ä½ |
| **ç›¸å…³çŸ©é˜µå¯è®¡ç®—** | éƒ¨åˆ†NaN | éƒ¨åˆ†NaN | ä¸¤è€…éƒ½æœ‰é—®é¢˜ |

### è¯¦ç»†å¯¹æ¯”

**æ—§4ç»„æ–¹æ¡ˆ** (æ¥è‡ªæ—§æµç¨‹):
- ä½¿ç”¨stage5æˆ–stage6ä½œä¸ºè¾“å…¥
- åˆ é™¤äº†è¶…å‚æ•°å†²çªçš„l2_regularizationåˆ—
- åˆ é™¤äº†è¶…å‚æ•°ç¼ºå¤±çš„è¡Œï¼ˆ258â†’116ï¼‰
- ç»“æœï¼š372è¡Œï¼Œè¶…å‚æ•°100%å¡«å……

**æ–°5ç»„æ–¹æ¡ˆ** (å½“å‰):
- ä½¿ç”¨stage2_mediators.csvä½œä¸ºè¾“å…¥
- ä¿ç•™äº†æ‰€æœ‰è¶…å‚æ•°åˆ—ï¼ˆæ— å†²çªï¼‰
- ä¿ç•™äº†è¶…å‚æ•°ç¼ºå¤±çš„è¡Œ
- ç»“æœï¼š536è¡Œï¼Œè¶…å‚æ•°30-78%ç¼ºå¤±

---

## ğŸ’¡ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: åˆ é™¤è¶…å‚æ•°ç¼ºå¤±è¡Œ âŒ ä¸æ¨è

**åšæ³•**: åˆ é™¤ä»»ä½•è¶…å‚æ•°åˆ—æœ‰ç¼ºå¤±å€¼çš„è¡Œ

**ç»“æœé¢„æµ‹**:
- 536è¡Œ â†’ 160è¡Œï¼ˆæŸå¤±70%ï¼ï¼‰
- VulBERTa: 82â†’0è¡Œ âŒ
- Bugå®šä½: 80â†’0è¡Œ âŒ
- ResNet: 39â†’6è¡Œ âŒ ï¼ˆä½äºDiBSæœ€ä½è¦æ±‚ï¼‰

**è¯„ä¼°**: âŒ **ä¸å¯æ¥å—**ï¼ŒæŸå¤±å¤ªå¤§

---

### æ–¹æ¡ˆ2: ä½¿ç”¨models_config.jsonå¡«å……é»˜è®¤å€¼ â­ æ¨è

**åšæ³•**:
1. å¯¹æ¯ä¸ªä»“åº“+æ¨¡å‹ï¼Œä»models_config.jsonæå–é»˜è®¤è¶…å‚æ•°
2. æŒ‰experiment_idå›æº¯å¡«å……ç¼ºå¤±çš„è¶…å‚æ•°å€¼
3. å¯¹äºçœŸçš„ä¸æ”¯æŒçš„å‚æ•°ï¼ˆå¦‚examplesçš„l2_regularizationï¼‰ï¼Œä¿æŒä¸ºNaN

**é¢„æœŸæ•ˆæœ**:
- ä¿ç•™536è¡Œ
- è¶…å‚æ•°å¡«å……ç‡ï¼š70-90%ï¼ˆå¤§å¹…æå‡ï¼‰
- ç¬¦åˆå„æ¨¡å‹çš„å®é™…é…ç½®

**å®æ–½**:
- å¤ç”¨å·²æœ‰è„šæœ¬ï¼š`scripts/extract_from_json_with_defaults.py`
- ä¿®æ”¹è¾“å…¥ï¼šä»stage2_mediators.csvå¼€å§‹å¡«å……
- é¢„è®¡æ—¶é—´ï¼š2-3å°æ—¶

---

### æ–¹æ¡ˆ3: åªåˆ†æè¶…å‚æ•°å®Œæ•´çš„å­é›† âš ï¸ å¤‡é€‰

**åšæ³•**:
- åªä¿ç•™è¶…å‚æ•°å®Œæ•´çš„160è¡Œè¿›è¡ŒDiBSåˆ†æ
- å¯¹å…¶ä½™376è¡Œè¿›è¡Œæè¿°æ€§ç»Ÿè®¡åˆ†æ

**ä¼˜ç‚¹**:
- å¯ä»¥ç«‹å³å¼€å§‹DiBSåˆ†æ
- 160è¡Œä»è¿œè¶…DiBSæœ€ä½è¦æ±‚ï¼ˆ10è¡Œï¼‰

**ç¼ºç‚¹**:
- æŸå¤±70%æ•°æ®ï¼ˆä¸ä¼˜åŒ–ç›®æ ‡çŸ›ç›¾ï¼‰
- VulBERTaå’ŒBugå®šä½æ— æ³•åˆ†æ

---

##  ğŸ“Œ ä¸‹ä¸€æ­¥å»ºè®®

### ç«‹å³å¯æ‰§è¡Œï¼ˆ30åˆ†é’Ÿå†…ï¼‰

#### é€‰é¡¹A: æš‚åœï¼Œæ˜å¤©å®æ–½æ–¹æ¡ˆ2 â­ æ¨è
- ä»Šå¤©å·²å®Œæˆ5ç»„æ•°æ®ç”Ÿæˆå’ŒéªŒè¯
- æ˜å¤©å®æ–½è¶…å‚æ•°é»˜è®¤å€¼å¡«å……
- é¢„æœŸæ—¶é—´ï¼š2-3å°æ—¶
- æœ€ç»ˆæ•°æ®ï¼š536è¡Œï¼Œè¶…å‚æ•°70-90%å¡«å……

#### é€‰é¡¹B: ä½¿ç”¨æ–¹æ¡ˆ3ï¼Œéƒ¨åˆ†å¼€å§‹DiBS
- å¯¹è¶…å‚æ•°å®Œæ•´çš„160è¡Œè¿è¡ŒDiBSè¯•éªŒ
- éªŒè¯æµç¨‹å¯è¡Œæ€§
- ä¸ºæ˜å¤©çš„å®Œæ•´åˆ†æåšå‡†å¤‡

---

### é˜¶æ®µ5æ‰§è¡Œæ–¹æ¡ˆï¼ˆå¾…æ•°æ®å‡†å¤‡å°±ç»ªåï¼‰

**DiBSå› æœåˆ†æ screenè¿è¡ŒæŒ‡ä»¤**:

```bash
# åˆ›å»ºscreenä¼šè¯
screen -S dibs_analysis

# è¿›å…¥analysisç›®å½•å¹¶æ¿€æ´»ç¯å¢ƒ
cd /home/green/energy_dl/nightly/analysis
source /home/green/miniconda3/etc/profile.d/conda.sh
conda activate fairness

# åˆ›å»ºDiBSåˆ†æè„šæœ¬ï¼ˆç¤ºä¾‹ï¼‰
cat > scripts/run_5groups_dibs.sh <<'EOF'
#!/bin/bash
# 5ç»„DiBSå› æœåˆ†æè„šæœ¬

TASKS="image_classification_examples image_classification_resnet person_reid vulberta bug_localization"

for TASK in $TASKS; do
    echo "========================================="
    echo "åˆ†æä»»åŠ¡ç»„: $TASK"
    echo "========================================="

    python3 scripts/experiments/run_dibs_causal_analysis.py \
        --task $TASK \
        --data data/energy_research/processed/training_data_${TASK}.csv \
        --n-particles 20 \
        --n-steps 1000 \
        --output results/energy_research/5groups/${TASK}/ \
        --log logs/energy_research/5groups/${TASK}.log

    if [ $? -eq 0 ]; then
        echo "âœ… $TASK åˆ†æå®Œæˆ"
    else
        echo "âŒ $TASK åˆ†æå¤±è´¥"
    fi
done

echo "========================================="
echo "âœ… æ‰€æœ‰ä»»åŠ¡ç»„åˆ†æå®Œæˆï¼"
echo "========================================="
EOF

chmod +x scripts/run_5groups_dibs.sh

# è¿è¡Œåˆ†æï¼ˆåå°ï¼‰
nohup bash scripts/run_5groups_dibs.sh > logs/5groups_dibs_run.log 2>&1 &

# è®°å½•è¿›ç¨‹ID
echo $! > /tmp/dibs_5groups.pid

# åˆ†ç¦»screenï¼ˆCtrl+A Dï¼‰
EOF
```

**ç›‘æ§è¿›åº¦**:
```bash
# é‡æ–°è¿æ¥
screen -r dibs_analysis

# æŸ¥çœ‹æ—¥å¿—
tail -f logs/5groups_dibs_run.log

# æŸ¥çœ‹ç‰¹å®šä»»åŠ¡
tail -f logs/energy_research/5groups/image_classification_examples.log
```

**é¢„æœŸè¿è¡Œæ—¶é—´**:
- æ¯ä¸ªä»»åŠ¡ç»„ï¼š30-90åˆ†é’Ÿï¼ˆå–å†³äºæ ·æœ¬é‡ï¼‰
- 5ä¸ªä»»åŠ¡ç»„æ€»è®¡ï¼š3-6å°æ—¶

---

## ğŸ“Š æ–‡ä»¶æ¸…å•

### ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶
```
data/energy_research/processed/
â”œâ”€â”€ training_data_image_classification_examples.csv (219è¡Œ, 19åˆ—) âœ…
â”œâ”€â”€ training_data_image_classification_resnet.csv (39è¡Œ, 15åˆ—) âœ…
â”œâ”€â”€ training_data_person_reid.csv (116è¡Œ, 20åˆ—) âœ…
â”œâ”€â”€ training_data_vulberta.csv (82è¡Œ, 15åˆ—) âœ…
â””â”€â”€ training_data_bug_localization.csv (80è¡Œ, 16åˆ—) âœ…
```

### å¤‡ä»½æ–‡ä»¶
```
data/energy_research/processed.backup_4groups_20251224/
â”œâ”€â”€ training_data_image_classification.csv (116è¡Œ, æ—§4ç»„) âœ…
â”œâ”€â”€ training_data_person_reid.csv (69è¡Œ) âœ…
â”œâ”€â”€ training_data_vulberta.csv (96è¡Œ) âœ…
â””â”€â”€ training_data_bug_localization.csv (91è¡Œ) âœ…
```

### éªŒè¯è„šæœ¬
```
scripts/
â”œâ”€â”€ verify_5groups_data.py (è´¨é‡éªŒè¯è„šæœ¬) âœ…
â””â”€â”€ preprocess_stratified_data.py (æ•°æ®ç”Ÿæˆè„šæœ¬ï¼Œå·²æ›´æ–°ä¸º5ç»„) âœ…
```

---

## âœ… æ€»ç»“

### å·²å®Œæˆ âœ…
- [x] å¤‡ä»½æ—§4ç»„æ•°æ®
- [x] ä¿®æ”¹preprocess_stratified_data.pyä¸º5ç»„é…ç½®
- [x] å…¨é‡æ‰§è¡Œæ•°æ®ç”Ÿæˆï¼ˆ536è¡Œï¼‰
- [x] éªŒè¯æ•°æ®ç»´åº¦å’Œæ€§èƒ½æŒ‡æ ‡ï¼ˆ100%ç¬¦åˆé¢„æœŸï¼‰
- [x] å¯¹æ¯”æ—§æ–°æ–¹æ¡ˆï¼ˆ+164è¡Œï¼Œ+44%ï¼‰

### å­˜åœ¨é—®é¢˜ âš ï¸
- [ ] è¶…å‚æ•°å¤§é‡ç¼ºå¤±ï¼ˆ30-78%ï¼‰
- [ ] éƒ¨åˆ†ç»„ç›¸å…³çŸ©é˜µåŒ…å«NaNå€¼
- [ ] æ— æ³•ç›´æ¥ç”¨äºDiBSåˆ†æ

### æ¨èè¡ŒåŠ¨ â­
1. **æ˜å¤©**: å®æ–½æ–¹æ¡ˆ2ï¼ˆè¶…å‚æ•°é»˜è®¤å€¼å¡«å……ï¼‰
2. **é¢„è®¡**: 2-3å°æ—¶å®Œæˆï¼Œæœ€ç»ˆ536è¡Œæ•°æ®å¯ç”¨
3. **ç„¶å**: åœ¨screenä¸­è¿è¡Œ5ç»„DiBSåˆ†æï¼ˆ3-6å°æ—¶ï¼‰

---

## ğŸ†• æ‰©å±•å»ºè®®ï¼šç¬¬6ç»„ MRT-OAST

### å¯è¡Œæ€§åˆ†æç»“æœ âœ…

ç»åˆ†æï¼Œ**MRT-OAST å®Œå…¨æ»¡è¶³ä½œä¸ºç¬¬6ç»„çš„æ¡ä»¶**ï¼š

| è¯„ä¼°ç»´åº¦ | è¦æ±‚ | å®é™…æƒ…å†µ | çŠ¶æ€ |
|---------|------|---------|------|
| æ•°æ®é‡ | â‰¥ 20 è¡Œ | 58 è¡Œ | âœ… å……è¶³ |
| æ€§èƒ½æŒ‡æ ‡ | â‰¥ 1 ä¸ª | 3 ä¸ªï¼ˆaccuracy, precision, recallï¼‰ | âœ… ä¼˜ç§€ |
| èƒ½è€—æ•°æ® | > 80% å®Œæ•´ | 93.1% å®Œæ•´ | âœ… ä¼˜ç§€ |
| è¶…å‚æ•° | â‰¥ 3 ä¸ª | 5 ä¸ªï¼ˆdropout, epochs, lr, seed, wdï¼‰ | âœ… ä¼˜ç§€ |

**è¯¦ç»†æŠ¥å‘Š**: [MRT_OAST_FEASIBILITY_ANALYSIS.md](MRT_OAST_FEASIBILITY_ANALYSIS.md)

### ç¬¬6ç»„é…ç½®æ¨è

```python
'mrt_oast': {
    'repos': ['MRT-OAST'],
    'models': {'MRT-OAST': ['default']},
    'performance_cols': ['perf_accuracy', 'perf_precision', 'perf_recall'],
    'hyperparams': ['training_duration', 'hyperparam_dropout',
                    'hyperparam_epochs', 'hyperparam_learning_rate',
                    'hyperparam_seed', 'hyperparam_weight_decay'],
    'has_onehot': False,
    'onehot_cols': []
}
```

**é¢„æœŸæ•ˆæœ**:
- æ•°æ®é‡: 58 è¡Œï¼ˆä»78è¡Œåˆ é™¤20è¡Œæ€§èƒ½å…¨ç¼ºå¤±æ•°æ®ï¼‰
- æ€»æ•°æ®é‡æå‡: 536 â†’ 594 è¡Œï¼ˆ+58è¡Œï¼Œ+10.8%ï¼‰
- æ•°æ®ä¿ç•™ç‡æå‡: 73.8% â†’ 81.8%ï¼ˆ726è¡Œä¸­ä¿ç•™594è¡Œï¼‰

### å®æ–½å»ºè®®

**é€‰é¡¹A**: æ‰©å±•ä¸º6ç»„æ–¹æ¡ˆ â­ æ¨è
- æ·»åŠ  MRT-OAST ä½œä¸ºç¬¬6ç»„
- æ€»æ•°æ®é‡: 594 è¡Œ
- æ•°æ®ä¿ç•™ç‡: 81.8%
- è¦†ç›–æ‰€æœ‰11ä¸ªæ¨¡å‹

**é€‰é¡¹B**: ä¿æŒ5ç»„æ–¹æ¡ˆ
- ç»´æŒå½“å‰536è¡Œ
- æ•°æ®ä¿ç•™ç‡: 73.8%
- æ’é™¤ MRT-OASTï¼ˆ78è¡Œï¼‰

---

**æŠ¥å‘Šç”Ÿæˆ**: 2025-12-24
**æœ€åæ›´æ–°**: 2025-12-24ï¼ˆæ·»åŠ ç¬¬6ç»„MRT-OASTåˆ†æï¼‰
**æ‰§è¡Œäºº**: Claude
**çŠ¶æ€**: æ•°æ®ç”ŸæˆæˆåŠŸï¼Œå¯é€‰æ‰©å±•ä¸º6ç»„æ–¹æ¡ˆ âœ…
