# data.csv列结构深度分析与进一步合并建议

**分析日期**: 2025-12-19
**当前版本**: v4.7.10 (性能指标合并后)
**数据文件**: data.csv (676行 × 56列)

---

## 📊 当前列结构总览

| 类别 | 列数 | 填充率范围 | 说明 |
|------|------|-----------|------|
| 基础信息 | 9 | 100% | 实验ID、模型信息、训练状态 |
| 超参数 | 9 | 4.9%-51.5% | 不同模型使用不同超参数 |
| **性能指标** | **16** | **0%-45.0%** | **包含2个空列** ⚠️ |
| 能耗指标 | 11 | 95.0% | CPU+GPU能耗 |
| 实验元数据 | 4 | 31.1%-70.3% | 变异信息 |
| 并行模式 | 7 | 31.7% | 并行实验额外信息 |
| **总计** | **56** | - | **实际有效: 54列** |

---

## 🔍 发现的问题

### 问题1: 空列 ❌ **（高优先级）**

**发现**: 2个性能指标列完全为空

| 列名 | 使用次数 | 原因 |
|------|---------|------|
| `perf_accuracy` | **0 (0.0%)** | v4.7.10已合并到test_accuracy |
| `perf_eval_loss` | **0 (0.0%)** | v4.7.10已合并到test_loss |

**影响**:
- 占用2列位置但无实际数据
- 增加文件大小和处理复杂度
- 可能误导数据分析者

**建议**: ✅ **删除这2个空列**
- 优先级: 高
- 收益: 减少2列 (56列 → 54列，3.6%精简)
- 风险: 低（数据已全部迁移）

---

### 问题2: 并行模式字段部分冗余 ⚠️ **（中优先级）**

#### 现状分析

**并行实验有两套duration/retries/error_message字段**:

| 字段含义 | 顶层字段 | 前景字段 | 使用模式 |
|---------|---------|---------|---------|
| Duration | `duration_seconds` | `fg_duration_seconds` | 混合格式 |
| Retries | `retries` | `fg_retries` | 混合格式 |
| Error | `error_message` | `fg_error_message` | 混合格式 |

**数据分布** (328个并行实验):

| 格式 | 实验数 | 占比 | 说明 |
|------|--------|------|------|
| 格式1: 仅顶层有值 | 114 | 34.8% | 老实验格式 |
| 格式2: 仅fg_有值 | 0 | 0.0% | 无此格式 |
| 格式3: 两者都有 | 214 | 65.2% | 新实验格式（数据重复） |

**重复情况**:
- duration相同: 214/328 (65.2%)
- retries相同: 214/328 (65.2%)
- error_message相同: 214/328 (65.2%)
- **三者全部相同: 214/328 (65.2%)**

#### 为什么会有两套字段？

**设计演进**:
1. **老格式**: 并行实验仅在顶层记录duration/retries/error
2. **新格式**: 同时在顶层和fg_字段记录（为了数据一致性）
3. **结果**: 65.2%的实验数据完全重复

#### 是否可以合并？

**❌ 不建议合并** - 原因：

1. **数据格式不统一** (34.8% vs 65.2%)
   - 114个老实验仅有顶层字段
   - 214个新实验两者都有
   - 合并会丢失数据或需要复杂的回填逻辑

2. **fg_字段语义明确**
   - 明确标识前景训练的duration/retries/error
   - 与bg_字段（背景信息）对应
   - 删除会破坏数据结构的语义完整性

3. **历史兼容性**
   - 旧实验依赖顶层字段
   - 新实验依赖fg_字段
   - 保留两者确保向后兼容

**推荐**: ⚠️ **保留现状**
- 优先级: 低
- 收益: 可减少3列，但数据处理复杂度提升
- 风险: 高（数据迁移复杂，易出错）

---

### 问题3: 低使用率超参数列 ℹ️ **（信息性）**

| 超参数 | 使用次数 | 使用率 | 使用模型 |
|--------|---------|--------|---------|
| `hyperparam_kfold` | 33 | 4.9% | bug-localization |
| `hyperparam_max_iter` | 41 | 6.1% | bug-localization |
| `hyperparam_alpha` | 43 | 6.4% | bug-localization |
| `hyperparam_weight_decay` | 108 | 16.0% | 4个模型 |
| `hyperparam_dropout` | 123 | 18.2% | 2个模型 |
| `hyperparam_batch_size` | 136 | 20.1% | 5个模型 |

**是否可以删除？**

**❌ 不建议** - 原因：

1. **模型特定参数**
   - 每个模型只使用部分超参数（设计使然）
   - bug-localization专用: alpha, max_iter, kfold
   - 删除会丢失实验配置信息

2. **稀疏性是正常的**
   - 11个模型使用9个超参数的子集
   - 低填充率反映了模型多样性
   - 非数据质量问题

**结论**: ✅ **保留所有超参数列**

---

### 问题4: 性能指标列稀疏性 ℹ️ **（正常现象）**

**使用分布**:

| 指标 | 使用次数 | 使用率 | 使用模型数 |
|------|---------|--------|-----------|
| `perf_test_accuracy` | 304 | 45.0% | 6 |
| `perf_test_loss` | 194 | 28.7% | 4 |
| `perf_map` | 116 | 17.2% | 3 (Person_reID) |
| `perf_rank1` | 116 | 17.2% | 3 (Person_reID) |
| `perf_rank5` | 116 | 17.2% | 3 (Person_reID) |
| `perf_final_training_loss` | 72 | 10.7% | 1 (VulBERTa) |
| `perf_eval_samples_per_second` | 72 | 10.7% | 1 (VulBERTa) |
| ... | ... | ... | ... |

**是否可以删除低使用率指标？**

**❌ 不建议** - 原因：

1. **每个指标对应特定模型**
   - mAP/rank1/rank5: Person_reID专用
   - top1-20: bug-localization专用
   - 稀疏性反映任务多样性

2. **删除会破坏数据完整性**
   - 无法分析特定模型的性能
   - 丢失关键评估指标

**唯一例外**: ⚠️ `perf_rank5` (可选删除)
- 在之前的可行性分析中标记为"可选删除"
- 与mAP+rank1有一定冗余
- 但仍建议保留（人员重识别的标准指标）

---

## 📋 最终合并建议

### 推荐方案: 删除2个空列 ⭐⭐⭐

**操作**:
1. 删除 `perf_accuracy` 列
2. 删除 `perf_eval_loss` 列

**结果**:
- 列数: 56 → 54 (减少2列，3.6%精简)
- 数据完整性: 100%（无数据丢失）
- 向后兼容: 部分兼容（空列删除不影响现有脚本）

**风险评估**:
- ✅ 低风险: 列本身为空，删除不影响数据
- ⚠️ 中风险: 依赖固定列位置的脚本可能受影响
- ✅ 可回滚: 保留原始CSV备份

### 不推荐的操作

| 操作 | 原因 |
|------|------|
| ❌ 删除fg_duration/retries/error | 数据格式不统一，迁移复杂 |
| ❌ 删除低使用率超参数 | 模型特定参数，必须保留 |
| ❌ 删除性能指标列 | 每个指标对应特定任务 |
| ⚠️ 删除perf_rank5 | 可选但不推荐（标准指标） |

---

## 🎯 实施计划

### 阶段1: 删除空列（推荐立即执行）⭐

**脚本**: `scripts/remove_empty_performance_columns.py`

**操作**:
```python
# 删除以下列:
- perf_accuracy
- perf_eval_loss

# 保留以下列（虽然目前为空，但未来可能使用）:
# (无)
```

**验证**:
1. 检查列数: 56 → 54
2. 检查数据完整性: 676行无变化
3. 检查现有脚本兼容性

### 阶段2: 可选优化（评估后决定）⚠️

**候选操作**:
1. 删除`perf_rank5` (需业务评估)
2. 优化fg_字段存储策略 (需数据迁移)

---

## 📊 合并前后对比

### 当前状态 (56列)

```
基础信息(9) + 超参数(9) + 性能指标(16) + 能耗(11) + 元数据(4) + 并行(7) = 56列

性能指标(16):
  ✅ test_accuracy, test_loss, map, rank1, rank5, precision, recall, ...
  ❌ accuracy (空)
  ❌ eval_loss (空)
```

### 推荐方案后 (54列)

```
基础信息(9) + 超参数(9) + 性能指标(14) + 能耗(11) + 元数据(4) + 并行(7) = 54列

性能指标(14):
  ✅ test_accuracy, test_loss, map, rank1, rank5, precision, recall, ...
  (已删除: accuracy, eval_loss)
```

**精简度**: 3.6%

---

## ✅ 总结

### 可以删除 ✅

| 列名 | 理由 | 优先级 | 收益 |
|------|------|--------|------|
| `perf_accuracy` | 已合并到test_accuracy，完全为空 | 高 | 减少1列 |
| `perf_eval_loss` | 已合并到test_loss，完全为空 | 高 | 减少1列 |

### 不建议删除 ❌

| 类别 | 理由 |
|------|------|
| fg_字段 | 数据格式不统一，迁移复杂度高 |
| 低使用率超参数 | 模型特定参数，反映任务多样性 |
| 性能指标列 | 每个指标对应特定模型/任务 |

### 最终建议 ⭐

**执行**: 删除2个空列 (`perf_accuracy`, `perf_eval_loss`)
- 列数: 56 → 54 (3.6%精简)
- 风险: 低
- 收益: 简化数据结构，提升可维护性

**不执行**: 其他任何列的删除
- 原因: 数据完整性优先于列数精简
- 原则: 保留所有有数据的列

---

**分析完成日期**: 2025-12-19
**推荐执行**: 删除2个空列
**预期结果**: 54列CSV，数据100%完整
