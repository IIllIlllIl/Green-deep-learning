# Sessionæ•°æ®è¿½åŠ åˆ°raw_data.csv - ä½¿ç”¨æŒ‡å—

**è„šæœ¬**: `scripts/append_session_to_raw_data.py`
**ç‰ˆæœ¬**: 1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-12-13

---

## ğŸ“‹ æ¦‚è¿°

é€šç”¨è„šæœ¬ï¼Œç”¨äºä»ä»»æ„ session ç›®å½•æå–å®éªŒæ•°æ®å¹¶è¿½åŠ åˆ° `raw_data.csv`ã€‚

### ä¸»è¦åŠŸèƒ½

- âœ… è‡ªåŠ¨ä»æŒ‡å®š session ç›®å½•æå–æ‰€æœ‰å®éªŒ
- âœ… ä» `experiment.json` å’Œ `terminal_output.txt` æå–å®Œæ•´æ•°æ®
- âœ… è‡ªåŠ¨å»é‡æ£€æŸ¥ï¼Œåªè¿½åŠ æ–°å®éªŒ
- âœ… è‡ªåŠ¨å¤‡ä»½ `raw_data.csv`
- âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯
- âœ… Dry-run æµ‹è¯•æ¨¡å¼

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### åŸºæœ¬ç”¨æ³•

```bash
# è¿½åŠ æœ€æ–° session çš„å®éªŒæ•°æ®
python3 scripts/append_session_to_raw_data.py results/run_20251213_100000
```

### æµ‹è¯•æ¨¡å¼ï¼ˆæ¨èå…ˆè¿è¡Œï¼‰

```bash
# Dry-runï¼šæŸ¥çœ‹å°†è¦æ·»åŠ ä»€ä¹ˆï¼Œä½†ä¸å®é™…å†™å…¥
python3 scripts/append_session_to_raw_data.py results/run_20251213_100000 --dry-run
```

### å…¸å‹å·¥ä½œæµç¨‹

```bash
# æ­¥éª¤1: å…ˆç”¨ dry-run æ¨¡å¼æ£€æŸ¥
python3 scripts/append_session_to_raw_data.py results/run_20251213_100000 --dry-run

# æ­¥éª¤2: ç¡®è®¤æ— è¯¯åï¼Œå®é™…æ‰§è¡Œ
python3 scripts/append_session_to_raw_data.py results/run_20251213_100000
```

---

## ğŸ›ï¸ å‘½ä»¤è¡Œé€‰é¡¹

### å¿…éœ€å‚æ•°

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `session_dir` | Sessionç›®å½•è·¯å¾„ | `results/run_20251213_100000` |

### å¯é€‰å‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--raw-data-csv PATH` | raw_data.csvæ–‡ä»¶è·¯å¾„ | `results/raw_data.csv` |
| `--models-config PATH` | models_config.jsonè·¯å¾„ | `mutation/models_config.json` |
| `--dry-run` | æµ‹è¯•è¿è¡Œï¼Œä¸å®é™…å†™å…¥æ–‡ä»¶ | å¦ |
| `--no-backup` | ä¸åˆ›å»ºå¤‡ä»½æ–‡ä»¶ | å¦ï¼ˆé»˜è®¤åˆ›å»ºå¤‡ä»½ï¼‰ |
| `--quiet` | é™é»˜æ¨¡å¼ï¼Œå‡å°‘è¾“å‡º | å¦ |

---

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: åŸºæœ¬è¿½åŠ 

```bash
python3 scripts/append_session_to_raw_data.py results/run_20251213_100000
```

**è¾“å‡º**:
```
================================================================================
ä»Sessionæå–å®éªŒ: run_20251213_100000
================================================================================

âœ… åŠ è½½ç°æœ‰æ•°æ®: 480è¡Œ
   ç°æœ‰å®éªŒID: 460ä¸ª

âœ… examples_mnist_new_001:
   å®éªŒID: examples_mnist_new_001
   è®­ç»ƒæˆåŠŸ: True
   æ€§èƒ½æŒ‡æ ‡: ['perf_test_accuracy', 'perf_train_accuracy']

âœ… VulBERTa_mlp_new_002:
   å®éªŒID: VulBERTa_mlp_new_002
   è®­ç»ƒæˆåŠŸ: True
   æ€§èƒ½æŒ‡æ ‡: ['perf_accuracy', 'perf_f1']

=== æ€»ç»“ ===
æ‰¾åˆ°ç›®å½•: 5ä¸ª
è·³è¿‡ï¼ˆæ— JSONï¼‰: 0ä¸ª
è·³è¿‡ï¼ˆæœªçŸ¥ä»“åº“ï¼‰: 0ä¸ª
è·³è¿‡ï¼ˆé‡å¤ï¼‰: 3ä¸ª
æ–°å¢å®éªŒ: 2ä¸ª

âœ… å·²å¤‡ä»½: results/raw_data.csv.backup_20251213_120000
âœ… å·²æ›´æ–°: results/raw_data.csv
   åŸå§‹: 480è¡Œ
   æ–°å¢: 2è¡Œ
   æ€»è®¡: 482è¡Œ

âœ… éªŒè¯: 482è¡Œ (é¢„æœŸ482è¡Œ)
âœ… æ•°æ®å®Œæ•´æ€§éªŒè¯é€šè¿‡

================================================================================
âœ… å®Œæˆ
================================================================================
```

### ç¤ºä¾‹2: Dry-run æµ‹è¯•

```bash
python3 scripts/append_session_to_raw_data.py results/run_20251213_100000 --dry-run
```

**è¾“å‡º**:
```
...ï¼ˆåŒä¸Šï¼Œä½†ä¼šæ˜¾ç¤ºï¼‰...

ğŸ” [DRY RUN] æµ‹è¯•è¿è¡Œï¼Œä¸å®é™…å†™å…¥æ–‡ä»¶
   å°†æ·»åŠ  2 ä¸ªå®éªŒåˆ° raw_data.csv

================================================================================
âœ… å®Œæˆ
================================================================================
```

### ç¤ºä¾‹3: é™é»˜æ¨¡å¼

```bash
python3 scripts/append_session_to_raw_data.py results/run_20251213_100000 --quiet
```

**è¾“å‡º**: ï¼ˆä»…é”™è¯¯ä¿¡æ¯ï¼ŒæˆåŠŸæ—¶æ— è¾“å‡ºï¼‰

### ç¤ºä¾‹4: ä¸åˆ›å»ºå¤‡ä»½

```bash
python3 scripts/append_session_to_raw_data.py results/run_20251213_100000 --no-backup
```

**æ³¨æ„**: ä¸æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ­¤é€‰é¡¹

---

## âš™ï¸ å·¥ä½œåŸç†

### æ•°æ®æå–æµç¨‹

1. **åŠ è½½ç°æœ‰æ•°æ®**
   - è¯»å– `results/raw_data.csv`
   - æå–æ‰€æœ‰å·²å­˜åœ¨çš„ `experiment_id`

2. **æ‰«æ session ç›®å½•**
   - éå†æ‰€æœ‰å­ç›®å½•
   - æŸ¥æ‰¾ `experiment.json` æ–‡ä»¶

3. **å»é‡æ£€æŸ¥**
   - æ¯”è¾ƒ `experiment_id` ä¸ç°æœ‰æ•°æ®
   - è·³è¿‡é‡å¤å®éªŒ

4. **æ•°æ®æå–**
   - ä» `experiment.json` æå–åŸºç¡€æ•°æ®ï¼š
     - å®éªŒå…ƒæ•°æ®ï¼ˆIDã€æ—¶é—´æˆ³ã€ä»“åº“ã€æ¨¡å‹ç­‰ï¼‰
     - è¶…å‚æ•°ï¼ˆ`hyperparameters`ï¼‰
     - èƒ½è€—æ•°æ®ï¼ˆ`energy_consumption`ï¼‰
   - ä» `terminal_output.txt` æå–æ€§èƒ½æŒ‡æ ‡ï¼š
     - ä½¿ç”¨ `models_config.json` ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼
     - æå– accuracyã€F1 ç­‰æ€§èƒ½æŒ‡æ ‡

5. **æ•°æ®è¿½åŠ **
   - ï¼ˆå¯é€‰ï¼‰åˆ›å»ºå¤‡ä»½ `raw_data.csv.backup_YYYYMMDD_HHMMSS`
   - è¿½åŠ æ–°å®éªŒåˆ° CSV
   - éªŒè¯æ•°æ®å®Œæ•´æ€§

---

## âœ… æ•°æ®éªŒè¯

è„šæœ¬è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹éªŒè¯ï¼š

1. **æ–‡ä»¶å­˜åœ¨æ€§æ£€æŸ¥**
   - Session ç›®å½•å¿…é¡»å­˜åœ¨
   - `raw_data.csv` å¿…é¡»å­˜åœ¨
   - `models_config.json` å¿…é¡»å­˜åœ¨

2. **JSON æ ¼å¼éªŒè¯**
   - `experiment.json` æ ¼å¼æ­£ç¡®
   - åŒ…å«å¿…éœ€å­—æ®µ

3. **å»é‡éªŒè¯**
   - æ£€æµ‹å¹¶è·³è¿‡é‡å¤çš„ `experiment_id`

4. **æ•°æ®å®Œæ•´æ€§éªŒè¯**
   - å†™å…¥åéªŒè¯è¡Œæ•°æ­£ç¡®
   - æ‰€æœ‰å­—æ®µæ­£ç¡®å¡«å……

---

## ğŸ” å¸¸è§åœºæ™¯å¤„ç†

### åœºæ™¯1: å®éªŒå·²å­˜åœ¨

```bash
âš ï¸  è·³è¿‡ examples_mnist_001: é‡å¤å®éªŒ (examples_mnist_001)
```

**è¡Œä¸º**: è‡ªåŠ¨è·³è¿‡ï¼Œä¸é‡å¤æ·»åŠ 

### åœºæ™¯2: ç¼ºå¤± experiment.json

```bash
âš ï¸  è·³è¿‡ incomplete_exp: æ— experiment.json
```

**è¡Œä¸º**: è·³è¿‡è¯¥ç›®å½•

### åœºæ™¯3: æœªçŸ¥ä»“åº“

```bash
âš ï¸  è·³è¿‡ unknown_repo_model_001: ä»“åº“é…ç½®æœªæ‰¾åˆ° (unknown_repo)
```

**è¡Œä¸º**: è·³è¿‡è¯¥å®éªŒï¼ˆmodels_config.json ä¸­æ— é…ç½®ï¼‰

### åœºæ™¯4: ç¼ºå¤±æ€§èƒ½æ•°æ®

```bash
âœ… examples_mnist_001:
   å®éªŒID: examples_mnist_001
   è®­ç»ƒæˆåŠŸ: True
   æ€§èƒ½æŒ‡æ ‡: æ— 
```

**è¡Œä¸º**: ä»ç„¶æ·»åŠ å®éªŒï¼Œä½†æ€§èƒ½æŒ‡æ ‡ä¸ºç©º

---

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python3 tests/test_append_session_to_raw_data.py
```

**æµ‹è¯•è¦†ç›–**:
- âœ… åŸºæœ¬æå–åŠŸèƒ½
- âœ… å»é‡åŠŸèƒ½
- âœ… å¤šä¸ªå®éªŒæå–
- âœ… ç¼ºå¤±æ–‡ä»¶å¤„ç†
- âœ… é”™è¯¯å¤„ç†
- âœ… å¤‡ä»½åŠŸèƒ½
- âœ… Dry-run æ¨¡å¼
- âœ… æ•°æ®å®Œæ•´æ€§
- âœ… æ€§èƒ½æ•°æ®æå–
- âœ… æ··åˆåœºæ™¯

**æœŸæœ›è¾“å‡º**:
```
================================================================================
æµ‹è¯•æ€»ç»“
================================================================================
æ€»æµ‹è¯•æ•°: 10
æˆåŠŸ: 10
å¤±è´¥: 0
é”™è¯¯: 0

âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡!
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨å»ºè®®

1. **å§‹ç»ˆå…ˆè¿è¡Œ dry-run**
   ```bash
   python3 scripts/append_session_to_raw_data.py SESSION_DIR --dry-run
   ```

2. **éªŒè¯å¤‡ä»½**
   - é»˜è®¤åˆ›å»ºå¤‡ä»½ `raw_data.csv.backup_YYYYMMDD_HHMMSS`
   - å®šæœŸæ¸…ç†æ—§å¤‡ä»½

3. **æ£€æŸ¥è¾“å‡º**
   - ç¡®è®¤æ–°å¢å®éªŒæ•°é‡åˆç†
   - éªŒè¯è·³è¿‡çš„é‡å¤æ•°é‡æ­£ç¡®

### é™åˆ¶

1. **ä»…æ”¯æŒæ ‡å‡†æ ¼å¼**
   - éœ€è¦æ ‡å‡†çš„ `experiment.json` æ ¼å¼
   - éœ€è¦åœ¨ `models_config.json` ä¸­é…ç½®çš„ä»“åº“

2. **ä¸ä¿®æ”¹ç°æœ‰æ•°æ®**
   - ä»…è¿½åŠ æ–°å®éªŒ
   - ä¸æ›´æ–°å·²å­˜åœ¨çš„å®éªŒ

3. **å»é‡åŸºäº experiment_id**
   - ç›¸åŒ ID çš„å®éªŒä¼šè¢«è·³è¿‡
   - å³ä½¿å…¶ä»–æ•°æ®ä¸åŒ

---

## ğŸ“Š æ€§èƒ½æ•°æ®æå–

### æ”¯æŒçš„æŒ‡æ ‡ç±»å‹

è„šæœ¬ä½¿ç”¨ `models_config.json` ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼æå–æ€§èƒ½æ•°æ®ï¼š

**ç¤ºä¾‹é…ç½®**:
```json
{
  "models": {
    "examples": {
      "performance_metrics": {
        "log_patterns": {
          "test_accuracy": "Test Accuracy[:\\s]+([0-9.]+)",
          "train_accuracy": "Train Accuracy[:\\s]+([0-9.]+)"
        }
      }
    },
    "VulBERTa": {
      "performance_metrics": {
        "log_patterns": {
          "accuracy": "Accuracy[:\\s]+([0-9.]+)",
          "f1": "F1[:\\s]+([0-9.]+)"
        }
      }
    }
  }
}
```

### æå–è¿‡ç¨‹

1. è¯»å– `terminal_output.txt`
2. åº”ç”¨ä»“åº“å¯¹åº”çš„æ­£åˆ™è¡¨è¾¾å¼
3. æå–ç¬¬ä¸€ä¸ªåŒ¹é…å€¼
4. è½¬æ¢ä¸ºæµ®ç‚¹æ•°
5. å¡«å……åˆ° `perf_*` åˆ—

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1: FileNotFoundError

```
FileNotFoundError: Session directory not found: results/run_20251213_100000
```

**è§£å†³**: æ£€æŸ¥è·¯å¾„æ˜¯å¦æ­£ç¡®

### é—®é¢˜2: æœªçŸ¥ä»“åº“è­¦å‘Š

```
âš ï¸  è·³è¿‡ exp_001: ä»“åº“é…ç½®æœªæ‰¾åˆ° (my_repo)
```

**è§£å†³**:
1. æ£€æŸ¥ `mutation/models_config.json`
2. æ·»åŠ ä»“åº“é…ç½®ï¼š
   ```json
   "my_repo": {
     "performance_metrics": {
       "log_patterns": {
         "accuracy": "Accuracy[:\\s]+([0-9.]+)"
       }
     }
   }
   ```

### é—®é¢˜3: æ‰€æœ‰å®éªŒéƒ½é‡å¤

```
âš ï¸  æœªæ‰¾åˆ°æ–°å®éªŒï¼Œæ— éœ€æ›´æ–°
```

**åŸå› **:
- Session ä¸­çš„æ‰€æœ‰å®éªŒå·²ç»åœ¨ `raw_data.csv` ä¸­

**éªŒè¯**:
```bash
# æ£€æŸ¥ session ä¸­çš„å®éªŒ ID
grep -r "experiment_id" results/run_20251213_100000/*/experiment.json

# æ£€æŸ¥ raw_data.csv ä¸­çš„ ID
cut -d',' -f1 results/raw_data.csv | sort
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **åŸå§‹è„šæœ¬**: `scripts/add_new_experiments_to_raw_data.py` - ç‰¹å®š session çš„ç‰ˆæœ¬
- **æµ‹è¯•å¥—ä»¶**: `tests/test_append_session_to_raw_data.py` - å®Œæ•´æµ‹è¯•
- **é…ç½®æ–‡ä»¶**: `mutation/models_config.json` - æ€§èƒ½æŒ‡æ ‡æå–è§„åˆ™
- **æ•°æ®æ ¼å¼**: `docs/OUTPUT_STRUCTURE_QUICKREF.md` - CSV æ ¼å¼è¯´æ˜

---

## ğŸ”„ ç‰ˆæœ¬å†å²

### v1.0 (2025-12-13)
- âœ… åˆå§‹ç‰ˆæœ¬
- âœ… æ”¯æŒé€šç”¨ session ç›®å½•
- âœ… è‡ªåŠ¨å»é‡
- âœ… æ€§èƒ½æ•°æ®æå–
- âœ… å®Œæ•´æµ‹è¯•è¦†ç›–ï¼ˆ10ä¸ªæµ‹è¯•ï¼Œ100%é€šè¿‡ï¼‰

---

**ç»´æŠ¤è€…**: Green + Claude (AI Assistant)
**æœ€åæ›´æ–°**: 2025-12-13
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
