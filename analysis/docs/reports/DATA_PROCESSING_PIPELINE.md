# èƒ½è€—æ•°æ®å› æœåˆ†æ - æ•°æ®å¤„ç†æµç¨‹æ–¹æ¡ˆ

**ç‰ˆæœ¬**: v1.0
**æ—¥æœŸ**: 2025-12-22
**çŠ¶æ€**: ğŸ“‹ è®¾è®¡å®Œæˆï¼Œå¾…å®æ–½

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£æè¿°äº†å°†ä¸»é¡¹ç›®çš„èƒ½è€—æ•°æ®ï¼ˆ`raw_data.csv`ï¼‰è½¬æ¢ä¸ºDiBSå› æœåˆ†ææ‰€éœ€æ ¼å¼çš„**å®Œæ•´8é˜¶æ®µæµç¨‹**ã€‚

### æ ¸å¿ƒç›®æ ‡

- ä»676ä¸ªå®éªŒä¸­æå–370ä¸ªæœ‰æ•ˆæ ·æœ¬
- åˆ†ä¸º4ä¸ªä»»åŠ¡ç»„è¿›è¡Œåˆ†å±‚å› æœåˆ†æ
- æ¯ä¸ªä»»åŠ¡ç»„åŒ…å«13-16ä¸ªå› æœå˜é‡
- ç”Ÿæˆæ ‡å‡†åŒ–ã€æ— ç¼ºå¤±å€¼ã€å¯ç›´æ¥ç”¨äºDiBSçš„è®­ç»ƒæ•°æ®

### æ–¹æ¡ˆç‰¹ç‚¹

âœ… **åˆ†é˜¶æ®µè®¾è®¡**ï¼š8ä¸ªç‹¬ç«‹é˜¶æ®µï¼Œæ¯é˜¶æ®µå¯å•ç‹¬æ‰§è¡Œå’ŒéªŒè¯
âœ… **å¯è¿½æº¯æ€§**ï¼šæ¯é˜¶æ®µéƒ½ä¿å­˜ä¸­é—´ç»“æœå’Œç»Ÿè®¡æŠ¥å‘Š
âœ… **å®¹é”™æ€§**ï¼šå¤±è´¥æ—¶ä¿å­˜æ£€æŸ¥ç‚¹ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ 
âœ… **éªŒè¯å®Œå¤‡**ï¼šæ¯é˜¶æ®µéƒ½æœ‰æ˜ç¡®çš„éªŒè¯ç‚¹å’Œè´¨é‡æ£€æŸ¥

---

## ğŸ”„ æ•´ä½“æµç¨‹å›¾

```
åŸå§‹æ•°æ® (raw_data.csv, 676è¡ŒÃ—87åˆ—)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ0: æ•°æ®éªŒè¯                             â”‚
â”‚ - æ£€æŸ¥æ•°æ®å®Œæ•´æ€§                            â”‚
â”‚ - ç»Ÿè®¡ä»»åŠ¡ç»„æ ·æœ¬é‡                          â”‚
â”‚ è¾“å‡º: stage0_validation_report.txt         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ1: è¶…å‚æ•°ç»Ÿä¸€                           â”‚
â”‚ - training_duration = epochs + max_iter    â”‚
â”‚ - l2_regularization = weight_decay + alpha â”‚
â”‚ è¾“å‡º: stage1_unified_data.csv (676Ã—89)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ2: èƒ½è€—ä¸­ä»‹å˜é‡                         â”‚
â”‚ - gpu_util_avg, gpu_temp_max               â”‚
â”‚ - cpu_pkg_ratio                            â”‚
â”‚ - gpu_power_fluctuation, gpu_temp_fluctuationâ”‚
â”‚ è¾“å‡º: stage2_with_mediators.csv (676Ã—94)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ3: ä»»åŠ¡åˆ†ç»„                             â”‚
â”‚ - 4ä¸ªä»»åŠ¡ç»„ (å›¾åƒåˆ†ç±»ã€Person_reIDã€       â”‚
â”‚   VulBERTaã€Bugå®šä½)                        â”‚
â”‚ è¾“å‡º: stage3_*.csv (4ä¸ªæ–‡ä»¶)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ4: One-Hotç¼–ç                           â”‚
â”‚ - å›¾åƒåˆ†ç±»: +2åˆ— (is_mnist, is_cifar10)    â”‚
â”‚ - Person_reID: +3åˆ— (æ¨¡å‹One-Hot)          â”‚
â”‚ è¾“å‡º: stage4_*.csv (4ä¸ªæ–‡ä»¶)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ5: å˜é‡é€‰æ‹©                             â”‚
â”‚ - æ ¹æ®å¡«å……ç‡>10%ç­›é€‰è¶…å‚æ•°                 â”‚
â”‚ - åªä¿ç•™13-16ä¸ªæ ¸å¿ƒå˜é‡                    â”‚
â”‚ è¾“å‡º: stage5_*.csv (4ä¸ªæ–‡ä»¶)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ6: å½’ä¸€åŒ–                               â”‚
â”‚ - StandardScaleræ ‡å‡†åŒ– (å‡å€¼0, æ–¹å·®1)      â”‚
â”‚ - åˆ é™¤å«NaNçš„è¡Œ                            â”‚
â”‚ è¾“å‡º: stage6_*.csv + scaler.pkl            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ7: æœ€ç»ˆéªŒè¯                             â”‚
â”‚ - æ£€æŸ¥æ ·æœ¬é‡â‰¥10                            â”‚
â”‚ - éªŒè¯æ— NaNï¼Œå‡å€¼~0ï¼Œæ ‡å‡†å·®~1              â”‚
â”‚ è¾“å‡º: training_data_*.csv (4ä¸ª) âœ…         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ8: DiBS + DMLå› æœåˆ†æ                   â”‚
â”‚ - DiBSå­¦ä¹ å› æœå›¾ (~60åˆ†é’Ÿ)                 â”‚
â”‚ - DMLä¼°è®¡å› æœæ•ˆåº”                          â”‚
â”‚ è¾“å‡º: å› æœå›¾ + å› æœæ•ˆåº” + æŠ¥å‘Š             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
æœ€ç»ˆæˆæœ
```

---

## ğŸ“Š å„é˜¶æ®µè¯¦ç»†è¯´æ˜

### é˜¶æ®µ0ï¼šæ•°æ®éªŒè¯ âœ…

**ç›®çš„**ï¼šç¡®ä¿raw_data.csvæ•°æ®è´¨é‡

**è¾“å…¥**ï¼š
- `../../data/raw_data.csv` (676è¡ŒÃ—87åˆ—)

**å¤„ç†**ï¼š
1. æ£€æŸ¥æ€»è¡Œæ•°ã€åˆ—æ•°
2. ç»Ÿè®¡æœ‰æ•ˆæ ·æœ¬ï¼ˆèƒ½è€—+æ€§èƒ½åŒæ—¶å­˜åœ¨ï¼‰
3. æ£€æŸ¥å…³é”®åˆ—å­˜åœ¨æ€§
4. ç»Ÿè®¡æ¯ä¸ªä»»åŠ¡ç»„çš„æ ·æœ¬é‡

**è¾“å‡º**ï¼š
- `data/stage0_validation_report.txt`

**éªŒè¯ç‚¹**ï¼š
```
âœ“ æ€»è¡Œæ•°: 676
âœ“ æœ‰æ•ˆæ ·æœ¬æ•°: 616 (91.1%)
âœ“ ä»»åŠ¡ç»„æ ·æœ¬é‡:
  - examples: 159ä¸ª
  - pytorch_resnet_cifar10: 26ä¸ª
  - Person_reID_baseline_pytorch: 93ä¸ª
  - VulBERTa: 52ä¸ª
  - bug-localization: 40ä¸ª
âœ“ å…³é”®åˆ—å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡
```

**è„šæœ¬**ï¼š`scripts/stage0_validate_raw_data.py`

---

### é˜¶æ®µ1ï¼šè¶…å‚æ•°ç»Ÿä¸€ ğŸ”„

**ç›®çš„**ï¼šåˆå¹¶è¯­ä¹‰ç›¸åŒçš„è¶…å‚æ•°

**è¾“å…¥**ï¼š
- `../../data/raw_data.csv`

**å¤„ç†**ï¼š
```python
# ç»Ÿä¸€è®­ç»ƒæ—¶é•¿
df['hyperparam_training_duration'] = df['hyperparam_epochs'].fillna(
    df['hyperparam_max_iter']
)

# ç»Ÿä¸€L2æ­£åˆ™åŒ–
df['hyperparam_l2_regularization'] = df['hyperparam_weight_decay'].fillna(
    df['hyperparam_alpha']
)
```

**è¾“å‡º**ï¼š
- `data/stage1_unified_data.csv` (676Ã—89, +2åˆ—)
- `data/stage1_unification_stats.txt`

**éªŒè¯ç‚¹**ï¼š
```
âœ“ æ–°å¢åˆ—: hyperparam_training_duration, hyperparam_l2_regularization
âœ“ training_durationå¡«å……ç‡: 96.1%
  - æ¥è‡ªepochs: 90.2%
  - æ¥è‡ªmax_iter: 5.9%
âœ“ l2_regularizationå¡«å……ç‡: 17.3%
âœ“ äº’æ–¥æ€§æ£€éªŒ: 100%é€šè¿‡
```

**è„šæœ¬**ï¼š`scripts/stage1_unify_hyperparameters.py`

---

### é˜¶æ®µ2ï¼šèƒ½è€—ä¸­ä»‹å˜é‡ âš¡

**ç›®çš„**ï¼šæ·»åŠ 5ä¸ªèƒ½è€—ä¸­ä»‹å˜é‡

**è¾“å…¥**ï¼š
- `data/stage1_unified_data.csv`

**å¤„ç†**ï¼š
```python
# 1. GPUåˆ©ç”¨ç‡
df['gpu_util_avg'] = df['energy_gpu_util_avg_percent']

# 2. GPUæœ€é«˜æ¸©åº¦
df['gpu_temp_max'] = df['energy_gpu_temp_max_celsius']

# 3. CPU Packageèƒ½è€—æ¯”ä¾‹
df['cpu_pkg_ratio'] = df['energy_cpu_pkg_joules'] / (
    df['energy_cpu_total_joules'] + 1e-9
)

# 4. GPUåŠŸç‡æ³¢åŠ¨
df['gpu_power_fluctuation'] = (
    df['energy_gpu_max_watts'] - df['energy_gpu_min_watts']
)

# 5. GPUæ¸©åº¦æ³¢åŠ¨
df['gpu_temp_fluctuation'] = (
    df['energy_gpu_temp_max_celsius'] - df['energy_gpu_temp_avg_celsius']
)
```

**è¾“å‡º**ï¼š
- `data/stage2_with_mediators.csv` (676Ã—94, +5åˆ—)
- `data/stage2_mediator_stats.txt`

**éªŒè¯ç‚¹**ï¼š
```
âœ“ æ–°å¢5åˆ—ä¸­ä»‹å˜é‡
âœ“ å¡«å……ç‡ç»Ÿè®¡: 79.4%-91.1%
âœ“ æ•°æ®èŒƒå›´æ£€æŸ¥:
  - gpu_util_avg: [0, 100] %
  - gpu_temp_max: [30, 85] Â°C
  - cpu_pkg_ratio: [0, 1]
  - gpu_temp_fluctuation: [0, 11.1] Â°C âœ“ åˆç†
```

**è„šæœ¬**ï¼š`scripts/stage2_add_mediators.py`

---

### é˜¶æ®µ3ï¼šä»»åŠ¡åˆ†ç»„ ğŸ“‚

**ç›®çš„**ï¼šå°†æ•°æ®åˆ†ä¸º4ä¸ªä»»åŠ¡ç»„

**è¾“å…¥**ï¼š
- `data/stage2_with_mediators.csv`

**å¤„ç†**ï¼š
```python
for task_name, config in TASK_GROUPS.items():
    # ç­›é€‰ä»»åŠ¡ç›¸å…³æ•°æ®
    df_task = df[df['repository'].isin(config['repositories'])].copy()

    # åªä¿ç•™æœ‰æ•ˆæ ·æœ¬ï¼ˆèƒ½è€—+æ€§èƒ½åŒæ—¶å­˜åœ¨ï¼‰
    df_task = df_task[
        df_task['energy_cpu_total_joules'].notna() &
        df_task['energy_gpu_total_joules'].notna() &
        df_task[config['perf_col']].notna()
    ]

    # ä¿å­˜
    df_task.to_csv(f'data/stage3_{task_name}.csv', index=False)
```

**è¾“å‡º**ï¼š
- `data/stage3_image_classification.csv` (185Ã—94)
- `data/stage3_person_reid.csv` (93Ã—94)
- `data/stage3_vulberta.csv` (52Ã—94)
- `data/stage3_bug_localization.csv` (40Ã—94)
- `data/stage3_task_split_stats.txt`

**éªŒè¯ç‚¹**ï¼š
```
âœ“ ä»»åŠ¡ç»„åˆ†å‰²å®Œæˆ:
  - image_classification: 185è¡Œ (50.0%)
  - person_reid: 93è¡Œ (25.1%)
  - vulberta: 52è¡Œ (14.1%)
  - bug_localization: 40è¡Œ (10.8%)
âœ“ æ€»æœ‰æ•ˆæ ·æœ¬: 370è¡Œ
âœ“ æ¯ä¸ªä»»åŠ¡ç»„éƒ½æ»¡è¶³DiBSæœ€ä½è¦æ±‚ (â‰¥10)
```

**è„šæœ¬**ï¼š`scripts/stage3_split_task_groups.py`

---

### é˜¶æ®µ4ï¼šOne-Hotç¼–ç  ğŸ·ï¸

**ç›®çš„**ï¼šä¸ºåˆå¹¶çš„ä»»åŠ¡ç»„æ·»åŠ One-Hotå˜é‡

**è¾“å…¥**ï¼š
- `data/stage3_*.csv` (4ä¸ªæ–‡ä»¶)

**å¤„ç†**ï¼š
```python
# å›¾åƒåˆ†ç±»ï¼šæ·»åŠ is_mnist, is_cifar10
df_image['is_mnist'] = (df_image['repository'] == 'examples').astype(int)
df_image['is_cifar10'] = (df_image['repository'] == 'pytorch_resnet_cifar10').astype(int)

# Person_reIDï¼šæ·»åŠ is_densenet121, is_hrnet18, is_pcb
df_reid['is_densenet121'] = (df_reid['model'] == 'densenet121').astype(int)
df_reid['is_hrnet18'] = (df_reid['model'] == 'hrnet18').astype(int)
df_reid['is_pcb'] = (df_reid['model'] == 'pcb').astype(int)

# VulBERTaå’ŒBugå®šä½ï¼šæ— éœ€One-Hot
```

**è¾“å‡º**ï¼š
- `data/stage4_image_classification.csv` (185Ã—96, +2åˆ—)
- `data/stage4_person_reid.csv` (93Ã—97, +3åˆ—)
- `data/stage4_vulberta.csv` (52Ã—94, æ— å˜åŒ–)
- `data/stage4_bug_localization.csv` (40Ã—94, æ— å˜åŒ–)
- `data/stage4_onehot_stats.txt`

**éªŒè¯ç‚¹**ï¼š
```
âœ“ One-Hotç¼–ç æ·»åŠ å®Œæˆ:
  - image_classification: +2åˆ—
    - is_mnist: 159 (85.9%)
    - is_cifar10: 26 (14.1%)
    - äº’æ–¥æ€§: 100% âœ“
  - person_reid: +3åˆ—
    - densenet121: 30 (32.3%)
    - hrnet18: 32 (34.4%)
    - pcb: 31 (33.3%)
    - äº’æ–¥æ€§: 100% âœ“
```

**è„šæœ¬**ï¼š`scripts/stage4_add_onehot.py`

---

### é˜¶æ®µ5ï¼šå˜é‡é€‰æ‹© ğŸ¯

**ç›®çš„**ï¼šæ ¹æ®å¡«å……ç‡åŠ¨æ€é€‰æ‹©è¶…å‚æ•°

**è¾“å…¥**ï¼š
- `data/stage4_*.csv` (4ä¸ªæ–‡ä»¶)

**å¤„ç†**ï¼š
```python
# åŸºç¡€å˜é‡ï¼ˆå¿…é€‰ï¼‰
base_vars = ['energy_cpu_total_joules', 'energy_gpu_total_joules', perf_col]

# èƒ½è€—ä¸­ä»‹ï¼ˆå¿…é€‰ï¼‰
mediator_vars = ['gpu_util_avg', 'gpu_temp_max', 'cpu_pkg_ratio',
                 'gpu_power_fluctuation', 'gpu_temp_fluctuation']

# è¶…å‚æ•°ï¼ˆå¡«å……ç‡>10%ç­›é€‰ï¼‰
selected_hyperparams = [hp for hp in candidates
                       if df[hp].notna().sum() / len(df) > 0.10]

# One-Hotï¼ˆå¦‚æœå­˜åœ¨ï¼‰
onehot_vars = [col for col in df.columns if col.startswith('is_')]

# åˆå¹¶
final_vars = base_vars + mediator_vars + selected_hyperparams + onehot_vars
```

**è¾“å‡º**ï¼š
- `data/stage5_image_classification.csv` (185Ã—15)
- `data/stage5_person_reid.csv` (93Ã—16)
- `data/stage5_vulberta.csv` (52Ã—13)
- `data/stage5_bug_localization.csv` (40Ã—13)
- `data/stage5_variable_selection_report.txt`

**éªŒè¯ç‚¹**ï¼š
```
âœ“ å˜é‡é€‰æ‹©å®Œæˆ:
  å›¾åƒåˆ†ç±» (15å˜é‡):
    âœ“ è¶…å‚æ•° (3ä¸ª): learning_rate, batch_size, training_duration
    âœ“ èƒ½è€— (7ä¸ª): 2æ€»é‡ + 5ä¸­ä»‹
    âœ“ æ€§èƒ½ (1ä¸ª): perf_test_accuracy
    âœ“ One-Hot (2ä¸ª): is_mnist, is_cifar10
    âœ— æ’é™¤: dropout (7%), l2_regularization (9%), seed (å¡«å……ç‡ä¸è¶³æˆ–ä»»åŠ¡ç‰¹å®š)

  Person_reID (16å˜é‡):
    âœ“ è¶…å‚æ•° (3ä¸ª): learning_rate, dropout, training_duration
    âœ“ One-Hot (3ä¸ª): 3ä¸ªæ¨¡å‹
    âœ— æ’é™¤: batch_size (0%), l2_regularization (0%), seed (å¡«å……ç‡ä¸è¶³æˆ–ä»»åŠ¡ç‰¹å®š)
```

**è„šæœ¬**ï¼š`scripts/stage5_select_variables.py`

---

### é˜¶æ®µ6ï¼šå½’ä¸€åŒ– ğŸ“

**ç›®çš„**ï¼šä½¿ç”¨StandardScaleræ ‡å‡†åŒ–æ•°æ®

**è¾“å…¥**ï¼š
- `data/stage5_*.csv` (4ä¸ªæ–‡ä»¶)

**å¤„ç†**ï¼š
```python
from sklearn.preprocessing import StandardScaler

# 1. å¤„ç†ç¼ºå¤±å€¼ï¼ˆåˆ é™¤å«NaNçš„è¡Œï¼‰
df_clean = df.dropna()

# 2. æ ‡å‡†åŒ–
scaler = StandardScaler()
data_normalized = scaler.fit_transform(df_clean)

# 3. ä¿å­˜æ•°æ®å’Œscaler
df_normalized.to_csv(f'data/stage6_{task_name}.csv', index=False)

import pickle
with open(f'data/stage6_{task_name}_scaler.pkl', 'wb') as f:
    pickle.dump(scaler, f)
```

**è¾“å‡º**ï¼š
- `data/stage6_*.csv` (4ä¸ªæ–‡ä»¶ï¼Œæ ‡å‡†åŒ–å)
- `data/stage6_*_scaler.pkl` (4ä¸ªscalerå¯¹è±¡)
- `data/stage6_normalization_stats.txt`

**éªŒè¯ç‚¹**ï¼š
```
âœ“ å½’ä¸€åŒ–å®Œæˆ:
  å›¾åƒåˆ†ç±»:
    âœ“ ç¼ºå¤±å€¼å¤„ç†: 185è¡Œ â†’ 185è¡Œ (100.0%)
    âœ“ å‡å€¼: ~0.00 âœ“
    âœ“ æ ‡å‡†å·®: ~1.00 âœ“

  Person_reID:
    âœ“ ç¼ºå¤±å€¼å¤„ç†: 93è¡Œ â†’ 85è¡Œ (91.4%)
    âš ï¸ æŸå¤±8è¡Œï¼ˆdropoutåˆ—æœ‰ç¼ºå¤±ï¼‰

  VulBERTa:
    âœ“ 100.0%ä¿ç•™

  Bugå®šä½:
    âœ“ 100.0%ä¿ç•™
```

**è„šæœ¬**ï¼š`scripts/stage6_normalize.py`

---

### é˜¶æ®µ7ï¼šæœ€ç»ˆéªŒè¯ âœ”ï¸

**ç›®çš„**ï¼šéªŒè¯è®­ç»ƒæ•°æ®è´¨é‡

**è¾“å…¥**ï¼š
- `data/stage6_*.csv` (4ä¸ªæ–‡ä»¶)

**å¤„ç†**ï¼š
```python
# 1. æ£€æŸ¥æ ·æœ¬é‡â‰¥10
assert len(df) >= 10

# 2. æ£€æŸ¥åˆ—æ•°
assert len(df.columns) == expected_cols

# 3. æ£€æŸ¥æ— NaN
assert df.isna().sum().sum() == 0

# 4. æ£€æŸ¥æ ‡å‡†åŒ–
assert all(abs(df.mean()) < 1e-10)
assert all(abs(df.std() - 1) < 1e-10)

# 5. å¤åˆ¶ä¸ºtraining_data
df.to_csv(f'data/training_data_{task_name}.csv', index=False)
```

**è¾“å‡º**ï¼š
- `data/training_data_image_classification.csv` (185Ã—15) âœ…
- `data/training_data_person_reid.csv` (85Ã—16) âœ…
- `data/training_data_vulberta.csv` (52Ã—13) âœ…
- `data/training_data_bug_localization.csv` (40Ã—13) âœ…
- `data/stage7_final_validation_report.txt`

**éªŒè¯ç‚¹**ï¼š
```
================================================================================
æœ€ç»ˆéªŒè¯æŠ¥å‘Š
================================================================================

âœ… æ‰€æœ‰ä»»åŠ¡ç»„é€šè¿‡éªŒè¯

ã€å›¾åƒåˆ†ç±»ã€‘
  âœ“ æ ·æœ¬é‡: 185 (å……è¶³ï¼Œæ¨èèŒƒå›´)
  âœ“ å˜é‡æ•°: 15
  âœ“ æ— ç¼ºå¤±å€¼: 100%
  âœ“ æ ‡å‡†åŒ–æ£€æŸ¥: é€šè¿‡
  â†’ data/training_data_image_classification.csv

ã€Person_reIDæ£€ç´¢ã€‘
  âœ“ æ ·æœ¬é‡: 85 (å……è¶³)
  âœ“ å˜é‡æ•°: 16
  âœ“ æ— ç¼ºå¤±å€¼: 100%
  âœ“ æ ‡å‡†åŒ–æ£€æŸ¥: é€šè¿‡

ã€VulBERTaæ¼æ´æ£€æµ‹ã€‘
  âœ“ æ ·æœ¬é‡: 52 (å……è¶³)
  âœ“ å˜é‡æ•°: 13
  âœ“ æ— ç¼ºå¤±å€¼: 100%

ã€Bugå®šä½ã€‘
  âœ“ æ ·æœ¬é‡: 40 (å¯ç”¨)
  âš ï¸ æ ·æœ¬é‡è¾ƒå°‘ï¼Œç»Ÿè®¡åŠŸæ•ˆå¯èƒ½ä¸è¶³
  âœ“ å˜é‡æ•°: 13
  âœ“ æ— ç¼ºå¤±å€¼: 100%

================================================================================
å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹DiBSå› æœå›¾å­¦ä¹ 
================================================================================
```

**è„šæœ¬**ï¼š`scripts/stage7_final_validation.py`

---

### é˜¶æ®µ8ï¼šDiBS + DMLå› æœåˆ†æ ğŸ”¬

**ç›®çš„**ï¼šå­¦ä¹ å› æœå›¾å¹¶ä¼°è®¡å› æœæ•ˆåº”

**è¾“å…¥**ï¼š
- `data/training_data_*.csv` (4ä¸ªæ–‡ä»¶)

**å¤„ç†**ï¼š
```python
# 1. DiBSå› æœå›¾å­¦ä¹ 
from utils.causal_discovery import CausalGraphLearner

learner = CausalGraphLearner(
    n_vars=len(df.columns),
    n_steps=3000,
    alpha=0.1,
    random_seed=42
)

causal_graph = learner.fit(df, verbose=True)
learner.save_graph(f'results/{task_name}_causal_graph.npy')

# 2. DMLå› æœæ¨æ–­
from utils.causal_inference import CausalInferenceEngine

engine = CausalInferenceEngine(verbose=True)
causal_effects = engine.analyze_all_edges(
    data=df,
    causal_graph=causal_graph,
    var_names=df.columns.tolist(),
    threshold=0.3
)

engine.save_results(f'results/{task_name}_causal_effects.csv')
```

**è¾“å‡º**ï¼š
- `results/image_classification_causal_graph.npy`
- `results/image_classification_causal_effects.csv`
- `results/image_classification_report.md`
- (Person_reIDã€VulBERTaã€Bugå®šä½å„ä¸€å¥—)
- `results/cross_task_summary.md` (ç»¼åˆæŠ¥å‘Š)

**é¢„ä¼°æ—¶é—´**ï¼š
- å›¾åƒåˆ†ç±»: ~30åˆ†é’Ÿ (185æ ·æœ¬, 15å˜é‡)
- Person_reID: ~15åˆ†é’Ÿ (85æ ·æœ¬, 16å˜é‡)
- VulBERTa: ~8åˆ†é’Ÿ (52æ ·æœ¬, 13å˜é‡)
- Bugå®šä½: ~6åˆ†é’Ÿ (40æ ·æœ¬, 13å˜é‡)
- **æ€»è®¡**: ~60åˆ†é’Ÿ

**è„šæœ¬**ï¼š`scripts/stage8_causal_analysis.py`

---

## ğŸ“ è„šæœ¬ç»„ç»‡ç»“æ„

```
analysis/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ stage0_validate_raw_data.py
â”‚   â”œâ”€â”€ stage1_unify_hyperparameters.py
â”‚   â”œâ”€â”€ stage2_add_mediators.py
â”‚   â”œâ”€â”€ stage3_split_task_groups.py
â”‚   â”œâ”€â”€ stage4_add_onehot.py
â”‚   â”œâ”€â”€ stage5_select_variables.py
â”‚   â”œâ”€â”€ stage6_normalize.py
â”‚   â”œâ”€â”€ stage7_final_validation.py
â”‚   â”œâ”€â”€ stage8_causal_analysis.py
â”‚   â”‚
â”‚   â”œâ”€â”€ run_all_stages.sh          # ğŸš€ ä¸€é”®è¿è¡Œæ‰€æœ‰é˜¶æ®µ
â”‚   â””â”€â”€ run_stage.py                # ğŸ¯ å•ç‹¬è¿è¡ŒæŒ‡å®šé˜¶æ®µ
â”‚
â”œâ”€â”€ data/                            # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ stage0_validation_report.txt
â”‚   â”œâ”€â”€ stage1_unified_data.csv
â”‚   â”œâ”€â”€ stage2_with_mediators.csv
â”‚   â”œâ”€â”€ stage3_*.csv (4ä¸ª)
â”‚   â”œâ”€â”€ stage4_*.csv (4ä¸ª)
â”‚   â”œâ”€â”€ stage5_*.csv (4ä¸ª)
â”‚   â”œâ”€â”€ stage6_*.csv (4ä¸ª)
â”‚   â”œâ”€â”€ stage6_*_scaler.pkl (4ä¸ª)
â”‚   â”œâ”€â”€ training_data_*.csv (4ä¸ª) âœ… æœ€ç»ˆè¾“å…¥
â”‚   â””â”€â”€ *.txt (å„é˜¶æ®µç»Ÿè®¡æŠ¥å‘Š)
â”‚
â”œâ”€â”€ results/                         # ç»“æœç›®å½•
â”‚   â”œâ”€â”€ *_causal_graph.npy (4ä¸ª)
â”‚   â”œâ”€â”€ *_causal_effects.csv (4ä¸ª)
â”‚   â”œâ”€â”€ *_report.md (4ä¸ª)
â”‚   â””â”€â”€ cross_task_summary.md
â”‚
â”œâ”€â”€ config_energy.py                 # é…ç½®æ–‡ä»¶
â””â”€â”€ docs/reports/
    â””â”€â”€ DATA_PROCESSING_PIPELINE.md  # æœ¬æ–‡æ¡£
```

---

## ğŸ® æ‰§è¡Œæ–¹å¼

### æ–¹å¼1ï¼šä¸€é”®è¿è¡Œæ‰€æœ‰é˜¶æ®µ

```bash
cd /home/green/energy_dl/nightly/analysis
conda activate fairness
bash scripts/run_all_stages.sh
```

### æ–¹å¼2ï¼šé€é˜¶æ®µæ‰§è¡Œï¼ˆæ¨èç”¨äºè°ƒè¯•ï¼‰

```bash
conda activate fairness

# é˜¶æ®µ0ï¼šæ•°æ®éªŒè¯
python scripts/stage0_validate_raw_data.py
# æ£€æŸ¥: data/stage0_validation_report.txt

# é˜¶æ®µ1ï¼šè¶…å‚æ•°ç»Ÿä¸€
python scripts/stage1_unify_hyperparameters.py
# æ£€æŸ¥: data/stage1_unified_data.csv

# é˜¶æ®µ2ï¼šèƒ½è€—ä¸­ä»‹å˜é‡
python scripts/stage2_add_mediators.py
# æ£€æŸ¥: data/stage2_with_mediators.csv

# ... ä¾æ­¤ç±»æ¨
```

### æ–¹å¼3ï¼šä»æŒ‡å®šé˜¶æ®µå¼€å§‹

```bash
# ä»é˜¶æ®µ5å¼€å§‹ï¼ˆå‡è®¾0-4å·²å®Œæˆï¼‰
python scripts/run_stage.py --start 5
```

---

## âš ï¸ å…³é”®æ³¨æ„äº‹é¡¹

### 1. æ•°æ®è´¨é‡æ£€æŸ¥

æ¯ä¸ªé˜¶æ®µéƒ½åº”è¯¥æ£€æŸ¥ï¼š
- âœ… æ–‡ä»¶æ˜¯å¦ç”Ÿæˆ
- âœ… è¡Œæ•°/åˆ—æ•°æ˜¯å¦ç¬¦åˆé¢„æœŸ
- âœ… ç»Ÿè®¡æŠ¥å‘Šæ˜¯å¦æœ‰å¼‚å¸¸å€¼æˆ–è­¦å‘Š
- âœ… æ•°æ®è´¨é‡ï¼ˆç¼ºå¤±å€¼ã€é‡å¤å€¼ã€å¼‚å¸¸å€¼ï¼‰

### 2. ä¸­é—´ç»“æœä¿å­˜

- æ‰€æœ‰é˜¶æ®µçš„ä¸­é—´ç»“æœéƒ½ä¿å­˜åœ¨ `data/` ç›®å½•
- å¤±è´¥æ—¶å¯ä»ä¸Šä¸€é˜¶æ®µçš„è¾“å‡ºé‡æ–°å¼€å§‹
- é¿å…é‡å¤è¿è¡Œè€—æ—¶çš„æ—©æœŸé˜¶æ®µ

### 3. é…ç½®æ–‡ä»¶

- æ‰€æœ‰å‚æ•°éƒ½åœ¨ `config_energy.py` ä¸­å®šä¹‰
- ä¿®æ”¹é…ç½®åéœ€é‡æ–°è¿è¡Œç›¸å…³é˜¶æ®µ
- ä¿æŒé…ç½®æ–‡ä»¶å’Œå®é™…æ‰§è¡Œçš„ä¸€è‡´æ€§

### 4. è®¡ç®—èµ„æº

- é˜¶æ®µ0-7ï¼šä¸»è¦æ˜¯æ•°æ®å¤„ç†ï¼ŒCPUå³å¯ï¼Œå‡ åˆ†é’Ÿå†…å®Œæˆ
- é˜¶æ®µ8ï¼šDiBS + DMLåˆ†æï¼Œæ¨èGPUï¼Œçº¦60åˆ†é’Ÿ
- ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆçº¦500MBï¼‰

---

## ğŸ“Š é¢„æœŸæœ€ç»ˆæˆæœ

### è®­ç»ƒæ•°æ® (4ä¸ªæ–‡ä»¶)

| ä»»åŠ¡ç»„ | æ–‡ä»¶å | æ ·æœ¬é‡ | å˜é‡æ•° | DiBSå¯è¡Œæ€§ |
|--------|--------|--------|--------|-----------|
| å›¾åƒåˆ†ç±» | training_data_image_classification.csv | 185 | 15 | âœ… å……è¶³ |
| Person_reID | training_data_person_reid.csv | 85 | 16 | âœ… å……è¶³ |
| VulBERTa | training_data_vulberta.csv | 52 | 13 | âœ… å¯è¡Œ |
| Bugå®šä½ | training_data_bug_localization.csv | 40 | 13 | âš ï¸ è¾ƒå°‘ |

### å› æœåˆ†æç»“æœ (4ç»„)

æ¯ä¸ªä»»åŠ¡ç»„åŒ…å«ï¼š
1. **å› æœå›¾** (`*_causal_graph.npy`) - DiBSå­¦ä¹ çš„é‚»æ¥çŸ©é˜µ
2. **å› æœæ•ˆåº”** (`*_causal_effects.csv`) - DMLä¼°è®¡çš„ATEã€ç½®ä¿¡åŒºé—´ã€på€¼
3. **åˆ†ææŠ¥å‘Š** (`*_report.md`) - å…³é”®å‘ç°å’Œå¯è§†åŒ–

### ç»¼åˆæŠ¥å‘Š

- `cross_task_summary.md` - è·¨ä»»åŠ¡å…±æ€§å‘ç°å’Œæ¯”è¾ƒ

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [VARIABLE_EXPANSION_PLAN.md](VARIABLE_EXPANSION_PLAN.md) - å˜é‡æ‰©å±•æ–¹æ¡ˆè¯¦è§£ v3.0
- [DATA_PROCESSING_SUMMARY.md](DATA_PROCESSING_SUMMARY.md) - æ•°æ®å¤„ç†æ–¹æ¡ˆæ€»ç»“
- [config_energy.py](../../config_energy.py) - é…ç½®å‚æ•°æ–‡ä»¶
- [ADULT_COMPLETE_CAUSAL_ANALYSIS_REPORT.md](ADULT_COMPLETE_CAUSAL_ANALYSIS_REPORT.md) - Adultå®éªŒå‚è€ƒ

---

**ç»´æŠ¤è€…**: Green + Claude
**æœ€åæ›´æ–°**: 2025-12-22
**ä¸‹ä¸€æ­¥**: å®æ–½é˜¶æ®µ0-7çš„é¢„å¤„ç†è„šæœ¬
