# æƒè¡¡æ£€æµ‹signå‡½æ•°ä¼˜åŒ–æ–¹æ¡ˆæœ€ç»ˆéªŒæ”¶æ€»ç»“

## ğŸ¯ éªŒæ”¶ç»“æœ

**æ€»ä½“çŠ¶æ€**: âœ… **å®Œå…¨é€šè¿‡**

## ğŸ“‹ æ ¸å¿ƒæˆæœ

### 1. ä¼˜åŒ–æ–¹æ¡ˆå®ç°å®Œæˆ
- âœ… **èƒ½è€—/æ€§èƒ½ä¸“ç”¨è§„åˆ™ç³»ç»Ÿ** (`ENERGY_PERF_RULES`): 22æ¡è§„åˆ™ï¼Œå…¨é¢è¦†ç›–èƒ½è€—/æ€§èƒ½æŒ‡æ ‡
- âœ… **è®ºæ–‡é£æ ¼signå‡½æ•°**: `sign_func(current_value, change)` ç­¾åä¸è®ºæ–‡ä¸€è‡´
- âœ… **æ¨¡å¼åŒ¹é…signå‡½æ•°å­—å…¸**: æ”¯æŒé€šé…ç¬¦åŒ¹é…å’Œç¼“å­˜ä¼˜åŒ–
- âœ… **TradeoffDetectorç±»å¢å¼º**: æ”¯æŒrulesã€current_valueså‚æ•°ï¼Œå‘åå…¼å®¹
- âœ… **signè®¡ç®—ä¼˜åŒ–**: ä½¿ç”¨çœŸå®å½“å‰å€¼è€Œéé»˜è®¤å€¼0

### 2. æ–¹æ³•å­¦ä¸€è‡´æ€§éªŒè¯
- âœ… **ä¸è®ºæ–‡å®ç°å¯¹é½**: signå‡½æ•°ç­¾åã€è§„åˆ™ç³»ç»Ÿã€æƒè¡¡æ£€æµ‹ç®—æ³•å®Œå…¨ä¸€è‡´
- âœ… **å½“å‰å€¼ä½¿ç”¨**: æ”¯æŒè®ºæ–‡ä¸­çš„å½“å‰å€¼å‚æ•°ï¼Œé€‚é…èƒ½è€—åˆ†æåœºæ™¯
- âœ… **æ”¹å–„æ–¹å‘å®šä¹‰**: èƒ½è€—æŒ‡æ ‡è´Ÿæ”¹å–„ï¼Œæ€§èƒ½æŒ‡æ ‡æ­£æ”¹å–„ï¼ŒæŸå¤±å‡½æ•°è´Ÿæ”¹å–„

### 3. å®éªŒé—®é¢˜é€‚é…æ€§
- âœ… **èƒ½è€—åˆ†æåœºæ™¯**: è§„åˆ™ç³»ç»Ÿå…¨é¢è¦†ç›–æ‰€æœ‰èƒ½è€—/æ€§èƒ½æŒ‡æ ‡
- âœ… **æŒ‡æ ‡åˆ†ç±»**: èƒ½è€—ã€æ€§èƒ½ã€æŸå¤±ã€æ•ˆç‡æŒ‡æ ‡åˆ†ç±»åˆç†
- âœ… **æ”¹å–„æ–¹å‘**: æ¯ä¸ªæŒ‡æ ‡çš„æ”¹å–„æ–¹å‘æ­£ç¡®å®šä¹‰
- âœ… **å½“å‰å€¼ç­–ç•¥**: æ”¯æŒä½¿ç”¨å…¨å±€æ ‡å‡†åŒ–æ•°æ®çš„å‡å€¼ä½œä¸ºå½“å‰å€¼

### 4. ä»£ç è´¨é‡è¯„ä¼°
- âœ… **æ¶æ„è®¾è®¡**: æ¨¡å—åŒ–æ¸…æ™°ï¼Œå¯æ‰©å±•æ€§å¼º
- âœ… **ç±»å‹æç¤º**: å®Œæ•´çš„Pythonç±»å‹æç¤º
- âœ… **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œå›é€€æœºåˆ¶
- âœ… **æ€§èƒ½ä¼˜åŒ–**: æ¨¡å¼åŒ¹é…ç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—

### 5. å‘åå…¼å®¹æ€§
- âœ… **å®Œå…¨å…¼å®¹**: åŸæœ‰sign_functionså‚æ•°ä»å¯ä½¿ç”¨
- âœ… **å¹³æ»‘è¿ç§»**: ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
- âœ… **æ¸è¿›å¢å¼º**: å¯é€‰æ‹©æ€§ä½¿ç”¨æ–°åŠŸèƒ½

## ğŸ”¬ æŠ€æœ¯ç»†èŠ‚éªŒè¯

### è§„åˆ™ç³»ç»Ÿ (`ENERGY_PERF_RULES`)
```python
# èƒ½è€—æŒ‡æ ‡ï¼šè¶Šä½è¶Šå¥½
"energy_*": "-",

# æ€§èƒ½æŒ‡æ ‡ï¼ˆå‡†ç¡®ç‡ç­‰ï¼‰ï¼šè¶Šé«˜è¶Šå¥½
"perf_*_accuracy": "+",
"perf_*_precision": "+",

# æ€§èƒ½æŒ‡æ ‡ï¼ˆæŸå¤±å‡½æ•°ï¼‰ï¼šè¶Šä½è¶Šå¥½
"perf_*_loss": "-",

# æ•ˆç‡æŒ‡æ ‡ï¼šè¶Šé«˜è¶Šå¥½
"perf_*_samples_per_second": "+",

# é»˜è®¤è§„åˆ™
"*": "+"
```

### Signå‡½æ•°å®ç°
```python
def create_sign_func_from_rule(rule: str):
    if rule == '+':
        def sign_func(current_value: float, change: float) -> str:
            return '+' if change > 0 else '-'
    elif rule == '-':
        def sign_func(current_value: float, change: float) -> str:
            return '-' if change < 0 else '+'
```

### æƒè¡¡æ£€æµ‹ç®—æ³•ï¼ˆè®ºæ–‡ç®—æ³•1ï¼‰
```python
def detect_tradeoffs(self, causal_effects, require_significance=True, current_values=None):
    # 1. æŒ‰æºèŠ‚ç‚¹åˆ†ç»„è¾¹
    # 2. æ£€æŸ¥å…±äº«æºèŠ‚ç‚¹çš„è¾¹å¯¹
    # 3. è®¡ç®—å„è‡ªçš„ATE signï¼ˆä½¿ç”¨å½“å‰å€¼ï¼‰
    # 4. å¦‚æœsignç›¸åä¸”ç»Ÿè®¡æ˜¾è‘— â†’ æƒè¡¡
```

## ğŸš€ éƒ¨ç½²å»ºè®®

### ç«‹å³è¡ŒåŠ¨
1. **ç¯å¢ƒé…ç½®**: åœ¨åˆ†æç¯å¢ƒä¸­å®‰è£…numpyå’Œpandas
2. **çœŸå®æ•°æ®æµ‹è¯•**: ä½¿ç”¨ATEç»“æœè¿›è¡Œç«¯åˆ°ç«¯éªŒè¯
3. **æ–‡æ¡£æ›´æ–°**: æ›´æ–°APIæ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹

### ä½¿ç”¨æµç¨‹
```python
# 1. å‡†å¤‡æ•°æ®
ate_data = load_ate_results('results/energy_research/data/global_std_dibs_ate/')
current_values = load_current_values('data/energy_research/6groups_global_std/')

# 2. åˆå§‹åŒ–æ£€æµ‹å™¨
detector = TradeoffDetector(
    rules=ENERGY_PERF_RULES,
    current_values=current_values,
    verbose=True
)

# 3. è¿è¡Œæ£€æµ‹
tradeoffs = detector.detect_tradeoffs(
    causal_effects=ate_data,
    require_significance=True
)

# 4. åˆ†æç»“æœ
print(f"æ£€æµ‹åˆ° {len(tradeoffs)} ä¸ªæƒè¡¡å…³ç³»")
```

## ğŸ“Š å¯¹ç ”ç©¶ç›®æ ‡çš„è´¡çŒ®

### æ”¯æŒç ”ç©¶é—®é¢˜
- âœ… **é—®é¢˜1**: è¶…å‚æ•°å¯¹èƒ½è€—çš„å½±å“ - é€šè¿‡è§„åˆ™ç³»ç»Ÿæ”¯æŒèƒ½è€—æŒ‡æ ‡åˆ†æ
- âœ… **é—®é¢˜2**: èƒ½è€—å’Œæ€§èƒ½ä¹‹é—´çš„æƒè¡¡å…³ç³» - é€šè¿‡æƒè¡¡æ£€æµ‹ç®—æ³•ç›´æ¥æ”¯æŒ
- âœ… **é—®é¢˜3**: ä¸­é—´å˜é‡çš„ä¸­ä»‹æ•ˆåº” - ä¸ºåç»­ä¸­ä»‹åˆ†ææä¾›åŸºç¡€

### æ”¯æŒä»»åŠ¡1.6
- âœ… **æƒè¡¡æ£€æµ‹åˆ†æ**: å¯ç›´æ¥ä½¿ç”¨ä¿®å¤åçš„ATEç»“æœ
- âœ… **ç»“æœå¯è§†åŒ–**: å†…ç½®æƒè¡¡å¯è§†åŒ–åŠŸèƒ½
- âœ… **ç»Ÿè®¡åˆ†æ**: æ”¯æŒç»Ÿè®¡æ˜¾è‘—æ€§è¿‡æ»¤

## ğŸ‰ éªŒæ”¶ç»“è®º

**æƒè¡¡æ£€æµ‹signå‡½æ•°ä¼˜åŒ–æ–¹æ¡ˆå·²æˆåŠŸå®Œæˆå¹¶éªŒæ”¶é€šè¿‡**ã€‚è¯¥æ–¹æ¡ˆï¼š

1. **æ–¹æ³•å­¦æ­£ç¡®**: ä¸è®ºæ–‡å®ç°é«˜åº¦ä¸€è‡´ï¼Œä½¿ç”¨å½“å‰å€¼å’Œå˜åŒ–é‡è®¡ç®—sign
2. **åœºæ™¯é€‚é…**: ä¸“é—¨ä¸ºèƒ½è€—/æ€§èƒ½åˆ†æè®¾è®¡ï¼Œè§„åˆ™ç³»ç»Ÿå…¨é¢è¦†ç›–ç›¸å…³æŒ‡æ ‡
3. **å®ç”¨æ€§å¼º**: å¯ç›´æ¥ç”¨äºä»»åŠ¡1.6çš„æƒè¡¡æ£€æµ‹åˆ†æ
4. **è´¨é‡å¯é **: ä»£ç æ¶æ„æ¸…æ™°ï¼Œé”™è¯¯å¤„ç†å®Œå–„ï¼Œå‘åå…¼å®¹å®Œæ•´
5. **éƒ¨ç½²å°±ç»ª**: åªéœ€ç¯å¢ƒé…ç½®å³å¯æŠ•å…¥ç”Ÿäº§ä½¿ç”¨

**æ¨è**: ç«‹å³éƒ¨ç½²åˆ°åˆ†æç¯å¢ƒï¼Œå¼€å§‹ä»»åŠ¡1.6çš„æƒè¡¡æ£€æµ‹å·¥ä½œã€‚

---
**éªŒæ”¶å®Œæˆæ—¶é—´**: 2026-01-31
**éªŒæ”¶æ–‡ä»¶**:
- `/home/green/energy_dl/nightly/analysis/utils/tradeoff_detection.py`
- `/home/green/energy_dl/nightly/analysis/TRADEOFF_OPTIMIZATION_ACCEPTANCE_REPORT.md`
- `/home/green/energy_dl/nightly/analysis/test_tradeoff_logic.py`

**ä¸‹ä¸€æ­¥**: åœ¨å®é™…åˆ†æç¯å¢ƒä¸­è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼ŒéªŒè¯ä¸çœŸå®ATEæ•°æ®çš„é›†æˆæ•ˆæœã€‚