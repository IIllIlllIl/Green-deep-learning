# 研究问题方法论

**版本**: v1.0 | **创建**: 2026-02-02 | **依据**: 手写草稿 + 项目进展

> **目标**: 基于项目实际进展和数据现状，提供RQ1-RQ4的完整分析方法论

---

## 📋 目录

1. [研究问题概览](#研究问题概览)
2. [核心逻辑关系](#核心逻辑关系)
3. [RQ1: 超参数对能耗的影响力方向和大小](#rq1-超参数对能耗的影响力方向和大小)
4. [RQ2: 利用中间变量解释发现](#rq2-利用中间变量解释发现)
5. [RQ3: 能耗和性能的权衡关系](#rq3-能耗和性能的权衡关系)
6. [RQ4: 并行非并行场景差异](#rq4-并行非并行场景差异)
7. [数据文件映射](#数据文件映射)
8. [执行步骤](#执行步骤)

---

## 研究问题概览

| RQ | 问题 | 核心方法 | 优先级 | 数据基础 |
|----|------|----------|--------|----------|
| **RQ1** | 超参数对能耗的影响力方向和大小 | DiBS因果图 + 整体ATE | P0 | 全局标准化数据（818样本） |
| **RQ2** | 利用中间变量解释发现 | 因果路径提取 + 中介频率统计 | P0 | DiBS因果图（49×49邻接矩阵） |
| **RQ3** | 能耗和性能的权衡关系 | Algorithm 1权衡检测 | P0 | 37个已识别权衡 |
| **RQ4** | 并行/非并行场景差异 | 交互项调节效应分析 | P0 | 调节强度、交互效应ATE |

**逻辑顺序**: RQ1（基础影响）→ RQ2（机制解释）→ RQ3（权衡分析）→ RQ4（场景调节）

---

## 核心逻辑关系

### 递进结构
```
RQ1: 发现基础效应（哪些超参数影响能耗？影响多大？）
  ↓ (建立因果基础)
RQ2: 解释机制路径（通过哪些中间变量？）
  ↓ (理解作用路径)
RQ3: 分析权衡关系（能耗vs性能如何权衡？）
  ↓ (探索复杂关系)
RQ4: 研究场景差异（并行场景如何调节？）
```

### 方法论选择
1. **因果推断优先**: 使用DiBS进行因果发现，而非相关性分析
2. **量化分析为主**: ATE、路径强度、中介频率等量化指标
3. **多角度验证**: 因果图 + ATE + 权衡检测 + 交互效应

---

## RQ1: 超参数对能耗的影响力方向和大小

### 问题定义
量化超参数对能耗的因果效应：哪些超参数有显著影响？影响方向和大小如何？

### 核心方法
1. **DiBS因果图分析**: 识别超参数→能耗的因果边
2. **整体ATE计算**: 量化每个超参数的因果效应大小

### 数据输入
- **全局标准化数据**: `analysis/data/energy_research/6groups_global_std/` (818样本，50列)
- **DiBS因果图**: `analysis/results/energy_research/data/global_std/{group}/` (49×49邻接矩阵)
- **ATE结果**: `analysis/results/energy_research/data/global_std_dibs_ate/`

### 分析步骤
1. **因果边提取**: 从6组因果图中提取超参数→能耗的边
2. **效应强度计算**: 计算每条边的后验概率强度
3. **ATE汇总**: 整理每个超参数在每组中的ATE值
4. **交叉验证**: 对比因果边强度与ATE值的一致性

### 输出指标
| 指标 | 定义 | 输出格式 |
|------|------|----------|
| **因果路径列表** | 超参数→能耗的因果边（源、目标、强度） | CSV表格，按强度排序 |
| **ATE排序** | Top 10最强/最弱效应的超参数 | 柱状图 + 数值表 |
| **按任务组对比** | 同一超参数在不同任务组中的效应差异 | 分组对比表格 |

### 预期发现
- 识别5-10个对能耗有显著影响的超参数
- 量化效应大小（ATE值，单位：焦耳/单位变化）
- 发现超参数效应的任务组差异性

---

## RQ2: 利用中间变量解释发现

### 问题定义
超参数如何通过中间变量影响能耗？哪些中间变量在中介作用中最为重要？

### 核心方法
1. **因果路径提取**: 从DiBS因果图中提取超参数→中间变量→能耗的路径
2. **中介频率统计**: 统计每个中间变量在中介路径中的出现频率
3. **路径强度分析**: 计算每条完整路径的总强度

### 数据输入
- **DiBS因果图**: `analysis/results/energy_research/data/global_std/{group}/` (49×49邻接矩阵)
- **变量分类表**: 超参数、中间变量、能耗/性能变量的定义表

### 分析步骤
1. **路径枚举**: 枚举所有长度为2-3的因果路径（超参数→X→能耗）
2. **路径筛选**: 保留强度超过阈值的显著路径
3. **中介变量统计**: 统计每个中间变量的出现频率和总强度
4. **路径解释**: 用路径解释RQ1中发现的超参数效应

### 输出指标
| 指标 | 定义 | 输出格式 |
|------|------|----------|
| **因果路径列表** | 按长度分类的超参数→X→能耗路径 | 嵌套列表，按路径强度排序 |
| **中介变量重要性排序** | 根据出现频率和总强度排序 | 重要性表格 + 柱状图 |
| **路径解释表** | 用路径解释每个超参数的效应机制 | 超参数-路径-解释对应表 |

### 预期发现
- 识别3-5个关键中介变量（如训练时间、GPU利用率等）
- 量化中介路径的贡献比例
- 提供超参数效应的机制解释

---

## RQ3: 能耗和性能的权衡关系

### 问题定义
能耗和性能之间是否存在权衡关系？权衡的类型、强度和一致性如何？

### 核心方法
1. **Algorithm 1权衡检测**: 基于ATE符号比较检测权衡
2. **权衡强度计算**: 量化每个权衡的强度
3. **跨组一致性分析**: 分析权衡在不同任务组中的一致性

### 数据输入
- **37个已识别权衡**: `analysis/results/energy_research/tradeoff_detection/significant_tradeoffs.csv`
- **ATE结果**: `analysis/results/energy_research/data/global_std_dibs_ate/`

### 分析步骤
1. **权衡分类**: 将权衡按类型分类（能耗vs性能、能耗vs能耗、性能vs性能）
2. **强度排序**: 基于ATE差值计算每个权衡的强度
3. **典型案例分析**: 选择3-5个代表性权衡进行深入分析
4. **跨组一致性检查**: 检查相同超参数在不同任务组中的权衡模式

### 输出指标
| 指标 | 定义 | 输出格式 |
|------|------|----------|
| **权衡分类表** | 按类型分类的权衡列表 | 分类表格，附示例 |
| **权衡强度排序** | 按强度排序的权衡Top 10 | 排序表格 + 可视化 |
| **典型案例分析** | 深入分析3-5个代表性权衡 | 详细案例报告 |
| **跨任务组一致性** | 相同超参数在不同组中的权衡模式 | 一致性矩阵 |

### 预期发现
- 确认14个能耗vs性能权衡的统计显著性
- 识别不同类型的权衡模式
- 发现权衡强度的任务组差异

---

## RQ4: 并行/非并行场景差异

### 问题定义
并行训练场景如何调节超参数对能耗的影响？调节效应的强度和模式如何？

### 核心方法
1. **交互项调节效应分析**: 通过交互项探测场景调节效应
2. **调节强度计算**: 量化交互项的调节强度
3. **场景差异总结**: 总结并行/非并行场景的关键差异

### 数据输入
- **调节强度数据**: 交互项因果边的强度
- **交互效应ATE**: 并行vs非并行的ATE差异
- **分层数据**: 按场景分层的数据子集

### 分析步骤
1. **交互项识别**: 从因果图中识别超参数×is_parallel的交互项→能耗的边
2. **调节强度计算**: 计算交互项边的强度
3. **主效应vs交互效应对比**: 比较主效应和交互效应的大小
4. **跨组一致性分析**: 分析调节效应在不同任务组中的一致性
5. **场景差异总结**: 总结并行/非并行的关键差异点

### 输出指标
| 指标 | 定义 | 输出格式 |
|------|------|----------|
| **主效应 vs 交互效应对比** | 比较超参数主效应和场景交互效应 | 对比表格 + 可视化 |
| **调节强度排序** | 按调节强度排序的交互项Top 10 | 排序表格 |
| **跨任务组一致性** | 调节效应在不同任务组中的一致性 | 一致性矩阵 |
| **场景差异总结** | 并行/非并行场景的关键差异总结 | 差异总结表 |

### 预期发现
- 识别3-5个受场景显著调节的超参数
- 量化调节效应的强度
- 发现调节模式的任务组差异

---

## 数据文件映射

### 输入数据（已完成）

| 数据 | 位置 | 规模 | 用途 |
|------|------|------|------|
| 全局标准化数据 | `analysis/data/energy_research/6groups_global_std/` | 818样本×50列 | RQ1, RQ2基础 |
| DiBS因果图 | `analysis/results/energy_research/data/global_std/{group}/` | 6组×49×49矩阵 | RQ1, RQ2 |
| ATE结果 | `analysis/results/energy_research/data/global_std_dibs_ate/` | 6组ATE结果 | RQ1, RQ3, RQ4 |
| 权衡检测结果 | `analysis/results/energy_research/tradeoff_detection/` | 37个显著权衡 | RQ3 |
| 交互项数据 | `analysis/results/energy_research/data/interaction/` | 交互项因果边 | RQ4 |

### 输出结果（待生成）

| 结果 | 位置 | 对应RQ |
|------|------|--------|
| RQ1分析 | `analysis/results/energy_research/rq_analysis/rq1_hyperparam_effects/` | RQ1 |
| RQ2分析 | `analysis/results/energy_research/rq_analysis/rq2_mediator_analysis/` | RQ2 |
| RQ3分析 | `analysis/results/energy_research/rq_analysis/rq3_tradeoff_analysis/` | RQ3 |
| RQ4分析 | `analysis/results/energy_research/rq_analysis/rq4_scenario_analysis/` | RQ4 |

---

## 执行步骤

### Phase 1: 数据准备与验证（0.5天）
```bash
# 验证数据完整性
python3 analysis/scripts/data/verify_rq_inputs.py

# 创建输出目录结构
mkdir -p analysis/results/energy_research/rq_analysis/{rq1,rq2,rq3,rq4}
```

### Phase 2: RQ1分析 - 超参数效应（1.5天）
**目标**: 完成超参数对能耗的因果效应分析

**Day 1**:
- [ ] 读取6组DiBS因果图
- [ ] 提取超参数→能耗的因果边
- [ ] 计算效应强度，生成因果路径列表

**Day 2**:
- [ ] 读取ATE结果，计算每个超参数的平均效应
- [ ] 生成ATE排序（Top 10最强/最弱）
- [ ] 按任务组对比，识别跨组一致性/差异性

### Phase 3: RQ2分析 - 中介机制（1.5天）
**目标**: 分析超参数通过中间变量的作用机制

**Day 3**:
- [ ] 枚举超参数→中间变量→能耗的因果路径
- [ ] 计算路径强度，筛选显著路径
- [ ] 生成因果路径列表（按长度分类）

**Day 4**:
- [ ] 统计中介变量出现频率
- [ ] 生成中介变量重要性排序
- [ ] 用路径解释RQ1的发现，创建解释表

### Phase 4: RQ3分析 - 权衡关系（1.5天）
**目标**: 分析能耗和性能的权衡关系

**Day 5**:
- [ ] 读取37个显著权衡
- [ ] 按类型分类（能耗vs性能、能耗vs能耗等）
- [ ] 计算权衡强度，生成强度排序

**Day 6**:
- [ ] 选择3-5个典型案例进行深入分析
- [ ] 分析跨任务组一致性
- [ ] 生成权衡分析综合报告

### Phase 5: RQ4分析 - 场景差异（1.5天）
**目标**: 分析并行/非并行场景的调节效应

**Day 7**:
- [ ] 读取交互项因果边数据
- [ ] 识别显著的调节效应（交互项→能耗的边）
- [ ] 计算调节强度，生成调节强度排序

**Day 8**:
- [ ] 对比主效应和交互效应
- [ ] 分析跨任务组一致性
- [ ] 总结场景差异，生成差异总结表

### Phase 6: 整合与撰写（1.5天）
**Day 9**:
- [ ] 整合所有RQ结果
- [ ] 统一图表风格和格式
- [ ] 撰写综合研究报告

---

## 工作量估算

| 任务 | 工作量 | 优先级 | 状态 |
|------|--------|--------|------|
| RQ1: 超参数效应分析 | 1.5天 | P0 | 待开始 |
| RQ2: 中介机制分析 | 1.5天 | P0 | 待开始 |
| RQ3: 权衡关系分析 | 1.5天 | P0 | 待开始 |
| RQ4: 场景差异分析 | 1.5天 | P0 | 待开始 |
| 整合与撰写 | 1.5天 | P0 | 待开始 |
| **总计** | **7.5天** | | |

---

## 风险管理

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|----------|
| 数据质量问题 | 低 | 高 | 已通过全局标准化修复验证 |
| DiBS因果图不准确 | 中 | 中 | 使用白名单过滤，交叉验证ATE |
| 样本量不足 | 低 | 中 | 聚焦group1(304)和group3(206) |
| 时间不足 | 中 | 高 | 优先完成RQ1和RQ3（核心发现） |

---

## 成功标准

### 必须完成（P0）
- ✅ RQ1: 识别至少5个关键超参数及其效应方向和大小
- ✅ RQ2: 识别至少3个关键中介变量及其重要性排序
- ✅ RQ3: 完成37个权衡的分类和强度分析
- ✅ RQ4: 分析场景调节效应，识别至少3个显著调节

### 加分项（P1）
- ⭐ 发现跨任务组的系统性模式
- ⭐ 提供实用的优化建议
- ⭐ 所有分析可复现，代码文档完整

---

## 参考资料

- **DiBS论文**: https://arxiv.org/abs/2106.06517
- **ATE计算方法**: Chernozhukov et al. (2018) 双机器学习
- **权衡检测算法**: Algorithm 1 (基于ATE符号比较)
- **交互项调节效应**: 因果推断中的调节效应分析
- **项目文档**: `analysis/docs/INDEX.md`

---

**维护者**: Green | **版本**: v1.0 | **创建**: 2026-02-02

**版本历史**:
- v1.0 (2026-02-02): 基于手写草稿创建，整合项目实际进展