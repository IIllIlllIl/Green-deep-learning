# 分层DiBS数据质量评估报告

**生成日期**: 2026-01-06
**目的**: 评估按模式分层后的数据质量，调整分析计划

---

## 📊 数据准备结果总结

### 样本量统计

| 任务组 | 并行模式 | 非并行模式 | 总计 | 混合DiBS数据 | 差距 |
|--------|---------|-----------|------|-------------|------|
| group1_examples | 0 | 0 | 0 | 259 | -259 ❌ |
| group2_vulberta | 54 | 61 | 115 | 152 | -37 |
| group3_person_reid | 76 | 19 | 95 | 146 | -51 |
| group4_bug_localization | 0 | 0 | 0 | 142 | -142 ❌ |
| group5_mrt_oast | 0 | 0 | 0 | 88 | -88 ❌ |
| group6_resnet | 22* | 15 | 37 | 49 | -12 |
| **总计** | **152** | **95** | **247** | **836** | **-589** |

*注：group6_resnet并行模式有22个样本，但0个特征（全被过滤）

### 数据完整性评级

| 任务组 | 并行模式 | 非并行模式 | 可行性 |
|--------|---------|-----------|--------|
| **group2_vulberta** | ✅ 54样本，11特征 | ✅ 61样本，11特征 | **可执行DiBS** |
| **group3_person_reid** | ✅ 76样本，11特征 | ⚠️ 19样本，18特征 | **可执行DiBS（非并行样本量偏少）** |
| group6_resnet | ❌ 22样本，0特征 | ⚠️ 15样本，17特征 | **无法执行DiBS** |
| group1_examples | ❌ 无数据 | ❌ 无数据 | **无法执行** |
| group4_bug_localization | ❌ 无数据 | ❌ 无数据 | **无法执行** |
| group5_mrt_oast | ❌ 无数据 | ❌ 无数据 | **无法执行** |

---

## 🔍 问题分析

### 问题1: 为什么3个组完全无数据？

**group1_examples, group4_bug_localization, group5_mrt_oast**

**可能原因**:
1. **并行/非并行标记问题**: 这些组的实验可能没有正确标记mode字段
2. **数据收集遗漏**: 这些组的并行和非并行实验可能实际上没有收集
3. **仓库/模型名称不匹配**: 任务组定义可能与实际数据不符

**验证方法**: 检查raw_data.csv中这些repository的mode字段分布

### 问题2: 为什么group6并行模式有样本但无特征？

**group6_resnet并行模式**: 22样本 → 0特征（全部过滤）

**原因**: 40%缺失率阈值过严
- 并行模式的22个样本中，所有特征列的缺失率都超过40%
- 说明并行模式下这些实验的数据质量较差

**验证**: 检查并行模式下group6的原始数据缺失情况

### 问题3: 为什么样本量损失这么大？

**总损失**: 836 → 247样本（损失70.5%）

**主要原因**:
1. **模式过滤**: 分层后样本量减半是预期的
2. **缺失值清洗**: 40%阈值 + dropna()导致大量样本丢失
3. **超参数特征缺失**: 并行模式下许多超参数未记录（group2和group3的并行模式都是0个超参数）

---

## ⚠️ 关键发现

### 发现1: 并行模式缺少超参数数据

| 任务组 | 模式 | 超参数数 | 问题 |
|--------|------|---------|------|
| group2_vulberta | 并行 | 0 | ❌ **无超参数** |
| group2_vulberta | 非并行 | 0 | ❌ **无超参数** |
| group3_person_reid | 并行 | 0 | ❌ **无超参数** |
| group3_person_reid | 非并行 | 3 | ✅ 正常 |
| group6_resnet | 并行 | 0 | ❌ **全过滤** |
| group6_resnet | 非并行 | 3 | ✅ 正常 |

**影响**:
- ❌ 无法分析并行模式下"超参数→能耗"的因果关系（问题1）
- ❌ 无法比较并行vs非并行的超参数效应差异

**这是致命问题！** 如果没有超参数数据，DiBS无法发现超参数对能耗的因果边。

### 发现2: 性能指标也缺失

| 任务组 | 模式 | 性能指标数 |
|--------|------|-----------|
| group2_vulberta | 并行 | 0 |
| group2_vulberta | 非并行 | 0 |
| group3_person_reid | 并行 | 0 |
| group3_person_reid | 非并行 | 3 |

**影响**:
- ❌ 无法分析并行模式下的能耗-性能权衡（问题2）

---

## 💡 调整建议

### 方案A: 放宽缺失率阈值 ⭐⭐⭐ 推荐

**操作**: 将缺失率阈值从40%提高到60%或70%

**预期**:
- 保留更多超参数和性能特征
- 样本量保持不变
- 数据质量略有下降，但DiBS可以处理

**工作量**: 10分钟（重新运行数据准备脚本）

### 方案B: 只分析非并行模式 ⚠️ 备选

**操作**: 放弃并行模式DiBS，只分析非并行模式

**理由**:
- 非并行模式数据质量更好（有超参数）
- group3非并行有19个样本（勉强够）
- group2非并行有61个样本（充足）

**局限**: 无法回答"模式是否改变因果结构"的问题

### 方案C: 采用混合策略 ⭐⭐ 平衡方案

**操作**:
1. 对于有超参数数据的模式（如group3非并行），运行DiBS
2. 对于无超参数数据的模式（如group2/group3并行），只分析能耗指标之间的因果关系
3. 使用交互效应回归补充分析（不依赖DiBS）

**优势**: 最大化利用现有数据

---

## 🎯 我的推荐

基于数据质量评估，我**强烈推荐**：

### 立即执行：方案A（放宽阈值）+ 方案C（混合策略）

**步骤**:

1. **重新准备数据（缺失率阈值=60%）** - 10分钟
   - 预期：超参数特征保留率提高
   - group2/group3并行模式可能恢复超参数数据

2. **评估新数据质量** - 5分钟
   - 如果仍然缺少超参数 → 转方案C

3. **执行分层DiBS（限定范围）** - 2小时
   - 只对有超参数数据的组执行DiBS
   - group2: 并行vs非并行
   - group3: 并行vs非并行（如果数据充足）

4. **交互效应回归（全部5条边）** - 1小时
   - 不依赖DiBS，直接验证交互效应
   - 覆盖所有任务组

5. **分层中介分析** - 1小时
   - 对有中介路径的组进行分层分析

**总工作量**: 约4.5小时（比原计划少1.5小时）

---

## 📋 下一步决策

请您选择：

**选项1**: 执行方案A（放宽阈值至60%）⭐⭐⭐
- 重新准备数据，看是否能恢复超参数

**选项2**: 直接执行方案C（混合策略）⭐⭐
- 用现有数据，对有超参数的组做DiBS
- 其他组用交互回归

**选项3**: 转为简化方案（只做交互回归+中介分析）⭐
- 放弃分层DiBS，节省时间
- 直接用回归验证模式的调节效应

---

## 📊 数据恢复可能性预估

如果放宽到60%阈值：

| 特征类型 | 40%阈值 | 60%阈值（预估） | 改善 |
|---------|---------|----------------|------|
| 超参数 | 0-3个 | 2-5个 | ⬆️ 可能恢复 |
| 性能指标 | 0-3个 | 1-4个 | ⬆️ 可能恢复 |
| 能耗指标 | 11个 | 11-13个 | ➡️ 基本不变 |

**关键**: 超参数和性能指标通常缺失率在45-55%之间，60%阈值可能恢复它们。

---

**报告生成时间**: 2026-01-06
**建议**: 先执行方案A（10分钟），根据结果决定是否继续完整DiBS
