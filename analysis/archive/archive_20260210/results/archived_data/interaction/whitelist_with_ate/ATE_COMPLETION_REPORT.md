# ç™½åå•æ•°æ®ATEè¡¥å…¨ä»»åŠ¡å®ŒæˆæŠ¥å‘Š

**ä»»åŠ¡å®Œæˆæ—¶é—´**: 2026-01-26
**æ‰§è¡Œç¯å¢ƒ**: causal-research (conda)
**è„šæœ¬ç‰ˆæœ¬**: v1.0
**æ•°æ®ç›®å½•**: `/home/green/energy_dl/nightly/analysis/results/energy_research/data/interaction/whitelist_with_ate/`

## ğŸ“Š ä»»åŠ¡æ¦‚è§ˆ

æˆåŠŸä¸º6ä¸ªç»„çš„ç™½åå•æ•°æ®è®¡ç®—å¹¶è¡¥å…¨äº†ATEï¼ˆå¹³å‡å¤„ç†æ•ˆåº”ï¼‰ä¿¡æ¯ï¼Œå®ç°äº†100%çš„ATEè®¡ç®—æˆåŠŸç‡ã€‚

### æ ¸å¿ƒæˆæœ

| æŒ‡æ ‡ | ç»“æœ |
|------|------|
| **æ€»è¾¹æ•°** | 227æ¡å› æœè¾¹ |
| **ATEè®¡ç®—æˆåŠŸç‡** | **100%** (227/227) |
| **ç»Ÿè®¡æ˜¾è‘—è¾¹** | 151æ¡ (66.5%) |
| **ç½®ä¿¡åŒºé—´æœ‰æ•ˆç‡** | 95.6% (217/227) |
| **é”™è¯¯ç‡** | 0% (0/227) |
| **å¤„ç†æ—¶é—´** | çº¦15åˆ†é’Ÿ |

## ğŸ“ è¾“å‡ºæ–‡ä»¶æ¸…å•

### 1. ATEè¡¥å…¨æ•°æ®æ–‡ä»¶ (6ä¸ªç»„)

| æ–‡ä»¶ | åŸå§‹è¾¹æ•° | ATEè®¡ç®—æˆåŠŸ | æ˜¾è‘—è¾¹æ•° | æ˜¾è‘—ç‡ |
|------|---------|------------|---------|-------|
| `group1_examples_causal_edges_whitelist_with_ate.csv` | 43 | 43 (100%) | 38 | 88.4% |
| `group2_vulberta_causal_edges_whitelist_with_ate.csv` | 35 | 35 (100%) | 19 | 54.3% |
| `group3_person_reid_causal_edges_whitelist_with_ate.csv` | 50 | 50 (100%) | 39 | 78.0% |
| `group4_bug_localization_causal_edges_whitelist_with_ate.csv` | 40 | 40 (100%) | 23 | 57.5% |
| `group5_mrt_oast_causal_edges_whitelist_with_ate.csv` | 40 | 40 (100%) | 18 | 45.0% |
| `group6_resnet_causal_edges_whitelist_with_ate.csv` | 19 | 19 (100%) | 14 | 73.7% |

### 2. è´¨é‡æŠ¥å‘Šæ–‡ä»¶

| æ–‡ä»¶ | æè¿° |
|------|------|
| `ate_data_quality_summary.csv` | æ•°æ®è´¨é‡æ±‡æ€»æŠ¥å‘Š |
| `ate_data_quality_detailed.csv` | è¯¦ç»†è´¨é‡æŒ‡æ ‡æŠ¥å‘Š |
| `ate_data_quality_visualization.png` | è´¨é‡å¯è§†åŒ–å›¾è¡¨ |
| `ate_computation_summary.csv` | ATEè®¡ç®—è¿‡ç¨‹æ±‡æ€» |

### 3. è„šæœ¬æ–‡ä»¶

| è„šæœ¬ | åŠŸèƒ½ |
|------|------|
| `compute_ate_for_whitelist.py` | ATEè®¡ç®—ä¸»è„šæœ¬ |
| `check_ate_data_quality.py` | æ•°æ®è´¨é‡æ£€æŸ¥è„šæœ¬ |

## ğŸ”§ æŠ€æœ¯å®ç°

### ä½¿ç”¨çš„æ ¸å¿ƒç»„ä»¶

1. **CausalInferenceEngine** (å·²éªŒæ”¶)
   - åŸºäºEconMLçš„DMLå®ç°
   - CTFé£æ ¼çš„æ··æ·†å› ç´ è¯†åˆ«
   - æ”¯æŒref_dfå’ŒT0/T1å‚æ•°

2. **æ•°æ®å¤„ç†ç­–ç•¥**
   - **ref_dfç­–ç•¥**: `non_parallel` (ä½¿ç”¨éå¹¶è¡Œæ¨¡å¼ä½œä¸ºbaseline)
   - **T0/T1ç­–ç•¥**: `quantile` (25/75åˆ†ä½æ•°)
   - **å¸ƒå°”å˜é‡å¤„ç†**: è‡ªåŠ¨ç¼–ç ä¸º0/1
   - **äº¤äº’é¡¹å¤„ç†**: è‡ªåŠ¨åˆ›å»ºäº¤äº’é¡¹åˆ—

### æ–°å¢æ•°æ®åˆ—

æ¯ä¸ªç™½åå•æ–‡ä»¶æ–°å¢äº†ä»¥ä¸‹åˆ—ï¼š

| åˆ—å | æè¿° | æ•°æ®ç±»å‹ |
|------|------|----------|
| `ate` | å¹³å‡å¤„ç†æ•ˆåº” | float |
| `ci_lower` | ç½®ä¿¡åŒºé—´ä¸‹ç•Œ | float |
| `ci_upper` | ç½®ä¿¡åŒºé—´ä¸Šç•Œ | float |
| `is_significant` | æ˜¯å¦ç»Ÿè®¡æ˜¾è‘— | bool |
| `ate_computed` | ATEæ˜¯å¦è®¡ç®—æˆåŠŸ | bool |
| `error_message` | é”™è¯¯ä¿¡æ¯ | string |

## ğŸ“ˆ æ•°æ®è´¨é‡åˆ†æ

### ATEç»Ÿè®¡ç‰¹å¾

| ç»Ÿè®¡é‡ | å€¼ |
|--------|----|
| **å¹³å‡ATEå‡å€¼** | 15,504.27 |
| **å¹³å‡ATEæ ‡å‡†å·®** | 41,774.76 |
| **æ€»ä½“ATEæœ€å°å€¼** | -88,927.12 |
| **æ€»ä½“ATEæœ€å¤§å€¼** | 428,388.76 |

### å„ç»„è¡¨ç°å¯¹æ¯”

1. **æœ€é«˜æ˜¾è‘—ç‡**: group1_examples (88.4%)
2. **æœ€ä½æ˜¾è‘—ç‡**: group5_mrt_oast (45.0%)
3. **æœ€å¤§ATEèŒƒå›´**: group3_person_reid (-88,927.12 åˆ° 428,388.76)
4. **æœ€å°ATEèŒƒå›´**: group1_examples (-46.75 åˆ° 51,543.81)

### ç½®ä¿¡åŒºé—´è´¨é‡

- **æ€»ä½“æœ‰æ•ˆç‡**: 95.6%
- **å®Œç¾ç»„**: group1_examples, group2_vulberta, group6_resnet (100%)
- **éœ€è¦å…³æ³¨ç»„**: group4_bug_localization, group5_mrt_oast (90-97.5%)

## ğŸ› ï¸ å…³é”®æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. äº¤äº’é¡¹å¤„ç† (`_x_`)

**é—®é¢˜**: ç™½åå•ä¸­çš„äº¤äº’é¡¹å¦‚ `hyperparam_batch_size_x_is_parallel` ä¸åœ¨åŸå§‹æ•°æ®ä¸­

**è§£å†³æ–¹æ¡ˆ**:
- è‡ªåŠ¨è¯†åˆ« `_x_` æ¨¡å¼
- åˆ†è§£ä¸ºåŸå§‹å˜é‡å¹¶åˆ›å»ºäº¤äº’é¡¹
- åŒæ—¶åœ¨åŸå§‹æ•°æ®å’Œref_dfä¸­åˆ›å»ºäº¤äº’åˆ—

### 2. å¸ƒå°”å˜é‡å¤„ç†

**é—®é¢˜**: æ¨¡å‹å˜é‡å¦‚ `model_mnist_ff` æ˜¯å¸ƒå°”ç±»å‹ï¼Œå¯¼è‡´DMLè®¡ç®—å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- è‡ªåŠ¨æ£€æµ‹å¸ƒå°”/äºŒåˆ†ç±»å˜é‡
- ç¼–ç ä¸º0/1æ•´æ•°
- å¯¹treatmentå’Œoutcomeéƒ½è¿›è¡Œç¼–ç 

### 3. æ··æ·†å› ç´ è¯†åˆ«

**é—®é¢˜**: æ²¡æœ‰å› æœå›¾ä¿¡æ¯ï¼Œæ— æ³•ç²¾ç¡®è¯†åˆ«æ··æ·†å› ç´ 

**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨æ‰€æœ‰å…¶ä»–æ•°å€¼å˜é‡ä½œä¸ºæ··æ·†å› ç´ 
- æ·»åŠ å¸¸è§å…³é”®å˜é‡ä½œä¸ºåå¤‡
- ç¡®ä¿è‡³å°‘æœ‰5ä¸ªæ··æ·†å› ç´ 

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### åŠ è½½ATEè¡¥å…¨æ•°æ®

```python
import pandas as pd

# åŠ è½½ATEè¡¥å…¨æ•°æ®
ate_df = pd.read_csv('group1_examples_causal_edges_whitelist_with_ate.csv')

# æŸ¥çœ‹ATEç»Ÿè®¡
print(f"æ€»è¾¹æ•°: {len(ate_df)}")
print(f"ATEè®¡ç®—æˆåŠŸ: {ate_df['ate_computed'].sum()}")
print(f"ç»Ÿè®¡æ˜¾è‘—è¾¹: {ate_df['is_significant'].sum()}")

# ç­›é€‰æ˜¾è‘—æ•ˆåº”
significant_effects = ate_df[ate_df['is_significant']]
print(f"æ˜¾è‘—æ•ˆåº”æ•°é‡: {len(significant_effects)}")

# æŸ¥çœ‹æœ€å¤§çš„ATE
top_effects = ate_df.nlargest(5, 'ate')
print("æœ€å¤§çš„5ä¸ªATE:")
print(top_effects[['source', 'target', 'ate', 'ci_lower', 'ci_upper']])
```

### åˆ†æç‰¹å®šç±»å‹çš„æ•ˆåº”

```python
# åˆ†æäº¤äº’æ•ˆåº”
interaction_effects = ate_df[ate_df['source'].str.contains('_x_')]
print(f"äº¤äº’æ•ˆåº”æ•°é‡: {len(interaction_effects)}")

# åˆ†æèƒ½è€—ç›¸å…³æ•ˆåº”
energy_effects = ate_df[ate_df['target'].str.contains('energy_')]
print(f"èƒ½è€—ç›¸å…³æ•ˆåº”: {len(energy_effects)}")

# åˆ†ææ€§èƒ½ç›¸å…³æ•ˆåº”
performance_effects = ate_df[ate_df['target'].str.contains('perf_')]
print(f"æ€§èƒ½ç›¸å…³æ•ˆåº”: {len(performance_effects)}")
```

## ğŸ” éªŒè¯ä¸æµ‹è¯•

### Dry Runæµ‹è¯•
- æ‰§è¡Œäº†å®Œæ•´çš„dry runæµ‹è¯•
- éªŒè¯äº†æ‰€æœ‰æ•°æ®å¤„ç†é€»è¾‘
- ç¡®è®¤äº†100%çš„è®¡ç®—æˆåŠŸç‡

### å®é™…è¿è¡Œ
- 6ä¸ªç»„å…¨éƒ¨æˆåŠŸå¤„ç†
- æ— é”™è¯¯å‘ç”Ÿ
- è¾“å‡ºæ–‡ä»¶æ ¼å¼æ­£ç¡®

### è´¨é‡æ£€æŸ¥
- ç‹¬ç«‹çš„è´¨é‡æ£€æŸ¥è„šæœ¬éªŒè¯
- å¯è§†åŒ–å›¾è¡¨ç”Ÿæˆ
- è¯¦ç»†ç»Ÿè®¡æŠ¥å‘Š

## ğŸš€ åç»­å»ºè®®

### 1. å› æœå›¾é›†æˆ
- å½“å‰ä½¿ç”¨ç®€åŒ–æ··æ·†å› ç´ è¯†åˆ«
- å»ºè®®é›†æˆå› æœå›¾è¿›è¡Œç²¾ç¡®è¯†åˆ«
- å¯æé«˜ATEä¼°è®¡çš„å‡†ç¡®æ€§

### 2. æ•æ„Ÿæ€§åˆ†æ
- å¯¹ref_dfç­–ç•¥è¿›è¡Œæ•æ„Ÿæ€§åˆ†æ
- æ¯”è¾ƒä¸åŒT0/T1ç­–ç•¥çš„å½±å“
- è¯„ä¼°ç»“æœçš„ç¨³å¥æ€§

### 3. ç»“æœè§£é‡Š
- æ·»åŠ ATEæ•ˆåº”å¤§å°åˆ†ç±»ï¼ˆå°/ä¸­/å¤§ï¼‰
- æä¾›å®é™…æ„ä¹‰è§£é‡Š
- ä¸åŸå§‹strengthæŒ‡æ ‡å¯¹æ¯”åˆ†æ

### 4. æ‰¹é‡åˆ†æå·¥å…·
- åˆ›å»ºç»Ÿä¸€çš„ATEåˆ†æå·¥å…·
- æ”¯æŒè·¨ç»„æ¯”è¾ƒ
- æä¾›äº¤äº’å¼å¯è§†åŒ–

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### è„šæœ¬ä½ç½®
- ATEè®¡ç®—: `/home/green/energy_dl/nightly/analysis/scripts/compute_ate_for_whitelist.py`
- è´¨é‡æ£€æŸ¥: `/home/green/energy_dl/nightly/analysis/scripts/check_ate_data_quality.py`

### è¿è¡Œå‘½ä»¤
```bash
# æ¿€æ´»ç¯å¢ƒ
source /home/green/miniconda3/bin/activate causal-research

# è®¡ç®—ATE
python compute_ate_for_whitelist.py [--dry-run] [--group N]

# æ£€æŸ¥è´¨é‡
python check_ate_data_quality.py
```

### å‚æ•°è¯´æ˜
- `--dry-run`: æµ‹è¯•æ¨¡å¼ï¼Œä¸å†™å…¥æ–‡ä»¶
- `--group`: æŒ‡å®šå¤„ç†ç»„ï¼ˆ1-6ï¼‰
- `--t-strategy`: T0/T1ç­–ç•¥ï¼ˆquantile/min_max/mean_stdï¼‰
- `--ref-strategy`: ref_dfç­–ç•¥ï¼ˆnon_parallel/mean/group_meanï¼‰

## âœ… ä»»åŠ¡å®Œæˆç¡®è®¤

æ‰€æœ‰è¦æ±‚çš„ä»»åŠ¡å‡å·²æˆåŠŸå®Œæˆï¼š

1. âœ… **åˆ›å»ºATEè®¡ç®—è„šæœ¬** - åŸºäºCausalInferenceEngineå®ç°
2. âœ… **æ‰§è¡Œdry runæµ‹è¯•** - éªŒè¯è„šæœ¬åŠŸèƒ½
3. âœ… **å®é™…è¿è¡Œæ•°æ®è¡¥å®Œ** - 6ä¸ªç»„å…¨éƒ¨æˆåŠŸå¤„ç†
4. âœ… **æ£€æŸ¥æ•°æ®è´¨é‡** - ç”Ÿæˆè¯¦ç»†è´¨é‡æŠ¥å‘Š
5. âœ… **ç”Ÿæˆç»Ÿè®¡æŠ¥å‘Š** - æœ¬æŠ¥å‘ŠåŠé…å¥—æ–‡ä»¶

**æ•°æ®å·²å°±ç»ªï¼Œå¯ç”¨äºåç»­çš„å› æœæ¨æ–­åˆ†æã€‚**

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2026-01-26*
*æ‰§è¡Œè€…: Claude Code*
*é¡¹ç›®: Energy DL - ç™½åå•æ•°æ®ATEè¡¥å…¨*